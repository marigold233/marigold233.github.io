
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://marigold233.github.io/%E7%BC%96%E7%A8%8B/SQL/Python/Python%E5%B7%A5%E5%8C%A0%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
      
      
        <link rel="prev" href="../../MySQL/5.%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/6.%20%E6%9E%9A%E4%B8%BE%E5%92%8C%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/">
      
      
        <link rel="next" href="../%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7nuitka%E7%9A%84%E4%BD%BF%E7%94%A8/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.11">
    
    
      
        <title>Python工匠学习笔记 - 我的文档站</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/lxgwwenkaiscreen.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../.." title="我的文档站" class="md-header__button md-logo" aria-label="我的文档站" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            我的文档站
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Python工匠学习笔记
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/marigold233/devops" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    marigold233/devops
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  施工建设中...

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../Linux/iptables%E5%AF%B9%E8%AE%BF%E9%97%AEURL%E5%81%9A%E9%99%90%E5%88%B6/" class="md-tabs__link">
          
  
  Linux

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../Win/%E6%88%91%E7%9A%84Win%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9%E6%89%8B%E5%86%8C/" class="md-tabs__link">
          
  
  Win

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../mkdocs/mkdocs%E5%8F%82%E8%80%83%E7%AB%99/" class="md-tabs__link">
          
  
  Mkdocs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../%E6%90%9E%E6%9C%BA/%E5%85%B3%E4%BA%8E%E5%88%B7%E6%9C%BA%E7%9A%84%E6%80%BB%E7%BB%93/" class="md-tabs__link">
          
  
  搞机

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../MySQL/0.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%A6%82%E5%BF%B5/" class="md-tabs__link">
          
  
  编程

        </a>
      </li>
    
  

    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="我的文档站" class="md-nav__button md-logo" aria-label="我的文档站" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    我的文档站
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/marigold233/devops" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    marigold233/devops
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    施工建设中...
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/iptables%E5%AF%B9%E8%AE%BF%E9%97%AEURL%E5%81%9A%E9%99%90%E5%88%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iptables对访问URL做限制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/shell%E8%84%9A%E6%9C%AC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Shell脚本
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/shell%E8%84%9A%E6%9C%AC%E9%80%89%E9%A1%B9%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    shell脚本参数自动补全
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E4%BD%BF%E7%94%A8systemd%E5%90%AF%E5%8A%A8jar%E7%A8%8B%E5%BA%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用systemd启动jar程序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E4%BF%AE%E5%A4%8Dnginx%20http%E5%A4%B4%E7%9B%B8%E5%85%B3%E6%BC%8F%E6%B4%9E/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    修复http头相关漏洞
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E8%B0%83%E4%BC%98/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内核参数调优
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E5%90%AF%E7%94%A8sudo%E6%9D%83%E9%99%90/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    启用sudo权限
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E6%B5%8B%E8%AF%95%E7%AB%AF%E5%8F%A3%E8%BF%9E%E9%80%9A%E6%80%A7%E7%9A%84%E5%87%A0%E7%A7%8D%E5%91%BD%E4%BB%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    测试端口连通性的几种命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85ansible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    离线安装ansible
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E8%B0%83%E6%95%B4Linux%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    调整Linux打开文件数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E9%9D%99%E6%80%81%E7%BC%96%E8%AF%91procps-ng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    静态编译procps-ng
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Linux命令
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            Linux命令
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/Linux%E5%91%BD%E4%BB%A4/10%E4%B8%AALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%BF%90%E7%AE%97%E7%AC%A6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10个Linux命令行运算符
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/Linux%E5%91%BD%E4%BB%A4/systemd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Systemd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/Linux%E5%91%BD%E4%BB%A4/%E6%88%91%E7%9A%84Linux%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9%E6%89%8B%E5%86%8C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    我的Linux命令帮助手册
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    服务搭建
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            服务搭建
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/emqx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Emqx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E6%9C%8D%E5%8A%A1%E6%90%AD%E5%BB%BA/haproxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Haproxy
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14" >
        
          
          <label class="md-nav__link" for="__nav_2_14" id="__nav_2_14_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    运维工具
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_14">
            <span class="md-nav__icon md-icon"></span>
            运维工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Linux/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/ansible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Win
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Win
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Win/%E6%88%91%E7%9A%84Win%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9%E6%89%8B%E5%86%8C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    我的Win命令帮助手册
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mkdocs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Mkdocs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../mkdocs/mkdocs%E5%8F%82%E8%80%83%E7%AB%99/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mkdocs参考站
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    搞机
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            搞机
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E6%90%9E%E6%9C%BA/%E5%85%B3%E4%BA%8E%E5%88%B7%E6%9C%BA%E7%9A%84%E6%80%BB%E7%BB%93/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于刷机的总结
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    编程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            编程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" checked>
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    SQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            SQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1" id="__nav_6_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    MySQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1">
            <span class="md-nav__icon md-icon"></span>
            MySQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/0.%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%A6%82%E5%BF%B5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0. 数据库的概念
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/1.%20mysql%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. mysql的相关配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/10.%20where%E7%AD%9B%E9%80%89%E6%9D%A1%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. where筛选条件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/11.%20group%20by%E5%88%86%E7%BB%84/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    group by 分组
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/12.%20having%E5%88%86%E7%BB%84%E4%B9%8B%E5%90%8E%E7%9A%84%E7%AD%9B%E9%80%89%E6%9D%A1%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    having 分组之后的条件筛选
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/13.%20distinct%E5%8E%BB%E9%87%8D/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    distincat 去重
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/14%20%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    14 流程控制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/14.%20order%20by%E6%8E%92%E5%BA%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    order by 排序
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/15.%20limit%20%E9%99%90%E5%88%B6%E5%B1%95%E7%A4%BA%E6%9D%A1%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    limit限制展示条数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/16.%20%E6%AD%A3%E5%88%99/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    正则
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/17.%E8%BF%9E%E8%A1%A8%E6%93%8D%E4%BD%9C/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    17.连表操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/18.%20%E5%AD%90%E6%9F%A5%E8%AF%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    18. 子查询
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/19.%E8%A7%86%E5%9B%BE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    视图
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/2.%20%E5%BA%93%E3%80%81%E8%A1%A8%E3%80%81%E6%95%B0%E6%8D%AE%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. 库、表、数据的增删改查
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/20.%20%E8%A7%A6%E5%8F%91%E5%99%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    触发器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/21.%20%E4%BA%8B%E5%8A%A1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    21. 事务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/22.%20%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    22. 存储过程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/23%20%E5%87%BD%E6%95%B0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    23 函数
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/24.%20%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    24. 流程控制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/25.%20%E7%B4%A2%E5%BC%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    索引
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/3.%20%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    存储引擎
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/4.%20%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%9A%84%E5%AE%8C%E6%95%B4%E8%AF%AD%E6%B3%95/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    创建表的完整语法
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/6.%20%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    约束条件
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/7.%20%E8%A1%A8%E5%85%B3%E7%B3%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    表关系
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/8.%20%E4%BF%AE%E6%94%B9%E8%A1%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. 修改表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/9.%20%E5%A4%8D%E5%88%B6%E8%A1%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. 复制表
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_27" >
        
          
          <label class="md-nav__link" for="__nav_6_1_1_27" id="__nav_6_1_1_27_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    5. 基本数据类型
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_1_27_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_27">
            <span class="md-nav__icon md-icon"></span>
            5. 基本数据类型
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/5.%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/1.%20%E6%95%B4%E5%BD%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    整形
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/5.%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/2.%20%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    严格模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/5.%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/3.%20%E6%B5%AE%E7%82%B9%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. 浮点型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/5.%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/4.%20%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. 字符类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/5.%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/5.%20%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. 日期类型
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../MySQL/5.%20%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/6.%20%E6%9E%9A%E4%B8%BE%E5%92%8C%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. 枚举和集合类型
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_6_1_2" id="__nav_6_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1_2">
            <span class="md-nav__icon md-icon"></span>
            Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Python工匠学习笔记
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Python工匠学习笔记
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      变量与注释
    </span>
  </a>
  
    <nav class="md-nav" aria-label="变量与注释">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      变量解包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      给变量注明类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pep8" class="md-nav__link">
    <span class="md-ellipsis">
      遵循PEP8原则
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      数值与字符串
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数值与字符串">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      浮点数精度问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      布尔值也是数字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      字符串当序列操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      字符串格式化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      拼接多个字符串
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      不常用但特别好用的字符串方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="不常用但特别好用的字符串方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#isdigit" class="md-nav__link">
    <span class="md-ellipsis">
      isdigit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partition" class="md-nav__link">
    <span class="md-ellipsis">
      partition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#translate" class="md-nav__link">
    <span class="md-ellipsis">
      translate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      枚举类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todo-sqlalchemy" class="md-nav__link">
    <span class="md-ellipsis">
      todo 使用SQLAlchemy模块改写代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja2" class="md-nav__link">
    <span class="md-ellipsis">
      使用Jinja2 模块处理字符串
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      使用特殊数字: "无穷大"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      改善长字符串的可读性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      不包含多行字符串右边的空格
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      容器类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="容器类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      没有“元组推导式”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      具名元组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefault" class="md-nav__link">
    <span class="md-ellipsis">
      使用setdefault获取并修改
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    <span class="md-ellipsis">
      用pop删除不存在的键
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      字典推导式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      字典无序性和有序性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      集合
    </span>
  </a>
  
    <nav class="md-nav" aria-label="集合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      集合运算
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      浅拷贝和深拷贝
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      案例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      避开列表性能陷阱
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      使用集合判断成员是否存在
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      掌握快速合并字典
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      使用有序字典进行去重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      不要在遍历列表时同步修改
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nametuple" class="md-nav__link">
    <span class="md-ellipsis">
      让函数返回NameTuple
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      条件分支控制流
    </span>
  </a>
  
    <nav class="md-nav" aria-label="条件分支控制流">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      修改对象的布尔值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noneis" class="md-nav__link">
    <span class="md-ellipsis">
      与None比较时使用is运算符
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      案例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anyall" class="md-nav__link">
    <span class="md-ellipsis">
      使用any()/all()函数构建条件表达式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      异常与错误处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异常与错误处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raise" class="md-nav__link">
    <span class="md-ellipsis">
      使用空raise语句
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      抛出异常，而不是返回错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      上下文管理器忽略异常
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contextmanager" class="md-nav__link">
    <span class="md-ellipsis">
      使用contextmanager装饰器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      不要手动校验数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      抛出可区分的异常
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      空对象模式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      循环与可迭代对象
    </span>
  </a>
  
    <nav class="md-nav" aria-label="循环与可迭代对象">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      迭代器与可迭代对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      生成器是迭代器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#itertools" class="md-nav__link">
    <span class="md-ellipsis">
      使用itertools模块优化循环
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用itertools模块优化循环">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#product" class="md-nav__link">
    <span class="md-ellipsis">
      使用product()扁平化多层嵌套循环
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#islice" class="md-nav__link">
    <span class="md-ellipsis">
      使用islice()实现循环内隔行处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takewhilebreak" class="md-nav__link">
    <span class="md-ellipsis">
      使用takewhile()替代break语句
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      案例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nextkey" class="md-nav__link">
    <span class="md-ellipsis">
      巧用next函数获取字典第一个key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      当心已被耗尽的生成器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      定义特殊对象来区分是否提供了默认参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functools" class="md-nav__link">
    <span class="md-ellipsis">
      functools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="functools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functoolspartial" class="md-nav__link">
    <span class="md-ellipsis">
      functools.partial()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functoolslru_cache" class="md-nav__link">
    <span class="md-ellipsis">
      functools.lru_cache()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      案例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lambda" class="md-nav__link">
    <span class="md-ellipsis">
      你没有那么需要lambda
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      装饰器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="装饰器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functoolswraps" class="md-nav__link">
    <span class="md-ellipsis">
      使用functools.wraps()修饰包装函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      装饰器实现可选参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      用类实现装饰器(函数替换)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      用类实现装饰器(实例替换)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      用类实现带有参数的装饰器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrapt" class="md-nav__link">
    <span class="md-ellipsis">
      使用wrapt模块助力装饰器编写
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      面向对象编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="面向对象编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      修改实例字典数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property" class="md-nav__link">
    <span class="md-ellipsis">
      property 属性对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      鸭子类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      抽象类
    </span>
  </a>
  
    <nav class="md-nav" aria-label="抽象类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      其它功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixin" class="md-nav__link">
    <span class="md-ellipsis">
      Mixin模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      继承
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#__init_subclass" class="md-nav__link">
    <span class="md-ellipsis">
      使用__init_subclass替代元类
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      在分支中寻找多态的应用时机
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      有序组织你的类方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      函数搭配，干活不累
    </span>
  </a>
  
    <nav class="md-nav" aria-label="函数搭配，干活不累">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      用函数降低API使用成本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      实现预绑定方法模式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      面向对象设计原则(上)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="面向对象设计原则(上)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      类型注解基础
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ocp-" class="md-nav__link">
    <span class="md-ellipsis">
      OCP：开放-关闭原则
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    <span class="md-ellipsis">
      数据模型与描述符
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据模型与描述符">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    <span class="md-ellipsis">
      字符串魔法方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="字符串魔法方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repr____str" class="md-nav__link">
    <span class="md-ellipsis">
      repr__和__str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format" class="md-nav__link">
    <span class="md-ellipsis">
      format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    <span class="md-ellipsis">
      比较重载运算符
    </span>
  </a>
  
    <nav class="md-nav" aria-label="比较重载运算符">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#total_ordering" class="md-nav__link">
    <span class="md-ellipsis">
      使用@total_ordering简化描述符的编写
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    <span class="md-ellipsis">
      描述符
    </span>
  </a>
  
    <nav class="md-nav" aria-label="描述符">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#__get__" class="md-nav__link">
    <span class="md-ellipsis">
      __get__方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#__set__" class="md-nav__link">
    <span class="md-ellipsis">
      __set__方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#__delete__" class="md-nav__link">
    <span class="md-ellipsis">
      __delete__方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_name" class="md-nav__link">
    <span class="md-ellipsis">
      set_name 方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    <span class="md-ellipsis">
      数据描述符与非数据描述符
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7nuitka%E7%9A%84%E4%BD%BF%E7%94%A8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    打包工具nuitka的使用
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3" >
        
          
          <label class="md-nav__link" for="__nav_6_1_3" id="__nav_6_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SQL基础教程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3">
            <span class="md-nav__icon md-icon"></span>
            SQL基础教程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B_%E7%AC%AC%E4%B8%80%E7%AB%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL基础教程 第一章
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B_%E7%AC%AC%E4%B8%89%E7%AB%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL基础教程 第三章
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B_%E7%AC%AC%E4%BA%8C%E7%AB%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL基础教程 第二章
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B_%E7%AC%AC%E4%BA%94%E7%AB%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL基础教程 第五章
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/SQL%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B_%E7%AC%AC%E5%9B%9B%E7%AB%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SQL基础教程 第四章
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      变量与注释
    </span>
  </a>
  
    <nav class="md-nav" aria-label="变量与注释">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      变量解包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      给变量注明类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pep8" class="md-nav__link">
    <span class="md-ellipsis">
      遵循PEP8原则
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      数值与字符串
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数值与字符串">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      浮点数精度问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      布尔值也是数字
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      字符串当序列操作
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      字符串格式化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      拼接多个字符串
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      不常用但特别好用的字符串方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="不常用但特别好用的字符串方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#isdigit" class="md-nav__link">
    <span class="md-ellipsis">
      isdigit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#partition" class="md-nav__link">
    <span class="md-ellipsis">
      partition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#translate" class="md-nav__link">
    <span class="md-ellipsis">
      translate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      枚举类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todo-sqlalchemy" class="md-nav__link">
    <span class="md-ellipsis">
      todo 使用SQLAlchemy模块改写代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jinja2" class="md-nav__link">
    <span class="md-ellipsis">
      使用Jinja2 模块处理字符串
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      使用特殊数字: "无穷大"
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      改善长字符串的可读性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      不包含多行字符串右边的空格
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      容器类型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="容器类型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      没有“元组推导式”
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      具名元组
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setdefault" class="md-nav__link">
    <span class="md-ellipsis">
      使用setdefault获取并修改
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pop" class="md-nav__link">
    <span class="md-ellipsis">
      用pop删除不存在的键
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      字典推导式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      字典无序性和有序性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      集合
    </span>
  </a>
  
    <nav class="md-nav" aria-label="集合">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      集合运算
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      浅拷贝和深拷贝
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      案例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      避开列表性能陷阱
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      使用集合判断成员是否存在
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      掌握快速合并字典
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      使用有序字典进行去重
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      不要在遍历列表时同步修改
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nametuple" class="md-nav__link">
    <span class="md-ellipsis">
      让函数返回NameTuple
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      条件分支控制流
    </span>
  </a>
  
    <nav class="md-nav" aria-label="条件分支控制流">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      修改对象的布尔值
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#noneis" class="md-nav__link">
    <span class="md-ellipsis">
      与None比较时使用is运算符
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      案例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anyall" class="md-nav__link">
    <span class="md-ellipsis">
      使用any()/all()函数构建条件表达式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      异常与错误处理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="异常与错误处理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raise" class="md-nav__link">
    <span class="md-ellipsis">
      使用空raise语句
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      抛出异常，而不是返回错误
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      上下文管理器忽略异常
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contextmanager" class="md-nav__link">
    <span class="md-ellipsis">
      使用contextmanager装饰器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      不要手动校验数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      抛出可区分的异常
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      空对象模式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      循环与可迭代对象
    </span>
  </a>
  
    <nav class="md-nav" aria-label="循环与可迭代对象">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      迭代器与可迭代对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      生成器是迭代器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#itertools" class="md-nav__link">
    <span class="md-ellipsis">
      使用itertools模块优化循环
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用itertools模块优化循环">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#product" class="md-nav__link">
    <span class="md-ellipsis">
      使用product()扁平化多层嵌套循环
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#islice" class="md-nav__link">
    <span class="md-ellipsis">
      使用islice()实现循环内隔行处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#takewhilebreak" class="md-nav__link">
    <span class="md-ellipsis">
      使用takewhile()替代break语句
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      案例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nextkey" class="md-nav__link">
    <span class="md-ellipsis">
      巧用next函数获取字典第一个key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      当心已被耗尽的生成器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      函数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="函数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      定义特殊对象来区分是否提供了默认参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functools" class="md-nav__link">
    <span class="md-ellipsis">
      functools
    </span>
  </a>
  
    <nav class="md-nav" aria-label="functools">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functoolspartial" class="md-nav__link">
    <span class="md-ellipsis">
      functools.partial()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functoolslru_cache" class="md-nav__link">
    <span class="md-ellipsis">
      functools.lru_cache()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      案例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lambda" class="md-nav__link">
    <span class="md-ellipsis">
      你没有那么需要lambda
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      装饰器
    </span>
  </a>
  
    <nav class="md-nav" aria-label="装饰器">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#functoolswraps" class="md-nav__link">
    <span class="md-ellipsis">
      使用functools.wraps()修饰包装函数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      装饰器实现可选参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      用类实现装饰器(函数替换)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      用类实现装饰器(实例替换)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      用类实现带有参数的装饰器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wrapt" class="md-nav__link">
    <span class="md-ellipsis">
      使用wrapt模块助力装饰器编写
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      面向对象编程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="面向对象编程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      修改实例字典数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#property" class="md-nav__link">
    <span class="md-ellipsis">
      property 属性对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      鸭子类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      抽象类
    </span>
  </a>
  
    <nav class="md-nav" aria-label="抽象类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      其它功能
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mixin" class="md-nav__link">
    <span class="md-ellipsis">
      Mixin模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      继承
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#__init_subclass" class="md-nav__link">
    <span class="md-ellipsis">
      使用__init_subclass替代元类
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      在分支中寻找多态的应用时机
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      有序组织你的类方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      函数搭配，干活不累
    </span>
  </a>
  
    <nav class="md-nav" aria-label="函数搭配，干活不累">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      用函数降低API使用成本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      实现预绑定方法模式
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      面向对象设计原则(上)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="面向对象设计原则(上)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      类型注解基础
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ocp-" class="md-nav__link">
    <span class="md-ellipsis">
      OCP：开放-关闭原则
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    <span class="md-ellipsis">
      数据模型与描述符
    </span>
  </a>
  
    <nav class="md-nav" aria-label="数据模型与描述符">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    <span class="md-ellipsis">
      字符串魔法方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="字符串魔法方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repr____str" class="md-nav__link">
    <span class="md-ellipsis">
      repr__和__str
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#format" class="md-nav__link">
    <span class="md-ellipsis">
      format
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    <span class="md-ellipsis">
      比较重载运算符
    </span>
  </a>
  
    <nav class="md-nav" aria-label="比较重载运算符">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#total_ordering" class="md-nav__link">
    <span class="md-ellipsis">
      使用@total_ordering简化描述符的编写
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    <span class="md-ellipsis">
      描述符
    </span>
  </a>
  
    <nav class="md-nav" aria-label="描述符">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#__get__" class="md-nav__link">
    <span class="md-ellipsis">
      __get__方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#__set__" class="md-nav__link">
    <span class="md-ellipsis">
      __set__方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#__delete__" class="md-nav__link">
    <span class="md-ellipsis">
      __delete__方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set_name" class="md-nav__link">
    <span class="md-ellipsis">
      set_name 方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    <span class="md-ellipsis">
      数据描述符与非数据描述符
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Python工匠学习笔记</h1>

<h2 id="_1">变量与注释<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="_2">变量解包<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>在变量赋值语句添加小括号，可以一次性展开多层嵌套数据：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;xiaoming&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">]]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">user_id</span><span class="p">,</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="o">=</span> <span class="n">attrs</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">username</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="s1">&#39;xiaoming&#39;</span>
</code></pre></div></td></tr></table></div></p>
<p>用星号表达式(*variables)作为变量名，它会贪婪地捕获多个值：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;piglei&quot;</span><span class="p">,</span> <span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;banana&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">username</span><span class="p">,</span> <span class="o">*</span><span class="n">fruits</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">data</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">fruits</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div></p>
<p>解包也可以用在循环里面：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="k">for</span> <span class="n">username</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="p">[(</span><span class="s2">&quot;piglei&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;raymond&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)]:</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="n">piglei</span> <span class="mi">100</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="n">raymond</span> <span class="mi">60</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_3">给变量注明类型<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span>
<span class="normal"><a href="#__codelineno-3-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">remove_invalid</span><span class="p">(</span><span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="s2">    ...:     剔除items里面无效元素</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="s2">    ...:     &quot;&quot;&quot;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>    <span class="o">...</span><span class="p">:</span>  
</code></pre></div></td></tr></table></div>
<h3 id="pep8">遵循PEP8原则<a class="headerlink" href="#pep8" title="Permanent link">&para;</a></h3>
<ul>
<li>对于普通变量，使用蛇形命名法，比如max_value</li>
<li>对于常量，采用全大写字母，使用下划线连接，比如MAX_VALUE</li>
<li>如果变量标记为”仅内部使用“，为其增加下划线前缀，比如_local_var</li>
<li>当名字与Python关键字冲突时，在变量末尾追加下划线，比如class_</li>
<li>...
PEP8还有许多其它命名规范，比如类名应该使用驼峰风格(FooClass)，函数应该使用蛇形风格（bar_function）等等</li>
</ul>
<h2 id="_4">数值与字符串<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>在定义数值字面量时，如果数字特别长，可以通过_分隔符来让它变得更易读：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1_000_000</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">1000001</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_5">浮点数精度问题<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0.1&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0.2&quot;</span><span class="p">)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;0.3&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_6">布尔值也是数字<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="nb">int</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>计算一个列表有多少个偶数可以用下面的方式：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">)</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">3</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_7">字符串当序列操作<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>反转字符串：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;hello,world&quot;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">s</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;dlrow,olleh&#39;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="s1">&#39;dlrow,olleh&#39;</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_8">字符串格式化<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>str.format和f-string共享了同一种复杂的“字符串格式化微语言”，通过这种微语言，我们可以方便地对字符串进行二次加工，然后输出，比如：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s2">&quot;</span><span class="si">{:&gt;20}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="s1">&#39;              yanghe&#39;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&gt;20</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="s1">&#39;              yanghe&#39;</span>
</code></pre></div></td></tr></table></div></p>
<p>虽然f-string抢走str.format的大部分风头，但是后者仍然有着自己独到之处，比如str.format支持用位置参数来格式化字符串，实现对参数的重复使用：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="s2">&quot;</span><span class="si">{0}</span><span class="s2">: name=</span><span class="si">{0}</span><span class="s2"> socre=</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;yanghe&quot;</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="s1">&#39;yanghe: name=yanghe socre=100&#39;</span>
</code></pre></div></td></tr></table></div></p>
<p>更多信息查看官方的<strong>Format Specification Mini-Language</strong>
<a href="https://docs.python.org/3/library/string.html">string — Common string operations — Python 3.11.1 documentation</a></p>
<h3 id="_9">拼接多个字符串<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value: </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="n">Numbers</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">3</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">4</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">5</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">6</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">7</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">8</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">9</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">10</span>
</code></pre></div></td></tr></table></div>
<p>也可以这么干：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Numbers(1-10):&quot;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Value: </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="n">Numbers</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">10</span><span class="p">):</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">3</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">4</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">5</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">6</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">7</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">8</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">9</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="n">Value</span><span class="p">:</span> <span class="mi">10</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_10">不常用但特别好用的字符串方法<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<h4 id="isdigit">isdigit<a class="headerlink" href="#isdigit" title="Permanent link">&para;</a></h4>
<p>判断字符串是不是只包含数字
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="s2">&quot;123&quot;</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="s2">&quot;sss123&quot;</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="kc">False</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="s2">&quot;sssssssssss&quot;</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="partition">partition<a class="headerlink" href="#partition" title="Permanent link">&para;</a></h4>
<p>按指定字符分割，返回value，如果没有指定的字符，那么就返回空字符串
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="s2">&quot;key:value&quot;</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="s1">&#39;value&#39;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="s2">&quot;key&quot;</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="s2">&quot;key&quot;</span><span class="o">.</span><span class="n">partition</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="s1">&#39;&#39;</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="translate">translate<a class="headerlink" href="#translate" title="Permanent link">&para;</a></h4>
<p>替换指定的字符
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span>
<span class="normal"><a href="#__codelineno-15-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;明明是中文, 却用的英文标点.&quot;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="c1"># 创建替换规则表：&#39;,&#39; -&gt; &#39;，&#39; &#39;.&#39; -&gt; &#39;。&#39;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">table</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s2">&quot;,.&quot;</span><span class="p">,</span> <span class="s2">&quot;，。&quot;</span><span class="p">)</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">s</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="s1">&#39;明明是中文， 却用的英文标点。&#39;</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_11">枚举类型<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>常量和枚举类型代替字面量的好处：
- 更易读：所有人都不需要记忆某个数字代表什么
- 更健壮：降低输错数字或字母产生bug的可能性
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">DAILY_POINTS_REWARDS</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="n">VIP_EXTRA_POINTS</span> <span class="o">=</span> <span class="mi">20</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="k">class</span> <span class="nc">UserType</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>    <span class="n">VIP</span> <span class="o">=</span> <span class="mi">3</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>    <span class="n">BANNED</span> <span class="o">=</span> <span class="mi">13</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="k">def</span> <span class="nf">add_daily_points</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">UserType</span><span class="o">.</span><span class="n">BANNED</span><span class="p">:</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a>        <span class="k">return</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a>    <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">UserType</span><span class="o">.</span><span class="n">VIP</span><span class="p">:</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a>        <span class="n">user</span><span class="o">.</span><span class="n">points</span> <span class="o">+=</span> <span class="n">DAILY_POINTS_REWARDS</span> <span class="o">+</span> <span class="n">VIP_EXTRA_POINTS</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a>        <span class="k">return</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a>    <span class="n">user</span><span class="o">.</span><span class="n">points</span> <span class="o">+=</span> <span class="n">DAILY_POINTS_REWARDS</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a>    <span class="k">return</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="todo-sqlalchemy">todo 使用SQLAlchemy模块改写代码<a class="headerlink" href="#todo-sqlalchemy" title="Permanent link">&para;</a></h3>
<h3 id="jinja2">使用Jinja2 模块处理字符串<a class="headerlink" href="#jinja2" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">from</span> <span class="nn">jinja2</span> <span class="kn">import</span> <span class="n">Template</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="n">_MOVIES_TEPL</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="s1">Welcome, {{ username }}.</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="s1">{</span><span class="si">%f</span><span class="s1">or name, rating in movies %}</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="s1">* {{ name }}, rating: {{ rating|defult(&quot;[NOT RATED]&quot;, True) }}</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="s1">{</span><span class="si">%- e</span><span class="s1">ndfor %}</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="s1">&#39;&#39;&#39;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="k">def</span> <span class="nf">rander_movies_j2</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">movies</span><span class="p">):</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>    <span class="n">tmpl</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">_MOVIES_TEPL</span><span class="p">)</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>    <span class="k">return</span> <span class="n">tmpl</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">movies</span><span class="o">=</span><span class="n">movies</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_12">使用特殊数字: "无穷大"<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p><code>float("inf")</code>和<code>float("-inf")</code>，这两个值代表数学世界里的正负无穷大。比如有包含用户名和年龄的字典，我需要把里面的用户名按照年龄顺序排序，没有提供年龄的放到后面，使用<code>float(inf)</code>可以这么写：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">def</span> <span class="nf">sort_users_inf</span><span class="p">(</span><span class="n">users</span><span class="p">):</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>    <span class="k">def</span> <span class="nf">key_func</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>        <span class="n">age</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>        <span class="c1"># 当年龄为空时，发挥无穷大作为key，所以就会排到最后</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>        <span class="k">return</span> <span class="n">age</span> <span class="k">if</span> <span class="n">age</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">key_func</span><span class="p">)</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tom&quot;</span><span class="p">:</span><span class="mi">19</span><span class="p">,</span> <span class="s2">&quot;jenny&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;jack&quot;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;andrew&quot;</span><span class="p">:</span><span class="mi">43</span><span class="p">}</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="nb">print</span><span class="p">(</span><span class="n">sort_users_inf</span><span class="p">(</span><span class="n">users</span><span class="p">))</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="c1"># output:</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="c1"># [&quot;jenny&quot;, &quot;tom&quot;, &quot;andrew&quot;, &quot;jack&quot;]</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_13">改善长字符串的可读性<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;This is the first line of a long string&quot;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>   <span class="o">...</span><span class="p">:</span> <span class="s2">&quot;this is the second line&quot;</span><span class="p">)</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">loguru</span> <span class="kn">import</span> <span class="n">logger</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">16</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mf">47.406</span> <span class="o">|</span> <span class="n">INFO</span>     <span class="o">|</span> <span class="n">__main__</span><span class="p">:</span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span> <span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">line</span> <span class="n">of</span> <span class="n">a</span> <span class="n">long</span> <span class="n">stringthis</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">second</span> <span class="n">line</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;This is something really bad happened during the process.&quot;</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>   <span class="o">...</span><span class="p">:</span> <span class="s2">&quot;Please contact your administrator.&quot;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>   <span class="o">...</span><span class="p">:</span> <span class="p">)</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="mi">2023</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">02</span> <span class="mi">16</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mf">40.424</span> <span class="o">|</span> <span class="n">INFO</span>     <span class="o">|</span> <span class="n">__main__</span><span class="p">:</span><span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1</span> <span class="o">-</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">something</span> <span class="n">really</span> <span class="n">bad</span> <span class="n">happened</span> <span class="n">during</span> <span class="n">the</span> <span class="n">process</span><span class="o">.</span><span class="n">Please</span> <span class="n">contact</span> <span class="n">your</span> <span class="n">administrator</span><span class="o">.</span>
</code></pre></div></td></tr></table></div>
<h3 id="_14">不包含多行字符串右边的空格<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>可以使用标准库 textwarp来解决这个问题：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">message</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="s2">   ...:         Welcome, today&#39;s movie list:</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="s2">   ...:         - Jaw (1975)</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="s2">   ...:         - The Shining (1980)</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="s2">   ...:         - Saw (2004)&quot;&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">main</span><span class="p">()</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="n">Welcome</span><span class="p">,</span> <span class="n">today</span><span class="s1">&#39;s movie list:</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="o">-</span> <span class="n">Jaw</span> <span class="p">(</span><span class="mi">1975</span><span class="p">)</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="o">-</span> <span class="n">The</span> <span class="n">Shining</span> <span class="p">(</span><span class="mi">1980</span><span class="p">)</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="o">-</span> <span class="n">Saw</span> <span class="p">(</span><span class="mi">2004</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="_15">容器类型<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<h3 id="_16">没有“元组推导式”<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">results</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">results</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="o">&lt;</span><span class="n">genexpr</span><span class="o">&gt;</span> <span class="n">at</span> <span class="mh">0x000001F79C72A180</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>虽然无法通过推导式直接拿到元组，但生成器仍然是一种可迭代类型，所以我们还是可以对他调用tuple()函数，获取元组：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">results</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">n</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">results</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_17">具名元组<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>除了用逗号来分隔具名元组的字段名称以外，还可以用空格分隔：<code>'width height'</code>， 或者直接使用一个字符串列表：<code>['width','height']</code>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">Rectangle</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Rectangle&#39;</span><span class="p">,</span><span class="s1">&#39;width,height&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">rect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="mi">100</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="mi">100</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="ne">AttributeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="ne">AttributeError</span><span class="p">:</span> <span class="n">can</span><span class="s1">&#39;t set attribute</span>
</code></pre></div></td></tr></table></div>
<p>在Python3.6版本以后，除了使用<code>namedtuple()</code>函数以外，你还可以使用<code>typing.NamedTuple</code>和类型注解语法来定义具名元组类型，这种方式在可读性上更胜一筹：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Rectangle</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">width</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">height</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="setdefault">使用setdefault获取并修改<a class="headerlink" href="#setdefault" title="Permanent link">&para;</a></h3>
<p>调用dict.setdefault(key, default)会产生两种结果：
- 当key不存在时，会把default值写入字典的key位置，并返回该值
- key已经存在时，该方法就会直接返回它字典中的对应值</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;foobar&quot;</span><span class="p">}</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">d</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]}</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">d</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]}</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;items&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h3 id="pop">用pop删除不存在的键<a class="headerlink" href="#pop" title="Permanent link">&para;</a></h3>
<p>用del删除不存在的键报<code>KeyError</code>，如果知识单纯地想去掉某个键，不关心它存在与否，删除没有删除成功，那么使用<code>dict.pop(key, defualt)</code>方法就够了
只要在调用pop方法地时候传入默认值<code>None</code>在键不存在的情况下也不会产生任何异常：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>严格来说，pop方法主要用途不是删除某个键，而是删除获取这个键对应的值，pop方法是随机删除的。</p>
<h3 id="_18">字典推导式<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">d1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">:</span><span class="mi">4</span><span class="p">}</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;foo&quot;</span><span class="p">}</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_19">字典无序性和有序性<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>python3.7之前字典是无序的，3.7以后字典是有序的。如果你的python版本没有那么新，也可以从collections模块里方便地拿到另外一个有序字典对象<code>OrderedDict</code>，它可以在Python3.7之前地版本里保证字典有序：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;first_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;second_key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">d</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="n">Out</span><span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;first_key&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;second_key&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
</code></pre></div></td></tr></table></div></p>
<p><code>OrderedDict</code>与新版本地字典有一些区别：
- 新版本字典内容一致而顺序不同的字典被视为相等，因为解释器只对比字典的键和值是否一致
- 同样的OrderedDict被视为不相等，因为“键的顺序”也会作为对比条件
- OrderedDict还有.move_to_end()等普通字典没有的一些方法</p>
<h3 id="_20">集合<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>集合是无序的且是不能重复的
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></p>
<p>集合也有自己的推到式语法：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="p">{</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">}</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>集合是一种可变类型，可以用<code>add</code>方法向集合里添加元素：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span>
<span class="normal"><a href="#__codelineno-32-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">new_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="s2">&quot;bar&quot;</span><span class="p">])</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">new_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;apple&quot;</span><span class="p">)</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">new_set</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>如果需要一个不可变的集合，可以使用内置类型<code>frozenset</code>，它和普通集合相似，知识少了修改集合的方法：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span>
<span class="normal"><a href="#__codelineno-33-5">5</a></span>
<span class="normal"><a href="#__codelineno-33-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">new_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span><span class="s2">&quot;bar&quot;</span><span class="p">])</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">new_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;apple&quot;</span><span class="p">)</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">new_set</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="_21">集合运算<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<p>交集，两个集合共有的元素：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span>
<span class="normal"><a href="#__codelineno-34-5">5</a></span>
<span class="normal"><a href="#__codelineno-34-6">6</a></span>
<span class="normal"><a href="#__codelineno-34-7">7</a></span>
<span class="normal"><a href="#__codelineno-34-8">8</a></span>
<span class="normal"><a href="#__codelineno-34-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">fruits_1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;apple&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;pineapple&quot;</span><span class="p">}</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">fruits_2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tomato&quot;</span><span class="p">,</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;grapes&quot;</span><span class="p">,</span> <span class="s2">&quot;mango&quot;</span><span class="p">}</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">fruits_1</span> <span class="o">&amp;</span> <span class="n">fruits_2</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;orange&#39;</span><span class="p">}</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">fruits_1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">fruits_2</span><span class="p">)</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="n">Out</span><span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;orange&#39;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>并集，两个集合的元素合并起来：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span>
<span class="normal"><a href="#__codelineno-35-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">fruits_1</span> <span class="o">|</span> <span class="n">fruits_2</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;grapes&#39;</span><span class="p">,</span> <span class="s1">&#39;mango&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;pineapple&#39;</span><span class="p">,</span> <span class="s1">&#39;tomato&#39;</span><span class="p">}</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">fruits_1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">fruits_2</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="n">Out</span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;grapes&#39;</span><span class="p">,</span> <span class="s1">&#39;mango&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;pineapple&#39;</span><span class="p">,</span> <span class="s1">&#39;tomato&#39;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>差集，获得前一个集合有，后一个集合没有的元素：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span>
<span class="normal"><a href="#__codelineno-36-4">4</a></span>
<span class="normal"><a href="#__codelineno-36-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="n">fruits_1</span> <span class="o">-</span> <span class="n">fruits_2</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">59</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;pineapple&#39;</span><span class="p">}</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="n">fruits_1</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">fruits_2</span><span class="p">)</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="n">Out</span><span class="p">[</span><span class="mi">60</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;pineapple&#39;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_22">浅拷贝和深拷贝<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p>浅拷贝：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span>
<span class="normal"><a href="#__codelineno-37-4">4</a></span>
<span class="normal"><a href="#__codelineno-37-5">5</a></span>
<span class="normal"><a href="#__codelineno-37-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">61</span><span class="p">]:</span> <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">62</span><span class="p">]:</span> <span class="n">l_copy</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="n">l_copy</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre></div></td></tr></table></div></p>
<p>深拷贝：
在多层列表嵌套的情况下使用浅拷贝会出现以下情况
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">copy</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span><span class="s1">&#39;bar&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">items_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;xxx&#39;</span><span class="p">)</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="n">items</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="n">Out</span><span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;xxx&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a><span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">items_copy</span>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="n">Out</span><span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;xxx&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre></div></td></tr></table></div></p>
<p>使用id()函数来查看他们的对象ID，会发现他们其实是一个对象：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">id</span><span class="p">(</span><span class="n">items_copy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="p">(</span><span class="mi">2163012718912</span><span class="p">,</span> <span class="mi">2163012718912</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>要解决这个问题，可以使用<code>copy.deepcopy()</code>来进行深拷贝操作：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="n">items_deep</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="nb">id</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">id</span><span class="p">(</span><span class="n">items_deep</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="p">(</span><span class="mi">2163012718912</span><span class="p">,</span> <span class="mi">2163032103104</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_23">案例<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span>
<span class="normal"><a href="#__codelineno-41-19">19</a></span>
<span class="normal"><a href="#__codelineno-41-20">20</a></span>
<span class="normal"><a href="#__codelineno-41-21">21</a></span>
<span class="normal"><a href="#__codelineno-41-22">22</a></span>
<span class="normal"><a href="#__codelineno-41-23">23</a></span>
<span class="normal"><a href="#__codelineno-41-24">24</a></span>
<span class="normal"><a href="#__codelineno-41-25">25</a></span>
<span class="normal"><a href="#__codelineno-41-26">26</a></span>
<span class="normal"><a href="#__codelineno-41-27">27</a></span>
<span class="normal"><a href="#__codelineno-41-28">28</a></span>
<span class="normal"><a href="#__codelineno-41-29">29</a></span>
<span class="normal"><a href="#__codelineno-41-30">30</a></span>
<span class="normal"><a href="#__codelineno-41-31">31</a></span>
<span class="normal"><a href="#__codelineno-41-32">32</a></span>
<span class="normal"><a href="#__codelineno-41-33">33</a></span>
<span class="normal"><a href="#__codelineno-41-34">34</a></span>
<span class="normal"><a href="#__codelineno-41-35">35</a></span>
<span class="normal"><a href="#__codelineno-41-36">36</a></span>
<span class="normal"><a href="#__codelineno-41-37">37</a></span>
<span class="normal"><a href="#__codelineno-41-38">38</a></span>
<span class="normal"><a href="#__codelineno-41-39">39</a></span>
<span class="normal"><a href="#__codelineno-41-40">40</a></span>
<span class="normal"><a href="#__codelineno-41-41">41</a></span>
<span class="normal"><a href="#__codelineno-41-42">42</a></span>
<span class="normal"><a href="#__codelineno-41-43">43</a></span>
<span class="normal"><a href="#__codelineno-41-44">44</a></span>
<span class="normal"><a href="#__codelineno-41-45">45</a></span>
<span class="normal"><a href="#__codelineno-41-46">46</a></span>
<span class="normal"><a href="#__codelineno-41-47">47</a></span>
<span class="normal"><a href="#__codelineno-41-48">48</a></span>
<span class="normal"><a href="#__codelineno-41-49">49</a></span>
<span class="normal"><a href="#__codelineno-41-50">50</a></span>
<span class="normal"><a href="#__codelineno-41-51">51</a></span>
<span class="normal"><a href="#__codelineno-41-52">52</a></span>
<span class="normal"><a href="#__codelineno-41-53">53</a></span>
<span class="normal"><a href="#__codelineno-41-54">54</a></span>
<span class="normal"><a href="#__codelineno-41-55">55</a></span>
<span class="normal"><a href="#__codelineno-41-56">56</a></span>
<span class="normal"><a href="#__codelineno-41-57">57</a></span>
<span class="normal"><a href="#__codelineno-41-58">58</a></span>
<span class="normal"><a href="#__codelineno-41-59">59</a></span>
<span class="normal"><a href="#__codelineno-41-60">60</a></span>
<span class="normal"><a href="#__codelineno-41-61">61</a></span>
<span class="normal"><a href="#__codelineno-41-62">62</a></span>
<span class="normal"><a href="#__codelineno-41-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableMapping</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="c1"># 枚举类</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="k">class</span> <span class="nc">PagePerfLevel</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a>    <span class="n">LT_100</span> <span class="o">=</span> <span class="s1">&#39;Less than 100 ms&#39;</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a>    <span class="n">LT_300</span> <span class="o">=</span> <span class="s1">&#39;Between 100 and 300 ms&#39;</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a>    <span class="n">LT_1000</span> <span class="o">=</span> <span class="s1">&#39;Between 300ms and 1s&#39;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a>    <span class="n">GT_1000</span> <span class="o">=</span> <span class="s1">&#39;Greater than 1 s&#39;</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="k">class</span> <span class="nc">PerfLevelDict</span><span class="p">(</span><span class="n">MutableMapping</span><span class="p">):</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;存储响应时间性能字典&quot;&quot;&quot;</span><span class="s2">&quot;</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;当某个心梗你等级不存在时，默认返回 0&quot;&quot;&quot;</span>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_level</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;将key转换为对应的性能等级，然后设置值&quot;&quot;&quot;</span>
<a id="__codelineno-41-21" name="__codelineno-41-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_level</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-41-22" name="__codelineno-41-22"></a>    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<a id="__codelineno-41-23" name="__codelineno-41-23"></a>        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<a id="__codelineno-41-24" name="__codelineno-41-24"></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-41-25" name="__codelineno-41-25"></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<a id="__codelineno-41-26" name="__codelineno-41-26"></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-41-27" name="__codelineno-41-27"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;按照顺序返回性能等级数据&quot;&quot;&quot;</span>
<a id="__codelineno-41-28" name="__codelineno-41-28"></a>        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span>
<a id="__codelineno-41-29" name="__codelineno-41-29"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
<a id="__codelineno-41-30" name="__codelineno-41-30"></a>            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pair</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">PagePerfLevel</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-41-31" name="__codelineno-41-31"></a>        <span class="p">)</span>
<a id="__codelineno-41-32" name="__codelineno-41-32"></a>    <span class="k">def</span> <span class="nf">total_requests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-41-33" name="__codelineno-41-33"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;返回总请求数&quot;&quot;&quot;</span>
<a id="__codelineno-41-34" name="__codelineno-41-34"></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a id="__codelineno-41-35" name="__codelineno-41-35"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-41-36" name="__codelineno-41-36"></a>    <span class="k">def</span> <span class="nf">compute_level</span><span class="p">(</span><span class="n">time_cost_str</span><span class="p">):</span>
<a id="__codelineno-41-37" name="__codelineno-41-37"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;根据相应时间计算性能等级&quot;&quot;&quot;</span>
<a id="__codelineno-41-38" name="__codelineno-41-38"></a>        <span class="k">if</span> <span class="n">time_cost_str</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">PagePerfLevel</span><span class="p">):</span>
<a id="__codelineno-41-39" name="__codelineno-41-39"></a>            <span class="k">return</span> <span class="n">time_cost_str</span>
<a id="__codelineno-41-40" name="__codelineno-41-40"></a>        <span class="n">time_const</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_cost_str</span><span class="p">)</span>
<a id="__codelineno-41-41" name="__codelineno-41-41"></a>        <span class="k">if</span> <span class="n">time_cost</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
<a id="__codelineno-41-42" name="__codelineno-41-42"></a>            <span class="k">return</span> <span class="n">PagePerfLevel</span><span class="o">.</span><span class="n">LT_100</span>
<a id="__codelineno-41-43" name="__codelineno-41-43"></a>        <span class="k">elif</span> <span class="n">time_cost</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">:</span>
<a id="__codelineno-41-44" name="__codelineno-41-44"></a>            <span class="k">return</span> <span class="n">PagePerfLevel</span><span class="o">.</span><span class="n">LT_300</span>
<a id="__codelineno-41-45" name="__codelineno-41-45"></a>        <span class="k">elif</span> <span class="n">time_cost</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
<a id="__codelineno-41-46" name="__codelineno-41-46"></a>            <span class="k">return</span> <span class="n">PagePerfLevel</span><span class="o">.</span><span class="n">LT_1000</span>
<a id="__codelineno-41-47" name="__codelineno-41-47"></a>        <span class="k">return</span> <span class="n">PagePerfLevel</span><span class="o">.</span><span class="n">GT_1000</span>
<a id="__codelineno-41-48" name="__codelineno-41-48"></a><span class="k">def</span> <span class="nf">analyze_v2</span><span class="p">():</span>
<a id="__codelineno-41-49" name="__codelineno-41-49"></a>    <span class="n">path_groups</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">PerfLevelDict</span><span class="p">)</span>
<a id="__codelineno-41-50" name="__codelineno-41-50"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;logs.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-41-51" name="__codelineno-41-51"></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-41-52" name="__codelineno-41-52"></a>            <span class="n">path</span><span class="p">,</span> <span class="n">time_cost</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a id="__codelineno-41-53" name="__codelineno-41-53"></a>            <span class="n">path_groups</span><span class="p">[</span><span class="n">path</span><span class="p">][</span><span class="n">time_cost</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-41-54" name="__codelineno-41-54"></a>    <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">path_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-41-55" name="__codelineno-41-55"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;=== Path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-41-56" name="__codelineno-41-56"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Total requests: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">total_requests</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-41-57" name="__codelineno-41-57"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Performance:&quot;</span><span class="p">)</span>
<a id="__codelineno-41-58" name="__codelineno-41-58"></a>        <span class="k">for</span> <span class="n">level_name</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-41-59" name="__codelineno-41-59"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - </span><span class="si">{</span><span class="n">level_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-41-60" name="__codelineno-41-60"></a>
<a id="__codelineno-41-61" name="__codelineno-41-61"></a>
<a id="__codelineno-41-62" name="__codelineno-41-62"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-41-63" name="__codelineno-41-63"></a>    <span class="n">analyze_v2</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><a href="https://treyhunner.com/2019/04/why-you-shouldnt-inherit-from-list-and-dict-in-python/">在 Python 中从字典和列表继承的问题 (treyhunner.com)</a></li>
</ul>
<h3 id="_24">避开列表性能陷阱<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span>
<span class="normal"><a href="#__codelineno-42-20">20</a></span>
<span class="normal"><a href="#__codelineno-42-21">21</a></span>
<span class="normal"><a href="#__codelineno-42-22">22</a></span>
<span class="normal"><a href="#__codelineno-42-23">23</a></span>
<span class="normal"><a href="#__codelineno-42-24">24</a></span>
<span class="normal"><a href="#__codelineno-42-25">25</a></span>
<span class="normal"><a href="#__codelineno-42-26">26</a></span>
<span class="normal"><a href="#__codelineno-42-27">27</a></span>
<span class="normal"><a href="#__codelineno-42-28">28</a></span>
<span class="normal"><a href="#__codelineno-42-29">29</a></span>
<span class="normal"><a href="#__codelineno-42-30">30</a></span>
<span class="normal"><a href="#__codelineno-42-31">31</a></span>
<span class="normal"><a href="#__codelineno-42-32">32</a></span>
<span class="normal"><a href="#__codelineno-42-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">89</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">list_append</span><span class="p">():</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;不断往末尾追加&quot;&quot;&quot;</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">90</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">list_insert</span><span class="p">():</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;不断往头部插入&quot;&quot;&quot;</span>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">l</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="n">In</span> <span class="p">[</span><span class="mi">91</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">timeit</span>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a>
<a id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="n">In</span> <span class="p">[</span><span class="mi">92</span><span class="p">]:</span> <span class="n">append_spent</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span>
<a id="__codelineno-42-18" name="__codelineno-42-18"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">setup</span><span class="o">=</span><span class="s1">&#39;from __main__ import list_append&#39;</span><span class="p">,</span>
<a id="__codelineno-42-19" name="__codelineno-42-19"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">stmt</span><span class="o">=</span><span class="s1">&#39;list_append()&#39;</span><span class="p">,</span>
<a id="__codelineno-42-20" name="__codelineno-42-20"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">number</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<a id="__codelineno-42-21" name="__codelineno-42-21"></a>    <span class="o">...</span><span class="p">:</span> <span class="p">)</span>
<a id="__codelineno-42-22" name="__codelineno-42-22"></a>
<a id="__codelineno-42-23" name="__codelineno-42-23"></a><span class="n">In</span> <span class="p">[</span><span class="mi">93</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;list_append:&quot;</span><span class="p">,</span> <span class="n">append_spent</span><span class="p">)</span>
<a id="__codelineno-42-24" name="__codelineno-42-24"></a><span class="n">list_append</span><span class="p">:</span> <span class="mf">3.082703800057061</span>
<a id="__codelineno-42-25" name="__codelineno-42-25"></a>
<a id="__codelineno-42-26" name="__codelineno-42-26"></a><span class="n">In</span> <span class="p">[</span><span class="mi">94</span><span class="p">]:</span> <span class="n">insert_spent</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span>
<a id="__codelineno-42-27" name="__codelineno-42-27"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">setup</span><span class="o">=</span><span class="s1">&#39;from __main__ import list_insert&#39;</span><span class="p">,</span>
<a id="__codelineno-42-28" name="__codelineno-42-28"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">stmt</span><span class="o">=</span><span class="s1">&#39;list_insert()&#39;</span><span class="p">,</span>
<a id="__codelineno-42-29" name="__codelineno-42-29"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">number</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<a id="__codelineno-42-30" name="__codelineno-42-30"></a>    <span class="o">...</span><span class="p">:</span> <span class="p">)</span>
<a id="__codelineno-42-31" name="__codelineno-42-31"></a>
<a id="__codelineno-42-32" name="__codelineno-42-32"></a><span class="n">In</span> <span class="p">[</span><span class="mi">95</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;list_insert:&quot;</span><span class="p">,</span> <span class="n">insert_spent</span><span class="p">)</span>
<a id="__codelineno-42-33" name="__codelineno-42-33"></a><span class="n">list_insert</span><span class="p">:</span> <span class="mf">65.8692352999933</span>
</code></pre></div></td></tr></table></div>
<p>这个性能差距与列表的底层实现有关，Python在实现列表使用了数组（array）数据结构。这种结构最大的一个特点是，当你在数组中插入新成员时，该成员之后的其它成员都要移动位置，该操作平均时间复杂度是O(n)，因此，在列表的头部插入成员，比在尾部追加要慢的多，后者的时间复杂度为O(1)</p>
<p>如果经常需要往表头插入数据，请使用<code>collections.deque</code>类型来替代列表，因为<code>deque</code>底层使用了双端队列，无论在头部还是尾部追加成员，时间复杂度都是O(1)
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span>
<span class="normal"><a href="#__codelineno-43-23">23</a></span>
<span class="normal"><a href="#__codelineno-43-24">24</a></span>
<span class="normal"><a href="#__codelineno-43-25">25</a></span>
<span class="normal"><a href="#__codelineno-43-26">26</a></span>
<span class="normal"><a href="#__codelineno-43-27">27</a></span>
<span class="normal"><a href="#__codelineno-43-28">28</a></span>
<span class="normal"><a href="#__codelineno-43-29">29</a></span>
<span class="normal"><a href="#__codelineno-43-30">30</a></span>
<span class="normal"><a href="#__codelineno-43-31">31</a></span>
<span class="normal"><a href="#__codelineno-43-32">32</a></span>
<span class="normal"><a href="#__codelineno-43-33">33</a></span>
<span class="normal"><a href="#__codelineno-43-34">34</a></span>
<span class="normal"><a href="#__codelineno-43-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">deque_append</span><span class="p">():</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;不断往尾部追加&quot;&quot;&quot;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">l</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">deque_appendleft</span><span class="p">():</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;不断往头部插入&quot;&quot;&quot;</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">l</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">l</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a><span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="n">append_spent</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">setup</span><span class="o">=</span><span class="s1">&#39;from __main__ import deque_append&#39;</span><span class="p">,</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">stmt</span><span class="o">=</span><span class="s1">&#39;deque_append()&#39;</span><span class="p">,</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a>    <span class="o">...</span><span class="p">:</span> <span class="n">number</span><span class="o">=</span><span class="mi">10000</span>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a>    <span class="o">...</span><span class="p">:</span> <span class="p">)</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-43-24" name="__codelineno-43-24"></a>
<a id="__codelineno-43-25" name="__codelineno-43-25"></a><span class="n">In</span> <span class="p">[</span><span class="mi">102</span><span class="p">]:</span> <span class="n">appendleft_spent</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span>
<a id="__codelineno-43-26" name="__codelineno-43-26"></a>     <span class="o">...</span><span class="p">:</span> <span class="n">setup</span><span class="o">=</span><span class="s1">&#39;from __main__ import deque_appendleft&#39;</span><span class="p">,</span>
<a id="__codelineno-43-27" name="__codelineno-43-27"></a>     <span class="o">...</span><span class="p">:</span> <span class="n">stmt</span><span class="o">=</span><span class="s1">&#39;deque_appendleft&#39;</span><span class="p">,</span>
<a id="__codelineno-43-28" name="__codelineno-43-28"></a>     <span class="o">...</span><span class="p">:</span> <span class="n">number</span><span class="o">=</span><span class="mi">10000</span>
<a id="__codelineno-43-29" name="__codelineno-43-29"></a>     <span class="o">...</span><span class="p">:</span> <span class="p">)</span>
<a id="__codelineno-43-30" name="__codelineno-43-30"></a>
<a id="__codelineno-43-31" name="__codelineno-43-31"></a><span class="n">In</span> <span class="p">[</span><span class="mi">103</span><span class="p">]:</span> <span class="n">append_spent</span>
<a id="__codelineno-43-32" name="__codelineno-43-32"></a><span class="n">Out</span><span class="p">[</span><span class="mi">103</span><span class="p">]:</span> <span class="mf">2.6960844999412075</span>
<a id="__codelineno-43-33" name="__codelineno-43-33"></a>
<a id="__codelineno-43-34" name="__codelineno-43-34"></a><span class="n">In</span> <span class="p">[</span><span class="mi">104</span><span class="p">]:</span> <span class="n">appendleft_spent</span>
<a id="__codelineno-43-35" name="__codelineno-43-35"></a><span class="n">Out</span><span class="p">[</span><span class="mi">104</span><span class="p">]:</span> <span class="mf">0.0001558999065309763</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_25">使用集合判断成员是否存在<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<p>在列表中搜索，有点像在一本没有目录的书找一个单词，因为不知道在哪，只能一页一页翻着看。完成这种操作需要的时间复杂度是O(n)。
在集合中搜索，就像通过字典查字，我们先按照字的拼音从索引找到它所在的页码，然后直接翻到那一页，完成这种操作需要时间复杂度是O(1)</p>
<p><strong>注意：这里的列表很短，所以转不转集合对性能影响都微乎其微，在实际编码过程中，列表越长，执行判断次数越多，转成集合的收益就越高</strong>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span>
<span class="normal"><a href="#__codelineno-44-3">3</a></span>
<span class="normal"><a href="#__codelineno-44-4">4</a></span>
<span class="normal"><a href="#__codelineno-44-5">5</a></span>
<span class="normal"><a href="#__codelineno-44-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="n">VALID_NAMES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;piglei&quot;</span><span class="p">,</span><span class="s2">&quot;raymond&quot;</span><span class="p">,</span><span class="s2">&quot;bojack&quot;</span><span class="p">,</span><span class="s2">&quot;caroline&quot;</span><span class="p">]</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="n">VALID_NAMES_SET</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">VALID_NAMES</span><span class="p">)</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="k">def</span> <span class="nf">validate_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a>    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">VALID_NAMES_SET</span><span class="p">:</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> is not a valid name!&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>除了上面这些陷阱，了解更多与常见容器操作的时间复杂度有关的内容可以参考官方wiki
- <a href="https://wiki.python.org/moin/TimeComplexity">TimeComplexity - Python Wiki</a></p>
<h3 id="_26">掌握快速合并字典<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>方式一，使用双星号<code>**</code>运算符来做解包操作：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span>
<span class="normal"><a href="#__codelineno-45-3">3</a></span>
<span class="normal"><a href="#__codelineno-45-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">112</span><span class="p">]:</span> <span class="n">d1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;k1&quot;</span><span class="p">:</span><span class="s2">&quot;v1&quot;</span><span class="p">}</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="p">{</span><span class="s2">&quot;k2&quot;</span><span class="p">:</span><span class="s2">&quot;v2&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">d1</span><span class="p">}</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">113</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;k2&#39;</span><span class="p">:</span> <span class="s1">&#39;v2&#39;</span><span class="p">,</span> <span class="s1">&#39;k1&#39;</span><span class="p">:</span> <span class="s1">&#39;v1&#39;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>除了使用<code>**</code>解包字典，还可以使用单<code>*</code>型号运算符解包任何可迭代对象：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span>
<span class="normal"><a href="#__codelineno-46-2">2</a></span>
<span class="normal"><a href="#__codelineno-46-3">3</a></span>
<span class="normal"><a href="#__codelineno-46-4">4</a></span>
<span class="normal"><a href="#__codelineno-46-5">5</a></span>
<span class="normal"><a href="#__codelineno-46-6">6</a></span>
<span class="normal"><a href="#__codelineno-46-7">7</a></span>
<span class="normal"><a href="#__codelineno-46-8">8</a></span>
<span class="normal"><a href="#__codelineno-46-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">114</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">115</span><span class="p">]:</span> <span class="n">l1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">116</span><span class="p">]:</span> <span class="n">l2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="p">[</span><span class="o">*</span><span class="n">l1</span><span class="p">,</span> <span class="o">*</span><span class="n">l2</span><span class="p">]</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="n">Out</span><span class="p">[</span><span class="mi">117</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre></div></td></tr></table></div></p>
<p>方式二，字典的|运算符
在python3.9中添加了对|运算符的支持
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span>
<span class="normal"><a href="#__codelineno-47-2">2</a></span>
<span class="normal"><a href="#__codelineno-47-3">3</a></span>
<span class="normal"><a href="#__codelineno-47-4">4</a></span>
<span class="normal"><a href="#__codelineno-47-5">5</a></span>
<span class="normal"><a href="#__codelineno-47-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">118</span><span class="p">]:</span> <span class="n">d1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;k1&quot;</span><span class="p">:</span><span class="s2">&quot;v1&quot;</span><span class="p">}</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">119</span><span class="p">]:</span> <span class="n">d2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;k2&quot;</span><span class="p">:</span><span class="s2">&quot;v2&quot;</span><span class="p">}</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="n">d1</span> <span class="o">|</span> <span class="n">d2</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">120</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;k1&#39;</span><span class="p">:</span> <span class="s1">&#39;v1&#39;</span><span class="p">,</span> <span class="s1">&#39;k2&#39;</span><span class="p">:</span> <span class="s1">&#39;v2&#39;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_27">使用有序字典进行去重<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<p>如果用集合去重会导致丢失原有的顺序：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">123</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="nb">set</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">124</span><span class="p">]:</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>可以用有序字典<code>OrderedDict</code>来完成这件事，因为<code>OrderedDict</code>同时满足两个条件：
1. 它的键是有序的；
2. 它的键绝对不会重复</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">126</span><span class="p">]:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h3 id="_28">不要在遍历列表时同步修改<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">135</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">remove_even</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a>     <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;去掉列表中所有的偶数&quot;&quot;&quot;</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a>     <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">number</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a>     <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">number</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a>     <span class="o">...</span><span class="p">:</span>             <span class="c1"># 有问题的代码</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a>     <span class="o">...</span><span class="p">:</span>             <span class="n">numbers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">139</span><span class="p">]:</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">140</span><span class="p">]:</span> <span class="n">remove_even</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="n">In</span> <span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="n">numbers</span>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="n">Out</span><span class="p">[</span><span class="mi">141</span><span class="p">]:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">11</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>”8“本不应该出现在上述结果中，原因是，在遍历过程中，循环所使用的索引值不断增加，而遍历对象<code>numbers</code>里的成员又同时在被删除，长度不断缩短，这导致列表里的一些成员根本没有遍历到。</p>
<p>因此，要修改列表，不要在遍历的时候直接修改，启用一个新的列表进行保存修改后的成员，就不会碰到这个问题了。</p>
<h3 id="nametuple">让函数返回NameTuple<a class="headerlink" href="#nametuple" title="Permanent link">&para;</a></h3>
<p>我们写一个函数，返回多个返回值，并对返回值进行解压赋值给变量，某天需要增加一个返回值，还需要找到所有调用该函数的地方，补上多出来的返回值，或者用<code>_</code>来忽略该返回值。</p>
<p>对于这种未来可能变动的多返回值函数来说，如果一开始就使用NameTuple类型对返回值进行建模，调用方式就会变得简单许多：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span>
<span class="normal"><a href="#__codelineno-51-15">15</a></span>
<span class="normal"><a href="#__codelineno-51-16">16</a></span>
<span class="normal"><a href="#__codelineno-51-17">17</a></span>
<span class="normal"><a href="#__codelineno-51-18">18</a></span>
<span class="normal"><a href="#__codelineno-51-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NamedTuple</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="k">class</span> <span class="nc">Address</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;地址信息结果&quot;&quot;&quot;</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>    <span class="n">country</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a>    <span class="n">province</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a>    <span class="n">city</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="k">def</span> <span class="nf">latlon_to_address</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">):</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a>    <span class="k">return</span> <span class="n">Address</span><span class="p">(</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a>        <span class="n">country</span><span class="o">=</span><span class="n">country</span><span class="p">,</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a>        <span class="n">province</span><span class="o">=</span><span class="n">province</span><span class="p">,</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a>        <span class="n">city</span><span class="o">=</span><span class="n">city</span><span class="p">,</span>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a>    <span class="p">)</span>
<a id="__codelineno-51-15" name="__codelineno-51-15"></a>
<a id="__codelineno-51-16" name="__codelineno-51-16"></a>
<a id="__codelineno-51-17" name="__codelineno-51-17"></a><span class="n">addr</span> <span class="o">=</span> <span class="n">latlon_to_address</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
<a id="__codelineno-51-18" name="__codelineno-51-18"></a><span class="c1">#使用属性名来使用addr</span>
<a id="__codelineno-51-19" name="__codelineno-51-19"></a><span class="c1"># addr.country / addr.province / addr.city</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="_29">条件分支控制流<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h2>
<h3 id="_30">修改对象的布尔值<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h3>
<p>当我们把某个对象用于分支判断时，解释器会对它进行“真值测试”，计算布尔值，而所有用户自定义的类和类实例的计算结果都为True。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span>
<span class="normal"><a href="#__codelineno-52-3">3</a></span>
<span class="normal"><a href="#__codelineno-52-4">4</a></span>
<span class="normal"><a href="#__codelineno-52-5">5</a></span>
<span class="normal"><a href="#__codelineno-52-6">6</a></span>
<span class="normal"><a href="#__codelineno-52-7">7</a></span>
<span class="normal"><a href="#__codelineno-52-8">8</a></span>
<span class="normal"><a href="#__codelineno-52-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">pass</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">Foo</span><span class="p">())</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div></p>
<p>上面的代码有些死板，看下下述代码：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">UserCollection</span><span class="p">:</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;用于保存多个用户的集合工具类&quot;&quot;&quot;</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">users</span><span class="p">):</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">users</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">users</span> <span class="o">=</span> <span class="n">UserCollection</span><span class="p">([</span><span class="s1">&#39;yanghe&#39;</span><span class="p">,</span><span class="s1">&#39;raymond&#39;</span><span class="p">])</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a>   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There&#39;s some users in collection!&quot;</span><span class="p">)</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a><span class="n">There</span><span class="s1">&#39;s some users in collection!</span>
</code></pre></div></td></tr></table></div></p>
<p>上面的分支判断语句可以更简单，只要给<code>UserCollection</code>类实现<code>__len__</code>魔法方法，users对象就可以直接用于”真值测试“：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-54-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-54-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-54-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-54-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-54-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-54-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-54-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-54-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-54-10">10</a></span>
<span class="normal"><a href="#__codelineno-54-11">11</a></span>
<span class="normal"><a href="#__codelineno-54-12">12</a></span>
<span class="normal"><a href="#__codelineno-54-13">13</a></span>
<span class="normal"><a href="#__codelineno-54-14">14</a></span>
<span class="normal"><a href="#__codelineno-54-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">UserCollection</span><span class="p">:</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;用于保存多个用户的集合工具类&quot;&quot;&quot;</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">user</span><span class="p">:</span> <span class="nb">list</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">users</span><span class="p">):</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">users</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span>  <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">users</span> <span class="o">=</span> <span class="n">UserCollection</span><span class="p">([</span><span class="s1">&#39;yanghe&#39;</span><span class="p">,</span> <span class="s1">&#39;raymond&#39;</span><span class="p">])</span>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="k">if</span> <span class="n">users</span><span class="p">:</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;There&#39;s some users in collection!&quot;</span><span class="p">)</span>
<a id="__codelineno-54-14" name="__codelineno-54-14"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-54-15" name="__codelineno-54-15"></a><span class="n">There</span><span class="s1">&#39;s some users in collection!</span>
</code></pre></div></td></tr></table></div></p>
<p>Python在计算这类对象的布尔值时，会受到<code>len(users)</code>结果的影响，加入结果为0，布尔值为<code>False</code>，反之为<code>True</code></p>
<p>还有一个魔法方法<code>__bool__</code>和对象的布尔值也有关，为对象定义<code>__bool__</code>方法后，对它进行布尔值运算会直接返回该方法的调用结果：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">ScoreJudger</span><span class="p">:</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;仅当分数大于60时为真&quot;&quot;&quot;</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">score</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">score</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;=</span> <span class="mi">60</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ScoreJudger</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">ScoreJudger</span><span class="p">(</span><span class="mi">59</span><span class="p">))</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div></p>
<p><strong>假如一个类同时定义了<code>__len__</code>和<code>__bool__</code>两个方法，解释器会优先使用<code>__bool__</code>方法的执行结果。</strong></p>
<h3 id="noneis">与None比较时使用is运算符<a class="headerlink" href="#noneis" title="Permanent link">&para;</a></h3>
<p>判断两个对象是否相等会使用双等号运算符<code>==</code>：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span>
<span class="normal"><a href="#__codelineno-56-2">2</a></span>
<span class="normal"><a href="#__codelineno-56-3">3</a></span>
<span class="normal"><a href="#__codelineno-56-4">4</a></span>
<span class="normal"><a href="#__codelineno-56-5">5</a></span>
<span class="normal"><a href="#__codelineno-56-6">6</a></span>
<span class="normal"><a href="#__codelineno-56-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">x</span> <span class="o">==</span> <span class="n">z</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div></p>
<p>对于自定义对象，它们在<code>==</code>运算时行为时可操纵的：只要实现<code>__eq__</code>魔法方法就行：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">EqualWithAnything</span><span class="p">:</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;与任何对象相等&quot;&quot;&quot;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a>    <span class="o">...</span><span class="p">:</span>         <span class="c1"># other: 双等号左边的对象</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">foo</span> <span class="o">=</span> <span class="n">EqualWithAnything</span><span class="p">()</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">foo</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">foo</span> <span class="o">==</span> <span class="kc">None</span>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div></p>
<p>双等号<code>==</code>的行为可以被魔法方法改变，严格检查某个对象是否为None，需要用到<code>is</code>运算符，两者的区别：
1. <code>==</code>对比两个对象的值是否相等，行为可被<code>__eq__</code>方法重载；
2. is判断两个对象是否在内存里时同一个东西（地址），也就是比较<code>id(obj) == id(obj)</code>，无法被重载</p>
<p>判断某个对象为None时，应该使用is运算符：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span>
<span class="normal"><a href="#__codelineno-58-2">2</a></span>
<span class="normal"><a href="#__codelineno-58-3">3</a></span>
<span class="normal"><a href="#__codelineno-58-4">4</a></span>
<span class="normal"><a href="#__codelineno-58-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">foo</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="kc">False</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">foo</span> <span class="o">==</span> <span class="kc">None</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="n">Out</span><span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div></p>
<p><strong>仅当你需要判断某个对象是否是None、True、False，使用is，否则使用<code>==</code></strong></p>
<h3 id="_31">案例<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span>
<span class="normal"><a href="#__codelineno-59-13">13</a></span>
<span class="normal"><a href="#__codelineno-59-14">14</a></span>
<span class="normal"><a href="#__codelineno-59-15">15</a></span>
<span class="normal"><a href="#__codelineno-59-16">16</a></span>
<span class="normal"><a href="#__codelineno-59-17">17</a></span>
<span class="normal"><a href="#__codelineno-59-18">18</a></span>
<span class="normal"><a href="#__codelineno-59-19">19</a></span>
<span class="normal"><a href="#__codelineno-59-20">20</a></span>
<span class="normal"><a href="#__codelineno-59-21">21</a></span>
<span class="normal"><a href="#__codelineno-59-22">22</a></span>
<span class="normal"><a href="#__codelineno-59-23">23</a></span>
<span class="normal"><a href="#__codelineno-59-24">24</a></span>
<span class="normal"><a href="#__codelineno-59-25">25</a></span>
<span class="normal"><a href="#__codelineno-59-26">26</a></span>
<span class="normal"><a href="#__codelineno-59-27">27</a></span>
<span class="normal"><a href="#__codelineno-59-28">28</a></span>
<span class="normal"><a href="#__codelineno-59-29">29</a></span>
<span class="normal"><a href="#__codelineno-59-30">30</a></span>
<span class="normal"><a href="#__codelineno-59-31">31</a></span>
<span class="normal"><a href="#__codelineno-59-32">32</a></span>
<span class="normal"><a href="#__codelineno-59-33">33</a></span>
<span class="normal"><a href="#__codelineno-59-34">34</a></span>
<span class="normal"><a href="#__codelineno-59-35">35</a></span>
<span class="normal"><a href="#__codelineno-59-36">36</a></span>
<span class="normal"><a href="#__codelineno-59-37">37</a></span>
<span class="normal"><a href="#__codelineno-59-38">38</a></span>
<span class="normal"><a href="#__codelineno-59-39">39</a></span>
<span class="normal"><a href="#__codelineno-59-40">40</a></span>
<span class="normal"><a href="#__codelineno-59-41">41</a></span>
<span class="normal"><a href="#__codelineno-59-42">42</a></span>
<span class="normal"><a href="#__codelineno-59-43">43</a></span>
<span class="normal"><a href="#__codelineno-59-44">44</a></span>
<span class="normal"><a href="#__codelineno-59-45">45</a></span>
<span class="normal"><a href="#__codelineno-59-46">46</a></span>
<span class="normal"><a href="#__codelineno-59-47">47</a></span>
<span class="normal"><a href="#__codelineno-59-48">48</a></span>
<span class="normal"><a href="#__codelineno-59-49">49</a></span>
<span class="normal"><a href="#__codelineno-59-50">50</a></span>
<span class="normal"><a href="#__codelineno-59-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="kn">import</span> <span class="nn">bisect</span>  
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="kn">import</span> <span class="nn">random</span>  
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="c1"># from typing import List  </span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="k">class</span> <span class="nc">Movie</span><span class="p">:</span>  
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;电影对象数据类&quot;&quot;&quot;</span>  
<a id="__codelineno-59-8" name="__codelineno-59-8"></a>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">rating</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>  
<a id="__codelineno-59-10" name="__codelineno-59-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>  
<a id="__codelineno-59-11" name="__codelineno-59-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">=</span> <span class="n">year</span>  
<a id="__codelineno-59-12" name="__codelineno-59-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">rating</span> <span class="o">=</span> <span class="n">rating</span>  
<a id="__codelineno-59-13" name="__codelineno-59-13"></a>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a>    <span class="nd">@property</span>  
<a id="__codelineno-59-15" name="__codelineno-59-15"></a>    <span class="k">def</span> <span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  
<a id="__codelineno-59-16" name="__codelineno-59-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;按照评分对电影分级&quot;&quot;&quot;</span>  
<a id="__codelineno-59-17" name="__codelineno-59-17"></a>        <span class="c1"># 已经排好序的评级分界点  </span>
<a id="__codelineno-59-18" name="__codelineno-59-18"></a>        <span class="n">breakpoints</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">8.5</span><span class="p">)</span>  
<a id="__codelineno-59-19" name="__codelineno-59-19"></a>        <span class="c1"># 各评分区间别名  </span>
<a id="__codelineno-59-20" name="__codelineno-59-20"></a>        <span class="n">grades</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">)</span>  
<a id="__codelineno-59-21" name="__codelineno-59-21"></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">breakpoints</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rating</span><span class="p">))</span>  
<a id="__codelineno-59-22" name="__codelineno-59-22"></a>        <span class="k">return</span> <span class="n">grades</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  
<a id="__codelineno-59-23" name="__codelineno-59-23"></a>
<a id="__codelineno-59-24" name="__codelineno-59-24"></a>
<a id="__codelineno-59-25" name="__codelineno-59-25"></a><span class="k">def</span> <span class="nf">get_sorted_movies</span><span class="p">(</span><span class="n">movies</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Movie</span><span class="p">],</span> <span class="n">sorting_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Movie</span><span class="p">]:</span>  
<a id="__codelineno-59-26" name="__codelineno-59-26"></a>    <span class="n">sorting_algos</span> <span class="o">=</span> <span class="p">{</span>  
<a id="__codelineno-59-27" name="__codelineno-59-27"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">movie</span><span class="p">:</span> <span class="n">movie</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="kc">False</span><span class="p">),</span>  
<a id="__codelineno-59-28" name="__codelineno-59-28"></a>        <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">movie</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">rating</span><span class="p">),</span> <span class="kc">True</span><span class="p">),</span>  
<a id="__codelineno-59-29" name="__codelineno-59-29"></a>        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">movie</span><span class="p">:</span> <span class="n">movie</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  
<a id="__codelineno-59-30" name="__codelineno-59-30"></a>        <span class="s2">&quot;random&quot;</span><span class="p">:</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">movie</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="kc">False</span><span class="p">)</span>  
<a id="__codelineno-59-31" name="__codelineno-59-31"></a>    <span class="p">}</span>  
<a id="__codelineno-59-32" name="__codelineno-59-32"></a>    <span class="k">try</span><span class="p">:</span>  
<a id="__codelineno-59-33" name="__codelineno-59-33"></a>        <span class="n">key_func</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="n">sorting_algos</span><span class="p">[</span><span class="n">sorting_type</span><span class="p">]</span>  
<a id="__codelineno-59-34" name="__codelineno-59-34"></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>  
<a id="__codelineno-59-35" name="__codelineno-59-35"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown sorting type: </span><span class="si">{</span><span class="n">sorting_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>  
<a id="__codelineno-59-36" name="__codelineno-59-36"></a>    <span class="n">sorted_movies</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">movies</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key_func</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>  
<a id="__codelineno-59-37" name="__codelineno-59-37"></a>    <span class="k">return</span> <span class="n">sorted_movies</span>  
<a id="__codelineno-59-38" name="__codelineno-59-38"></a>
<a id="__codelineno-59-39" name="__codelineno-59-39"></a>
<a id="__codelineno-59-40" name="__codelineno-59-40"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>  
<a id="__codelineno-59-41" name="__codelineno-59-41"></a>    <span class="n">movies</span> <span class="o">=</span> <span class="p">[</span>  
<a id="__codelineno-59-42" name="__codelineno-59-42"></a>        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;The Dark Knight&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2008</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">:</span> <span class="s1">&#39;9&#39;</span><span class="p">},</span>  
<a id="__codelineno-59-43" name="__codelineno-59-43"></a>        <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Kaili Blues&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2015</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">:</span> <span class="s1">&#39;7.3&#39;</span><span class="p">},</span>  
<a id="__codelineno-59-44" name="__codelineno-59-44"></a>    <span class="p">]</span>  
<a id="__codelineno-59-45" name="__codelineno-59-45"></a>    <span class="n">movie_items</span> <span class="o">=</span> <span class="p">[]</span>  
<a id="__codelineno-59-46" name="__codelineno-59-46"></a>    <span class="k">for</span> <span class="n">movie_json</span> <span class="ow">in</span> <span class="n">movies</span><span class="p">:</span>  
<a id="__codelineno-59-47" name="__codelineno-59-47"></a>        <span class="n">movie</span> <span class="o">=</span> <span class="n">Movie</span><span class="p">(</span><span class="o">**</span><span class="n">movie_json</span><span class="p">)</span>  
<a id="__codelineno-59-48" name="__codelineno-59-48"></a>        <span class="n">movie_items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span>  
<a id="__codelineno-59-49" name="__codelineno-59-49"></a>    <span class="n">sorted_movies</span> <span class="o">=</span> <span class="n">get_sorted_movies</span><span class="p">(</span><span class="n">movie_items</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">)</span>  
<a id="__codelineno-59-50" name="__codelineno-59-50"></a>    <span class="k">for</span> <span class="n">movie</span> <span class="ow">in</span> <span class="n">sorted_movies</span><span class="p">:</span>  
<a id="__codelineno-59-51" name="__codelineno-59-51"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">movie</span><span class="o">.</span><span class="n">rank</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">movie</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">movie</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">) | rating: </span><span class="si">{</span><span class="n">movie</span><span class="o">.</span><span class="n">rating</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="anyall">使用any()/all()函数构建条件表达式<a class="headerlink" href="#anyall" title="Permanent link">&para;</a></h3>
<ul>
<li><code>all(iterable)</code>: 仅当iterable中的所有成员为真才返回<code>True</code>，否则返回<code>False</code></li>
<li><code>any(iterable)</code>: 只要iterable中的任何一个成员布尔值为为真返回<code>True</code>，否则返回<code>False</code></li>
</ul>
<p>需要判断一个列表里的所有数字是不是都大于10，如果用普通循环：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span>
<span class="normal"><a href="#__codelineno-60-5">5</a></span>
<span class="normal"><a href="#__codelineno-60-6">6</a></span>
<span class="normal"><a href="#__codelineno-60-7">7</a></span>
<span class="normal"><a href="#__codelineno-60-8">8</a></span>
<span class="normal"><a href="#__codelineno-60-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">all_numbers_gt_10</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;仅当序列中的数字都大于10时，返回True&quot;&quot;&quot;</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">numbers</span><span class="p">:</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a>    <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a>    <span class="o">...</span><span class="p">:</span>
</code></pre></div></td></tr></table></div></p>
<p>使用<code>all()</code>内置函数，配合生成器表达式：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span>
<span class="normal"><a href="#__codelineno-61-2">2</a></span>
<span class="normal"><a href="#__codelineno-61-3">3</a></span>
<span class="normal"><a href="#__codelineno-61-4">4</a></span>
<span class="normal"><a href="#__codelineno-61-5">5</a></span>
<span class="normal"><a href="#__codelineno-61-6">6</a></span>
<span class="normal"><a href="#__codelineno-61-7">7</a></span>
<span class="normal"><a href="#__codelineno-61-8">8</a></span>
<span class="normal"><a href="#__codelineno-61-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">all_numbers_gt_10_2</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">)</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">all_numbers_gt_10_2</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="kc">False</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">all_numbers_gt_10_2</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">])</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="n">Out</span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="_32">异常与错误处理<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h2>
<h3 id="raise">使用空raise语句<a class="headerlink" href="#raise" title="Permanent link">&para;</a></h3>
<p>在处理异常时，有时我们想记录下某个异常，然后把它重新抛出，交由上层处理。这时，可以使用不带参数的<code>raise</code>语句。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span>
<span class="normal"><a href="#__codelineno-62-13">13</a></span>
<span class="normal"><a href="#__codelineno-62-14">14</a></span>
<span class="normal"><a href="#__codelineno-62-15">15</a></span>
<span class="normal"><a href="#__codelineno-62-16">16</a></span>
<span class="normal"><a href="#__codelineno-62-17">17</a></span>
<span class="normal"><a href="#__codelineno-62-18">18</a></span>
<span class="normal"><a href="#__codelineno-62-19">19</a></span>
<span class="normal"><a href="#__codelineno-62-20">20</a></span>
<span class="normal"><a href="#__codelineno-62-21">21</a></span>
<span class="normal"><a href="#__codelineno-62-22">22</a></span>
<span class="normal"><a href="#__codelineno-62-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">incr_by_key</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a>   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> does not exists, reraise the exception&quot;</span><span class="p">)</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">raise</span>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">incr_by_key</span><span class="p">({},</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a><span class="n">key</span> <span class="n">foo</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">,</span> <span class="n">reraise</span> <span class="n">the</span> <span class="n">exception</span>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a><span class="ne">KeyError</span>                                  <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">incr_by_key</span><span class="p">({},</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
<a id="__codelineno-62-15" name="__codelineno-62-15"></a>
<a id="__codelineno-62-16" name="__codelineno-62-16"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="ow">in</span> <span class="n">incr_by_key</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<a id="__codelineno-62-17" name="__codelineno-62-17"></a>      <span class="mi">1</span> <span class="k">def</span> <span class="nf">incr_by_key</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<a id="__codelineno-62-18" name="__codelineno-62-18"></a>      <span class="mi">2</span>     <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-62-19" name="__codelineno-62-19"></a><span class="o">----&gt;</span> <span class="mi">3</span>         <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-62-20" name="__codelineno-62-20"></a>      <span class="mi">4</span>     <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<a id="__codelineno-62-21" name="__codelineno-62-21"></a>      <span class="mi">5</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> does not exists, reraise the exception&quot;</span><span class="p">)</span>
<a id="__codelineno-62-22" name="__codelineno-62-22"></a>
<a id="__codelineno-62-23" name="__codelineno-62-23"></a><span class="ne">KeyError</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_33">抛出异常，而不是返回错误<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span>
<span class="normal"><a href="#__codelineno-63-14">14</a></span>
<span class="normal"><a href="#__codelineno-63-15">15</a></span>
<span class="normal"><a href="#__codelineno-63-16">16</a></span>
<span class="normal"><a href="#__codelineno-63-17">17</a></span>
<span class="normal"><a href="#__codelineno-63-18">18</a></span>
<span class="normal"><a href="#__codelineno-63-19">19</a></span>
<span class="normal"><a href="#__codelineno-63-20">20</a></span>
<span class="normal"><a href="#__codelineno-63-21">21</a></span>
<span class="normal"><a href="#__codelineno-63-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="k">class</span> <span class="nc">CreateItemError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;创建Item失败&quot;&quot;&quot;</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="k">def</span> <span class="nf">create_item</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="sd">    创建一个新的Item</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="sd">    :raises: 当无法创建时抛出 CreateItemError</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_LENGTH_OF_NAME</span><span class="p">:</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a>        <span class="k">raise</span> <span class="n">CrateItemError</span><span class="p">(</span><span class="s1">&#39;name of item is  too long&#39;</span><span class="p">)</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">get_current_items</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">MAX_ITEMS_QUOTA</span><span class="p">:</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a>        <span class="k">raise</span> <span class="n">CrateItemError</span><span class="p">(</span><span class="s1">&#39;item is full&#39;</span><span class="p">)</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a>    <span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a><span class="k">def</span> <span class="nf">create_from_input</span><span class="p">():</span>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a>    <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a>        <span class="n">item</span> <span class="o">=</span> <span class="n">create_item</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a>    <span class="k">except</span> <span class="n">CrateItemError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-63-20" name="__codelineno-63-20"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;create item failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-63-21" name="__codelineno-63-21"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-63-22" name="__codelineno-63-22"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;item&lt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&gt; created&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>最好在函数文档里面说明可能会抛出异常类型</strong></p>
<h3 id="_34">上下文管理器忽略异常<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span>
<span class="normal"><a href="#__codelineno-64-2">2</a></span>
<span class="normal"><a href="#__codelineno-64-3">3</a></span>
<span class="normal"><a href="#__codelineno-64-4">4</a></span>
<span class="normal"><a href="#__codelineno-64-5">5</a></span>
<span class="normal"><a href="#__codelineno-64-6">6</a></span>
<span class="normal"><a href="#__codelineno-64-7">7</a></span>
<span class="normal"><a href="#__codelineno-64-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="k">class</span> <span class="nc">ignore_closed</span><span class="p">:</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;忽略已经关闭的连接&quot;&quot;&quot;</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a>        <span class="k">pass</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a>        <span class="k">if</span> <span class="n">exc_type</span> <span class="o">==</span> <span class="n">AlreadyClosedError</span><span class="p">:</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a>        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
<p>当你想忽略AlreadyClosedError异常时，只要把代码用with语句包裹起来即可：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="k">with</span> <span class="n">ignore_closed</span><span class="p">():</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a>    <span class="n">close_conn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>用第二种方式进行忽略：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span>
<span class="normal"><a href="#__codelineno-66-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">suppress</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="n">AlreadyClosedError</span><span class="p">):</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a>    <span class="n">close_conn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>如果有上下问管理器有异常抛出，这三个参数具体内容是：
1. <code>exc_type</code>： 异常的类型
2. <code>exc_value</code>：异常对象
3. <code>traceback</code>：错误的堆栈对象</p>
<h3 id="contextmanager">使用contextmanager装饰器<a class="headerlink" href="#contextmanager" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-67-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-67-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-67-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-67-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-67-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-67-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-67-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-67-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-67-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="nd">@contextmanager</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="k">def</span> <span class="nf">create_conn_obj</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;创建连接对象，并在退出上下文时自动关闭&quot;&quot;&quot;</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a>    <span class="n">conn</span> <span class="o">=</span> <span class="n">create_conn</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a>        <span class="k">yield</span> <span class="n">conn</span>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a>        <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="_35">不要手动校验数据<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<p>在编写代码时，我们尽量避免手动校验任何数据，因为数据校验任务独立性很强，所以应该引入适合的第三方校验模块，或者自己实现</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-68-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-68-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-68-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-68-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-68-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-68-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-68-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-68-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-68-10">10</a></span>
<span class="normal"><a href="#__codelineno-68-11">11</a></span>
<span class="normal"><a href="#__codelineno-68-12">12</a></span>
<span class="normal"><a href="#__codelineno-68-13">13</a></span>
<span class="normal"><a href="#__codelineno-68-14">14</a></span>
<span class="normal"><a href="#__codelineno-68-15">15</a></span>
<span class="normal"><a href="#__codelineno-68-16">16</a></span>
<span class="normal"><a href="#__codelineno-68-17">17</a></span>
<span class="normal"><a href="#__codelineno-68-18">18</a></span>
<span class="normal"><a href="#__codelineno-68-19">19</a></span>
<span class="normal"><a href="#__codelineno-68-20">20</a></span>
<span class="normal"><a href="#__codelineno-68-21">21</a></span>
<span class="normal"><a href="#__codelineno-68-22">22</a></span>
<span class="normal"><a href="#__codelineno-68-23">23</a></span>
<span class="normal"><a href="#__codelineno-68-24">24</a></span>
<span class="normal"><a href="#__codelineno-68-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">input_a_number_with_pydantic</span><span class="p">():</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">number</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;please input a number (0-100):&quot;</span><span class="p">)</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a>   <span class="o">...</span><span class="p">:</span>         <span class="c1"># 实例化 pydantic 模型，捕获校验错误异常</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a>   <span class="o">...</span><span class="p">:</span>             <span class="n">number_input</span> <span class="o">=</span> <span class="n">NumberInput</span><span class="p">(</span><span class="n">number</span><span class="o">=</span><span class="n">number</span><span class="p">)</span>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a>   <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a>   <span class="o">...</span><span class="p">:</span>             <span class="k">continue</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">number</span> <span class="o">=</span> <span class="n">number_input</span><span class="o">.</span><span class="n">number</span>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">break</span>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a>   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your number is </span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-68-13" name="__codelineno-68-13"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-68-14" name="__codelineno-68-14"></a>
<a id="__codelineno-68-15" name="__codelineno-68-15"></a><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">input_a_number_with_pydantic</span><span class="p">()</span>
<a id="__codelineno-68-16" name="__codelineno-68-16"></a><span class="n">please</span> <span class="nb">input</span> <span class="n">a</span> <span class="n">number</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">100</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-68-17" name="__codelineno-68-17"></a><span class="mi">1</span> <span class="n">validation</span> <span class="n">error</span> <span class="k">for</span> <span class="n">NumberInput</span>
<a id="__codelineno-68-18" name="__codelineno-68-18"></a><span class="n">number</span>
<a id="__codelineno-68-19" name="__codelineno-68-19"></a>  <span class="n">ensure</span> <span class="n">this</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">greater</span> <span class="n">than</span> <span class="ow">or</span> <span class="n">equal</span> <span class="n">to</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">value_error</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">not_ge</span><span class="p">;</span> <span class="n">limit_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-68-20" name="__codelineno-68-20"></a><span class="n">please</span> <span class="nb">input</span> <span class="n">a</span> <span class="n">number</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">100</span><span class="p">):</span><span class="mi">101</span>
<a id="__codelineno-68-21" name="__codelineno-68-21"></a><span class="mi">1</span> <span class="n">validation</span> <span class="n">error</span> <span class="k">for</span> <span class="n">NumberInput</span>
<a id="__codelineno-68-22" name="__codelineno-68-22"></a><span class="n">number</span>
<a id="__codelineno-68-23" name="__codelineno-68-23"></a>  <span class="n">ensure</span> <span class="n">this</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">less</span> <span class="n">than</span> <span class="ow">or</span> <span class="n">equal</span> <span class="n">to</span> <span class="mi">100</span> <span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">value_error</span><span class="o">.</span><span class="n">number</span><span class="o">.</span><span class="n">not_le</span><span class="p">;</span> <span class="n">limit_value</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-68-24" name="__codelineno-68-24"></a><span class="n">please</span> <span class="nb">input</span> <span class="n">a</span> <span class="n">number</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">100</span><span class="p">):</span><span class="mi">1</span>
<a id="__codelineno-68-25" name="__codelineno-68-25"></a><span class="n">Your</span> <span class="n">number</span> <span class="ow">is</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
<h3 id="_36">抛出可区分的异常<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h3>
<p>利用异常间的继承关系，设计一些更精准的异常子类：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-69-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-69-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-69-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-69-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-69-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-69-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-69-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-69-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-69-10">10</a></span>
<span class="normal"><a href="#__codelineno-69-11">11</a></span>
<span class="normal"><a href="#__codelineno-69-12">12</a></span>
<span class="normal"><a href="#__codelineno-69-13">13</a></span>
<span class="normal"><a href="#__codelineno-69-14">14</a></span>
<span class="normal"><a href="#__codelineno-69-15">15</a></span>
<span class="normal"><a href="#__codelineno-69-16">16</a></span>
<span class="normal"><a href="#__codelineno-69-17">17</a></span>
<span class="normal"><a href="#__codelineno-69-18">18</a></span>
<span class="normal"><a href="#__codelineno-69-19">19</a></span>
<span class="normal"><a href="#__codelineno-69-20">20</a></span>
<span class="normal"><a href="#__codelineno-69-21">21</a></span>
<span class="normal"><a href="#__codelineno-69-22">22</a></span>
<span class="normal"><a href="#__codelineno-69-23">23</a></span>
<span class="normal"><a href="#__codelineno-69-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="k">class</span> <span class="nc">CreateItemError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;创建 Item 失败&quot;&quot;&quot;</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a><span class="k">class</span> <span class="nc">CreateErrorItemsFull</span><span class="p">(</span><span class="n">CreateItemError</span><span class="p">):</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;当前的Item容器已满&quot;&quot;&quot;</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a><span class="k">def</span> <span class="nf">create_item</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">MAX_LENGTH_OF_NAME</span><span class="p">:</span>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a>        <span class="k">raise</span> <span class="n">CreateItemError</span><span class="p">(</span><span class="s2">&quot;name of item is too long&quot;</span><span class="p">)</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">get_current_items</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">MAX_ITEMS_QUOTA</span><span class="p">:</span>
<a id="__codelineno-69-11" name="__codelineno-69-11"></a>        <span class="k">raise</span> <span class="n">CreateErrorItemsFull</span><span class="p">(</span><span class="s2">&quot;items if full&quot;</span><span class="p">)</span>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a>    <span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-69-13" name="__codelineno-69-13"></a>
<a id="__codelineno-69-14" name="__codelineno-69-14"></a><span class="k">def</span> <span class="nf">create_from_input</span><span class="p">():</span>
<a id="__codelineno-69-15" name="__codelineno-69-15"></a>    <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
<a id="__codelineno-69-16" name="__codelineno-69-16"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-69-17" name="__codelineno-69-17"></a>        <span class="n">item</span> <span class="o">=</span> <span class="n">create_item</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<a id="__codelineno-69-18" name="__codelineno-69-18"></a>    <span class="k">except</span> <span class="n">CreateErrorItemsFull</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-69-19" name="__codelineno-69-19"></a>        <span class="n">clear_all_items</span><span class="p">()</span>
<a id="__codelineno-69-20" name="__codelineno-69-20"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;create item failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-69-21" name="__codelineno-69-21"></a>    <span class="k">except</span> <span class="n">CreateItemError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-69-22" name="__codelineno-69-22"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;create item faild: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-69-23" name="__codelineno-69-23"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-69-24" name="__codelineno-69-24"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;item&lt;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&gt; created&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>还可以创建一些包含额外属性的异常类，比如“错误代码（err_code）”的CreateItemError类：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-70-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-70-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-70-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-70-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-70-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-70-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-70-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-70-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-70-10">10</a></span>
<span class="normal"><a href="#__codelineno-70-11">11</a></span>
<span class="normal"><a href="#__codelineno-70-12">12</a></span>
<span class="normal"><a href="#__codelineno-70-13">13</a></span>
<span class="normal"><a href="#__codelineno-70-14">14</a></span>
<span class="normal"><a href="#__codelineno-70-15">15</a></span>
<span class="normal"><a href="#__codelineno-70-16">16</a></span>
<span class="normal"><a href="#__codelineno-70-17">17</a></span>
<span class="normal"><a href="#__codelineno-70-18">18</a></span>
<span class="normal"><a href="#__codelineno-70-19">19</a></span>
<span class="normal"><a href="#__codelineno-70-20">20</a></span>
<span class="normal"><a href="#__codelineno-70-21">21</a></span>
<span class="normal"><a href="#__codelineno-70-22">22</a></span>
<span class="normal"><a href="#__codelineno-70-23">23</a></span>
<span class="normal"><a href="#__codelineno-70-24">24</a></span>
<span class="normal"><a href="#__codelineno-70-25">25</a></span>
<span class="normal"><a href="#__codelineno-70-26">26</a></span>
<span class="normal"><a href="#__codelineno-70-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">CreateItemError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="s2">    ...:     创建Item失败</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="s2">    ...:     :param error_code: 错误代码</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="s2">    ...:     :param message: 错误信息</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a><span class="s2">    ...:     &quot;&quot;&quot;</span>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">__init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_code</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">error_code</span> <span class="o">=</span> <span class="n">error_code</span>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
<a id="__codelineno-70-10" name="__codelineno-70-10"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">error_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-70-11" name="__codelineno-70-11"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-70-12" name="__codelineno-70-12"></a>
<a id="__codelineno-70-13" name="__codelineno-70-13"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="k">raise</span> <span class="n">CreateItemError</span><span class="p">(</span><span class="s2">&quot;name_too_long&quot;</span><span class="p">,</span> <span class="s2">&quot;name of item is too long&quot;</span><span class="p">)</span>
<a id="__codelineno-70-14" name="__codelineno-70-14"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-70-15" name="__codelineno-70-15"></a><span class="n">CreateItemError</span>                           <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-70-16" name="__codelineno-70-16"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-70-17" name="__codelineno-70-17"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="k">raise</span> <span class="n">CreateItemError</span><span class="p">(</span><span class="s2">&quot;name_too_long&quot;</span><span class="p">,</span> <span class="s2">&quot;name of item is too long&quot;</span><span class="p">)</span>
<a id="__codelineno-70-18" name="__codelineno-70-18"></a>
<a id="__codelineno-70-19" name="__codelineno-70-19"></a><span class="n">CreateItemError</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;name_too_long&#39;</span><span class="p">,</span> <span class="s1">&#39;name of item is too long&#39;</span><span class="p">)</span>
<a id="__codelineno-70-20" name="__codelineno-70-20"></a>
<a id="__codelineno-70-21" name="__codelineno-70-21"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="k">raise</span> <span class="n">CreateItemError</span><span class="p">(</span><span class="s2">&quot;item_full&quot;</span><span class="p">,</span> <span class="s2">&quot;items is full&quot;</span><span class="p">)</span>
<a id="__codelineno-70-22" name="__codelineno-70-22"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-70-23" name="__codelineno-70-23"></a><span class="n">CreateItemError</span>                           <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-70-24" name="__codelineno-70-24"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-70-25" name="__codelineno-70-25"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="k">raise</span> <span class="n">CreateItemError</span><span class="p">(</span><span class="s2">&quot;item_full&quot;</span><span class="p">,</span> <span class="s2">&quot;items is full&quot;</span><span class="p">)</span>
<a id="__codelineno-70-26" name="__codelineno-70-26"></a>
<a id="__codelineno-70-27" name="__codelineno-70-27"></a><span class="n">CreateItemError</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;item_full&#39;</span><span class="p">,</span> <span class="s1">&#39;items is full&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>这样调用方在捕获异常后，也能根据异常对象的error_code来精确分辨异常类型</p>
<h3 id="_37">空对象模式<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-71-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-71-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-71-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-71-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-71-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-71-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-71-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-71-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-71-10">10</a></span>
<span class="normal"><a href="#__codelineno-71-11">11</a></span>
<span class="normal"><a href="#__codelineno-71-12">12</a></span>
<span class="normal"><a href="#__codelineno-71-13">13</a></span>
<span class="normal"><a href="#__codelineno-71-14">14</a></span>
<span class="normal"><a href="#__codelineno-71-15">15</a></span>
<span class="normal"><a href="#__codelineno-71-16">16</a></span>
<span class="normal"><a href="#__codelineno-71-17">17</a></span>
<span class="normal"><a href="#__codelineno-71-18">18</a></span>
<span class="normal"><a href="#__codelineno-71-19">19</a></span>
<span class="normal"><a href="#__codelineno-71-20">20</a></span>
<span class="normal"><a href="#__codelineno-71-21">21</a></span>
<span class="normal"><a href="#__codelineno-71-22">22</a></span>
<span class="normal"><a href="#__codelineno-71-23">23</a></span>
<span class="normal"><a href="#__codelineno-71-24">24</a></span>
<span class="normal"><a href="#__codelineno-71-25">25</a></span>
<span class="normal"><a href="#__codelineno-71-26">26</a></span>
<span class="normal"><a href="#__codelineno-71-27">27</a></span>
<span class="normal"><a href="#__codelineno-71-28">28</a></span>
<span class="normal"><a href="#__codelineno-71-29">29</a></span>
<span class="normal"><a href="#__codelineno-71-30">30</a></span>
<span class="normal"><a href="#__codelineno-71-31">31</a></span>
<span class="normal"><a href="#__codelineno-71-32">32</a></span>
<span class="normal"><a href="#__codelineno-71-33">33</a></span>
<span class="normal"><a href="#__codelineno-71-34">34</a></span>
<span class="normal"><a href="#__codelineno-71-35">35</a></span>
<span class="normal"><a href="#__codelineno-71-36">36</a></span>
<span class="normal"><a href="#__codelineno-71-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="n">QUALIFIED_POINTS</span> <span class="o">=</span> <span class="mi">80</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="k">class</span> <span class="nc">UserPoint</span><span class="p">:</span>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;用户得分记录&quot;&quot;&quot;</span>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
<a id="__codelineno-71-6" name="__codelineno-71-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
<a id="__codelineno-71-8" name="__codelineno-71-8"></a>    <span class="k">def</span> <span class="nf">is_qualified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-71-9" name="__codelineno-71-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;返回得分是否合格&quot;&quot;&quot;</span>
<a id="__codelineno-71-10" name="__codelineno-71-10"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">&gt;=</span> <span class="n">QUALIFIED_POINTS</span>
<a id="__codelineno-71-11" name="__codelineno-71-11"></a>
<a id="__codelineno-71-12" name="__codelineno-71-12"></a><span class="k">class</span> <span class="nc">NullUserPoint</span><span class="p">:</span>
<a id="__codelineno-71-13" name="__codelineno-71-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;一个空的用户得分记录&quot;&quot;&quot;</span>
<a id="__codelineno-71-14" name="__codelineno-71-14"></a>    <span class="n">username</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-71-15" name="__codelineno-71-15"></a>    <span class="n">points</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-71-16" name="__codelineno-71-16"></a>    <span class="k">def</span> <span class="nf">is_qualified</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-71-17" name="__codelineno-71-17"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-71-18" name="__codelineno-71-18"></a>
<a id="__codelineno-71-19" name="__codelineno-71-19"></a><span class="k">def</span> <span class="nf">make_userpoint</span><span class="p">(</span><span class="n">point_string</span><span class="p">):</span>
<a id="__codelineno-71-20" name="__codelineno-71-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;从字符串初始化一条得分记录</span>
<a id="__codelineno-71-21" name="__codelineno-71-21"></a><span class="sd">    :param point_string: 形如piglei 1 的表示得分记录的字符串</span>
<a id="__codelineno-71-22" name="__codelineno-71-22"></a><span class="sd">    :return: 如果输入合法，返回UserPoint对象，否则返回NullUserPoint</span>
<a id="__codelineno-71-23" name="__codelineno-71-23"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-71-24" name="__codelineno-71-24"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-71-25" name="__codelineno-71-25"></a>        <span class="n">username</span><span class="p">,</span> <span class="n">points</span> <span class="o">=</span> <span class="n">point_string</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a id="__codelineno-71-26" name="__codelineno-71-26"></a>        <span class="n">points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<a id="__codelineno-71-27" name="__codelineno-71-27"></a>    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-71-28" name="__codelineno-71-28"></a>        <span class="k">return</span> <span class="n">NullUserPoint</span><span class="p">()</span>
<a id="__codelineno-71-29" name="__codelineno-71-29"></a>    <span class="k">if</span> <span class="n">points</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-71-30" name="__codelineno-71-30"></a>        <span class="k">return</span> <span class="n">NullUserPoint</span><span class="p">()</span>
<a id="__codelineno-71-31" name="__codelineno-71-31"></a>    <span class="k">return</span> <span class="n">UserPoint</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">points</span><span class="p">)</span>
<a id="__codelineno-71-32" name="__codelineno-71-32"></a>
<a id="__codelineno-71-33" name="__codelineno-71-33"></a><span class="k">def</span> <span class="nf">count_qualified</span><span class="p">(</span><span class="n">points_data</span><span class="p">):</span>
<a id="__codelineno-71-34" name="__codelineno-71-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;计算得分合格总人数</span>
<a id="__codelineno-71-35" name="__codelineno-71-35"></a><span class="sd">    :param points_data: 字符串格式的用户得分列表</span>
<a id="__codelineno-71-36" name="__codelineno-71-36"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-71-37" name="__codelineno-71-37"></a>    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">make_userpoints</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">isqualifed</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">points_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="_38">循环与可迭代对象<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h2>
<h3 id="_39">迭代器与可迭代对象<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h3>
<p>迭代器与可迭代对象的区别：
- 可迭代对象不一定是迭代器，但迭代器一定是可迭代对象
- 对可迭代对象使用<code>iter()</code>会返回迭代器，迭代器则返回其自身
- 每个迭代器的的被迭代过程是一次性的，可迭代对象则不一定
- 可迭代对象只需要实现<code>__iter__</code>方法，而迭代器要额外实现<code>__next__</code>方法</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-72-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-72-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-72-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-72-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-72-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-72-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-72-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-72-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-72-10">10</a></span>
<span class="normal"><a href="#__codelineno-72-11">11</a></span>
<span class="normal"><a href="#__codelineno-72-12">12</a></span>
<span class="normal"><a href="#__codelineno-72-13">13</a></span>
<span class="normal"><a href="#__codelineno-72-14">14</a></span>
<span class="normal"><a href="#__codelineno-72-15">15</a></span>
<span class="normal"><a href="#__codelineno-72-16">16</a></span>
<span class="normal"><a href="#__codelineno-72-17">17</a></span>
<span class="normal"><a href="#__codelineno-72-18">18</a></span>
<span class="normal"><a href="#__codelineno-72-19">19</a></span>
<span class="normal"><a href="#__codelineno-72-20">20</a></span>
<span class="normal"><a href="#__codelineno-72-21">21</a></span>
<span class="normal"><a href="#__codelineno-72-22">22</a></span>
<span class="normal"><a href="#__codelineno-72-23">23</a></span>
<span class="normal"><a href="#__codelineno-72-24">24</a></span>
<span class="normal"><a href="#__codelineno-72-25">25</a></span>
<span class="normal"><a href="#__codelineno-72-26">26</a></span>
<span class="normal"><a href="#__codelineno-72-27">27</a></span>
<span class="normal"><a href="#__codelineno-72-28">28</a></span>
<span class="normal"><a href="#__codelineno-72-29">29</a></span>
<span class="normal"><a href="#__codelineno-72-30">30</a></span>
<span class="normal"><a href="#__codelineno-72-31">31</a></span>
<span class="normal"><a href="#__codelineno-72-32">32</a></span>
<span class="normal"><a href="#__codelineno-72-33">33</a></span>
<span class="normal"><a href="#__codelineno-72-34">34</a></span>
<span class="normal"><a href="#__codelineno-72-35">35</a></span>
<span class="normal"><a href="#__codelineno-72-36">36</a></span>
<span class="normal"><a href="#__codelineno-72-37">37</a></span>
<span class="normal"><a href="#__codelineno-72-38">38</a></span>
<span class="normal"><a href="#__codelineno-72-39">39</a></span>
<span class="normal"><a href="#__codelineno-72-40">40</a></span>
<span class="normal"><a href="#__codelineno-72-41">41</a></span>
<span class="normal"><a href="#__codelineno-72-42">42</a></span>
<span class="normal"><a href="#__codelineno-72-43">43</a></span>
<span class="normal"><a href="#__codelineno-72-44">44</a></span>
<span class="normal"><a href="#__codelineno-72-45">45</a></span>
<span class="normal"><a href="#__codelineno-72-46">46</a></span>
<span class="normal"><a href="#__codelineno-72-47">47</a></span>
<span class="normal"><a href="#__codelineno-72-48">48</a></span>
<span class="normal"><a href="#__codelineno-72-49">49</a></span>
<span class="normal"><a href="#__codelineno-72-50">50</a></span>
<span class="normal"><a href="#__codelineno-72-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Range7Iterator</span><span class="p">:</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">range_obj</span><span class="p">):</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">range_obj</span> <span class="o">=</span> <span class="n">range_obj</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">=</span> <span class="n">range_obj</span><span class="o">.</span><span class="n">start</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a>   <span class="o">...</span><span class="p">:</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_obj</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
<a id="__codelineno-72-10" name="__codelineno-72-10"></a>   <span class="o">...</span><span class="p">:</span>                 <span class="k">raise</span> <span class="ne">StopIteration</span>
<a id="__codelineno-72-11" name="__codelineno-72-11"></a>   <span class="o">...</span><span class="p">:</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">):</span>
<a id="__codelineno-72-12" name="__codelineno-72-12"></a>   <span class="o">...</span><span class="p">:</span>                 <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span>
<a id="__codelineno-72-13" name="__codelineno-72-13"></a>   <span class="o">...</span><span class="p">:</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-72-14" name="__codelineno-72-14"></a>   <span class="o">...</span><span class="p">:</span>                 <span class="k">return</span> <span class="n">ret</span>
<a id="__codelineno-72-15" name="__codelineno-72-15"></a>   <span class="o">...</span><span class="p">:</span>             <span class="bp">self</span><span class="o">.</span><span class="n">current</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-72-16" name="__codelineno-72-16"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">num_is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<a id="__codelineno-72-17" name="__codelineno-72-17"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-72-18" name="__codelineno-72-18"></a>   <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-72-19" name="__codelineno-72-19"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">num</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="s1">&#39;7&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<a id="__codelineno-72-20" name="__codelineno-72-20"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-72-21" name="__codelineno-72-21"></a>
<a id="__codelineno-72-22" name="__codelineno-72-22"></a><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Range7</span><span class="p">:</span>
<a id="__codelineno-72-23" name="__codelineno-72-23"></a>   <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;生成某个范围可被7整除或包含7的数字&quot;&quot;&quot;</span>
<a id="__codelineno-72-24" name="__codelineno-72-24"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<a id="__codelineno-72-25" name="__codelineno-72-25"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
<a id="__codelineno-72-26" name="__codelineno-72-26"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
<a id="__codelineno-72-27" name="__codelineno-72-27"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-72-28" name="__codelineno-72-28"></a>   <span class="o">...</span><span class="p">:</span>         <span class="c1"># 返回一个新的迭代器对象</span>
<a id="__codelineno-72-29" name="__codelineno-72-29"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">Range7Iterator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-72-30" name="__codelineno-72-30"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-72-31" name="__codelineno-72-31"></a>
<a id="__codelineno-72-32" name="__codelineno-72-32"></a><span class="c1"># 可迭代对象</span>
<a id="__codelineno-72-33" name="__codelineno-72-33"></a><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">Range7</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-72-34" name="__codelineno-72-34"></a>
<a id="__codelineno-72-35" name="__codelineno-72-35"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a id="__codelineno-72-36" name="__codelineno-72-36"></a><span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
<a id="__codelineno-72-37" name="__codelineno-72-37"></a>
<a id="__codelineno-72-38" name="__codelineno-72-38"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a id="__codelineno-72-39" name="__codelineno-72-39"></a><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
<a id="__codelineno-72-40" name="__codelineno-72-40"></a>
<a id="__codelineno-72-41" name="__codelineno-72-41"></a><span class="c1"># 迭代器</span>
<a id="__codelineno-72-42" name="__codelineno-72-42"></a><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">Range7Iterator</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a id="__codelineno-72-43" name="__codelineno-72-43"></a>
<a id="__codelineno-72-44" name="__codelineno-72-44"></a><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a id="__codelineno-72-45" name="__codelineno-72-45"></a><span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
<a id="__codelineno-72-46" name="__codelineno-72-46"></a>
<a id="__codelineno-72-47" name="__codelineno-72-47"></a><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<a id="__codelineno-72-48" name="__codelineno-72-48"></a><span class="n">Out</span><span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="p">()</span>
<a id="__codelineno-72-49" name="__codelineno-72-49"></a>
<a id="__codelineno-72-50" name="__codelineno-72-50"></a><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">r</span>
<a id="__codelineno-72-51" name="__codelineno-72-51"></a><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">Range7Iterator</span> <span class="n">at</span> <span class="mh">0x2213941dea0</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<h3 id="_40">生成器是迭代器<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-73-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-73-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-73-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-73-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-73-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-73-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-73-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-73-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-73-10">10</a></span>
<span class="normal"><a href="#__codelineno-73-11">11</a></span>
<span class="normal"><a href="#__codelineno-73-12">12</a></span>
<span class="normal"><a href="#__codelineno-73-13">13</a></span>
<span class="normal"><a href="#__codelineno-73-14">14</a></span>
<span class="normal"><a href="#__codelineno-73-15">15</a></span>
<span class="normal"><a href="#__codelineno-73-16">16</a></span>
<span class="normal"><a href="#__codelineno-73-17">17</a></span>
<span class="normal"><a href="#__codelineno-73-18">18</a></span>
<span class="normal"><a href="#__codelineno-73-19">19</a></span>
<span class="normal"><a href="#__codelineno-73-20">20</a></span>
<span class="normal"><a href="#__codelineno-73-21">21</a></span>
<span class="normal"><a href="#__codelineno-73-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">range_7_gen</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;生成器版本的Range7Iterator&quot;&quot;&quot;</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">num</span> <span class="o">=</span> <span class="n">start</span>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">while</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span><span class="p">(</span><span class="n">num</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="s2">&quot;7&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)):</span>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a>    <span class="o">...</span><span class="p">:</span>             <span class="k">yield</span> <span class="n">num</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-73-9" name="__codelineno-73-9"></a>
<a id="__codelineno-73-10" name="__codelineno-73-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">nums</span> <span class="o">=</span> <span class="n">range_7_gen</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-73-11" name="__codelineno-73-11"></a>
<a id="__codelineno-73-12" name="__codelineno-73-12"></a><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="nb">iter</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<a id="__codelineno-73-13" name="__codelineno-73-13"></a><span class="n">Out</span><span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">generator</span> <span class="nb">object</span> <span class="n">range_7_gen</span> <span class="n">at</span> <span class="mh">0x0000022138F89E00</span><span class="o">&gt;</span>
<a id="__codelineno-73-14" name="__codelineno-73-14"></a>
<a id="__codelineno-73-15" name="__codelineno-73-15"></a><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nb">iter</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span> <span class="ow">is</span> <span class="n">nums</span>
<a id="__codelineno-73-16" name="__codelineno-73-16"></a><span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-73-17" name="__codelineno-73-17"></a>
<a id="__codelineno-73-18" name="__codelineno-73-18"></a><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<a id="__codelineno-73-19" name="__codelineno-73-19"></a><span class="n">Out</span><span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="mi">7</span>
<a id="__codelineno-73-20" name="__codelineno-73-20"></a>
<a id="__codelineno-73-21" name="__codelineno-73-21"></a><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<a id="__codelineno-73-22" name="__codelineno-73-22"></a><span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="mi">14</span>
</code></pre></div></td></tr></table></div>
<h3 id="itertools">使用itertools模块优化循环<a class="headerlink" href="#itertools" title="Permanent link">&para;</a></h3>
<h4 id="product">使用product()扁平化多层嵌套循环<a class="headerlink" href="#product" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span>
<span class="normal"><a href="#__codelineno-74-2">2</a></span>
<span class="normal"><a href="#__codelineno-74-3">3</a></span>
<span class="normal"><a href="#__codelineno-74-4">4</a></span>
<span class="normal"><a href="#__codelineno-74-5">5</a></span>
<span class="normal"><a href="#__codelineno-74-6">6</a></span>
<span class="normal"><a href="#__codelineno-74-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="k">def</span> <span class="nf">find_twelve</span><span class="p">(</span><span class="n">num_list1</span><span class="p">,</span> <span class="n">num_list2</span><span class="p">,</span> <span class="n">num_list3</span><span class="p">):</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;从三个数字列表中，寻找是否存在和为12的三个数&quot;&quot;&quot;</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a>    <span class="k">for</span> <span class="n">num1</span> <span class="ow">in</span> <span class="n">num_list1</span><span class="p">:</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a>        <span class="k">for</span> <span class="n">num2</span> <span class="ow">in</span> <span class="n">num_list2</span><span class="p">:</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a>            <span class="k">for</span> <span class="n">num3</span> <span class="ow">in</span> <span class="n">num_list3</span><span class="p">:</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a>                <span class="k">if</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span> <span class="o">+</span> <span class="n">num3</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a>                    <span class="k">return</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span>
</code></pre></div></td></tr></table></div>
<p>对于嵌套遍历多个对象的多层循环代码，我们可以使用product()函数来优化它，product()接收多个可迭代对象作为参数，然后根据他们的笛卡尔积不断生成结果：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span>
<span class="normal"><a href="#__codelineno-75-2">2</a></span>
<span class="normal"><a href="#__codelineno-75-3">3</a></span>
<span class="normal"><a href="#__codelineno-75-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="n">product</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]))</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span>
<span class="normal"><a href="#__codelineno-76-2">2</a></span>
<span class="normal"><a href="#__codelineno-76-3">3</a></span>
<span class="normal"><a href="#__codelineno-76-4">4</a></span>
<span class="normal"><a href="#__codelineno-76-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">find_twelve_v2</span><span class="p">(</span><span class="n">num_list1</span><span class="p">,</span> <span class="n">num_list2</span><span class="p">,</span> <span class="n">num_list3</span><span class="p">):</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">num_list1</span><span class="p">,</span> <span class="n">num_list2</span><span class="p">,</span> <span class="n">num_list3</span><span class="p">):</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">num1</span> <span class="o">+</span> <span class="n">num2</span> <span class="o">+</span> <span class="n">num3</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a>   <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">num3</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a>   <span class="o">...</span><span class="p">:</span>
</code></pre></div></td></tr></table></div>
<h4 id="islice">使用islice()实现循环内隔行处理<a class="headerlink" href="#islice" title="Permanent link">&para;</a></h4>
<p>优化之前：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span>
<span class="normal"><a href="#__codelineno-77-2">2</a></span>
<span class="normal"><a href="#__codelineno-77-3">3</a></span>
<span class="normal"><a href="#__codelineno-77-4">4</a></span>
<span class="normal"><a href="#__codelineno-77-5">5</a></span>
<span class="normal"><a href="#__codelineno-77-6">6</a></span>
<span class="normal"><a href="#__codelineno-77-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="k">def</span> <span class="nf">parse_titles</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;从隔行数据文件中读取 Reddit 主题名称&quot;&quot;&quot;</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a>            <span class="c1"># 跳过无意义的”---“分隔符</span>
<a id="__codelineno-77-6" name="__codelineno-77-6"></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-77-7" name="__codelineno-77-7"></a>                <span class="k">yield</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></p>
<p><code>islice(seq, start, end, step)</code>函数和数组切片操作<code>list(start:stop:step)</code>接收的参数几乎完全一致，如果需要在循环内部实现隔行处理，只需要设置第三个参数<code>step</code>（步长）的值为2：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span>
<span class="normal"><a href="#__codelineno-78-3">3</a></span>
<span class="normal"><a href="#__codelineno-78-4">4</a></span>
<span class="normal"><a href="#__codelineno-78-5">5</a></span>
<span class="normal"><a href="#__codelineno-78-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="k">def</span> <span class="nf">parse_titles_v2</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a>        <span class="c1"># 设置step=2, 跳过无意义的 &quot;---&quot;分隔符</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">islice</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a>            <span class="k">yield</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="takewhilebreak">使用takewhile()替代break语句<a class="headerlink" href="#takewhilebreak" title="Permanent link">&para;</a></h4>
<p>优化之前的代码：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span>
<span class="normal"><a href="#__codelineno-79-3">3</a></span>
<span class="normal"><a href="#__codelineno-79-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a>    <span class="c1"># 当第一个不合格的用户出现后，不再进行后面的处理</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="ow">is</span> <span class="n">qualified</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a>        <span class="k">break</span>
</code></pre></div></td></tr></table></div>
<code>takewhile(predicate, iterable)</code>会在第二个参数iterable的过程中，不断使用当前值作为参数调用<code>predicate()</code>函数，并对返回结果进行真值测试，如果为True，返回当前值并继续进行迭代，否则立即中断本次迭代：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span>
<span class="normal"><a href="#__codelineno-80-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="n">form</span> <span class="n">itertools</span> <span class="kn">import</span> <span class="nn">takewhile</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">takewhile</span><span class="p">(</span><span class="n">is_qualified</span><span class="p">,</span> <span class="n">users</span><span class="p">):</span>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a>    <span class="c1"># 其它逻辑。。</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_41">案例<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h3>
<p>读取一个为4GB的文件，行数为1
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-81-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-81-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-81-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-81-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-81-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-81-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-81-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-81-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-81-10">10</a></span>
<span class="normal"><a href="#__codelineno-81-11">11</a></span>
<span class="normal"><a href="#__codelineno-81-12">12</a></span>
<span class="normal"><a href="#__codelineno-81-13">13</a></span>
<span class="normal"><a href="#__codelineno-81-14">14</a></span>
<span class="normal"><a href="#__codelineno-81-15">15</a></span>
<span class="normal"><a href="#__codelineno-81-16">16</a></span>
<span class="normal"><a href="#__codelineno-81-17">17</a></span>
<span class="normal"><a href="#__codelineno-81-18">18</a></span>
<span class="normal"><a href="#__codelineno-81-19">19</a></span>
<span class="normal"><a href="#__codelineno-81-20">20</a></span>
<span class="normal"><a href="#__codelineno-81-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">partial</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a><span class="k">def</span> <span class="nf">read_file_digits</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="mi">1024</span><span class="o">*</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-81-6" name="__codelineno-81-6"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;生成器函数：分块读取文件内容，返回其中的数字字符&quot;&quot;&quot;</span>
<a id="__codelineno-81-7" name="__codelineno-81-7"></a>    <span class="n">_read</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">,</span> <span class="n">block_size</span><span class="p">):</span>
<a id="__codelineno-81-8" name="__codelineno-81-8"></a>    <span class="c1"># 如果_read变量为空（&#39;&#39;）则停止迭代</span>
<a id="__codelineno-81-9" name="__codelineno-81-9"></a>    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">_read</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
<a id="__codelineno-81-10" name="__codelineno-81-10"></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">chunk</span><span class="p">:</span>
<a id="__codelineno-81-11" name="__codelineno-81-11"></a>            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
<a id="__codelineno-81-12" name="__codelineno-81-12"></a>                <span class="k">yield</span> <span class="n">s</span>
<a id="__codelineno-81-13" name="__codelineno-81-13"></a>
<a id="__codelineno-81-14" name="__codelineno-81-14"></a>
<a id="__codelineno-81-15" name="__codelineno-81-15"></a><span class="k">def</span> <span class="nf">count_even_groups</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<a id="__codelineno-81-16" name="__codelineno-81-16"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-81-17" name="__codelineno-81-17"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-81-18" name="__codelineno-81-18"></a>        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">read_file_digits</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
<a id="__codelineno-81-19" name="__codelineno-81-19"></a>            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-81-20" name="__codelineno-81-20"></a>                <span class="n">counter</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">))</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-81-21" name="__codelineno-81-21"></a>        <span class="k">return</span> <span class="n">counter</span>
</code></pre></div></td></tr></table></div></p>
<p>这个案例告诉我们，编写循环时，我们需要时常问自己：“循环体的代码是不是过长，过于复杂？”如果答案肯定，那就试着把代码按职责分类，抽象成独立的生成器（或迭代器）吧。</p>
<h3 id="nextkey">巧用next函数获取字典第一个key<a class="headerlink" href="#nextkey" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</code></pre></div></td></tr></table></div>
<p>有一个很大的数字列表，用生成器获取能被7整除的第一个数字：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1">1</a></span>
<span class="normal"><a href="#__codelineno-83-2">2</a></span>
<span class="normal"><a href="#__codelineno-83-3">3</a></span>
<span class="normal"><a href="#__codelineno-83-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">42</span><span class="p">]</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numbers</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-83-4" name="__codelineno-83-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="mi">21</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_42">当心已被耗尽的生成器<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1">1</a></span>
<span class="normal"><a href="#__codelineno-84-2">2</a></span>
<span class="normal"><a href="#__codelineno-84-3">3</a></span>
<span class="normal"><a href="#__codelineno-84-4">4</a></span>
<span class="normal"><a href="#__codelineno-84-5">5</a></span>
<span class="normal"><a href="#__codelineno-84-6">6</a></span>
<span class="normal"><a href="#__codelineno-84-7">7</a></span>
<span class="normal"><a href="#__codelineno-84-8">8</a></span>
<span class="normal"><a href="#__codelineno-84-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">)</span>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">numbers</span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-84-7" name="__codelineno-84-7"></a>
<a id="__codelineno-84-8" name="__codelineno-84-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">numbers</span>
<a id="__codelineno-84-9" name="__codelineno-84-9"></a><span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
<p>可以将生成器转为列表后再调用
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1">1</a></span>
<span class="normal"><a href="#__codelineno-85-2">2</a></span>
<span class="normal"><a href="#__codelineno-85-3">3</a></span>
<span class="normal"><a href="#__codelineno-85-4">4</a></span>
<span class="normal"><a href="#__codelineno-85-5">5</a></span>
<span class="normal"><a href="#__codelineno-85-6">6</a></span>
<span class="normal"><a href="#__codelineno-85-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">numbers_2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">)</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">numbers_2</span>
<a id="__codelineno-85-4" name="__codelineno-85-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-85-5" name="__codelineno-85-5"></a>
<a id="__codelineno-85-6" name="__codelineno-85-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">numbers_2</span>
<a id="__codelineno-85-7" name="__codelineno-85-7"></a><span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="_43">函数<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h2>
<h3 id="_44">定义特殊对象来区分是否提供了默认参数<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h3>
<p>无法严格区分调用方是不是真的提供了这个<code>None</code>作为默认参数:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span>
<span class="normal"><a href="#__codelineno-86-2">2</a></span>
<span class="normal"><a href="#__codelineno-86-3">3</a></span>
<span class="normal"><a href="#__codelineno-86-4">4</a></span>
<span class="normal"><a href="#__codelineno-86-5">5</a></span>
<span class="normal"><a href="#__codelineno-86-6">6</a></span>
<span class="normal"><a href="#__codelineno-86-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="k">def</span> <span class="nf">dump_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a>    <span class="k">if</span> <span class="n">extra</span> <span class="ow">is</span> <span class="kc">None</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a>        <span class="c1"># 无法区分是否提供None是不是主动传入的</span>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a>
<a id="__codelineno-86-5" name="__codelineno-86-5"></a><span class="c1"># 两种调用方式</span>
<a id="__codelineno-86-6" name="__codelineno-86-6"></a><span class="n">dump_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-86-7" name="__codelineno-86-7"></a><span class="n">dump_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>要解决这个问题，最常见的方法是定义一个特殊对象（标记变量）作为参数的默认参数：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span>
<span class="normal"><a href="#__codelineno-87-2">2</a></span>
<span class="normal"><a href="#__codelineno-87-3">3</a></span>
<span class="normal"><a href="#__codelineno-87-4">4</a></span>
<span class="normal"><a href="#__codelineno-87-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="c1"># object 通常不会单独使用，但是拿来做这种标记变量刚刚好</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="n">_not_set</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a><span class="k">def</span> <span class="nf">dump_value</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="n">_not_set</span><span class="p">)</span>
<a id="__codelineno-87-4" name="__codelineno-87-4"></a>    <span class="k">if</span> <span class="n">extra</span> <span class="ow">is</span> <span class="n">_not_set</span><span class="p">:</span>
<a id="__codelineno-87-5" name="__codelineno-87-5"></a>        <span class="c1"># 调用发没有传递extra参数</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="functools">functools<a class="headerlink" href="#functools" title="Permanent link">&para;</a></h3>
<h4 id="functoolspartial">functools.partial()<a class="headerlink" href="#functoolspartial" title="Permanent link">&para;</a></h4>
<p>...</p>
<h4 id="functoolslru_cache">functools.lru_cache()<a class="headerlink" href="#functoolslru_cache" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-88-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-88-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-88-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-88-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-88-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-88-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-88-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-88-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-88-10">10</a></span>
<span class="normal"><a href="#__codelineno-88-11">11</a></span>
<span class="normal"><a href="#__codelineno-88-12">12</a></span>
<span class="normal"><a href="#__codelineno-88-13">13</a></span>
<span class="normal"><a href="#__codelineno-88-14">14</a></span>
<span class="normal"><a href="#__codelineno-88-15">15</a></span>
<span class="normal"><a href="#__codelineno-88-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">lru_cache</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="nd">@lru_cache</span><span class="p">(</span><span class="n">maxsize</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-88-4" name="__codelineno-88-4"></a>   <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">calculate_score</span><span class="p">(</span><span class="n">class_id</span><span class="p">):</span>
<a id="__codelineno-88-5" name="__codelineno-88-5"></a>   <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Calculating score for class: </span><span class="si">{</span><span class="n">class_id</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>
<a id="__codelineno-88-6" name="__codelineno-88-6"></a>   <span class="o">...</span><span class="p">:</span>     <span class="c1"># 模拟一些速度很慢的代码</span>
<a id="__codelineno-88-7" name="__codelineno-88-7"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
<a id="__codelineno-88-8" name="__codelineno-88-8"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="mi">42</span>
<a id="__codelineno-88-9" name="__codelineno-88-9"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-88-10" name="__codelineno-88-10"></a><span class="c1"># 没有命中缓存，执行较慢</span>
<a id="__codelineno-88-11" name="__codelineno-88-11"></a><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">calculate_score</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-88-12" name="__codelineno-88-12"></a><span class="n">Calculating</span> <span class="n">score</span> <span class="k">for</span> <span class="n">class</span><span class="p">:</span> <span class="mf">100.</span><span class="o">..</span>
<a id="__codelineno-88-13" name="__codelineno-88-13"></a><span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">42</span>
<a id="__codelineno-88-14" name="__codelineno-88-14"></a>
<a id="__codelineno-88-15" name="__codelineno-88-15"></a><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">calculate_score</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-88-16" name="__codelineno-88-16"></a><span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="mi">42</span>
</code></pre></div></td></tr></table></div>
<p>使用lru_cache()装饰器时，可以传入一个可选的<code>maxsize</code>参数，该参数代表当前函数可以保存多少个缓存结果，当超过时，程序会基于“最近最少使用”算法丢掉旧缓存，默认情况下<code>maxsize</code>参数的值为128，设置为None，代表不剔除缓存。</p>
<h3 id="_45">案例<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h3>
<p>使用闭包替换有状态函数
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-89-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-89-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-89-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-89-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-89-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-89-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-89-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-89-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-89-10">10</a></span>
<span class="normal"><a href="#__codelineno-89-11">11</a></span>
<span class="normal"><a href="#__codelineno-89-12">12</a></span>
<span class="normal"><a href="#__codelineno-89-13">13</a></span>
<span class="normal"><a href="#__codelineno-89-14">14</a></span>
<span class="normal"><a href="#__codelineno-89-15">15</a></span>
<span class="normal"><a href="#__codelineno-89-16">16</a></span>
<span class="normal"><a href="#__codelineno-89-17">17</a></span>
<span class="normal"><a href="#__codelineno-89-18">18</a></span>
<span class="normal"><a href="#__codelineno-89-19">19</a></span>
<span class="normal"><a href="#__codelineno-89-20">20</a></span>
<span class="normal"><a href="#__codelineno-89-21">21</a></span>
<span class="normal"><a href="#__codelineno-89-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">make_cyclic_mosaic</span><span class="p">():</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a><span class="s2">   ...:     将匹配到的模式替换成其它字符，使用闭包实现轮换字符效果</span>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a><span class="s2">   ...:     &quot;&quot;&quot;</span>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">char_index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-89-6" name="__codelineno-89-6"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">mosaic_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
<a id="__codelineno-89-7" name="__codelineno-89-7"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">_mosaic</span><span class="p">(</span><span class="n">matchobj</span><span class="p">):</span>
<a id="__codelineno-89-8" name="__codelineno-89-8"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">nonlocal</span> <span class="n">char_index</span>
<a id="__codelineno-89-9" name="__codelineno-89-9"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">char</span> <span class="o">=</span> <span class="n">mosaic_chars</span><span class="p">[</span><span class="n">char_index</span><span class="p">]</span>
<a id="__codelineno-89-10" name="__codelineno-89-10"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">char_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">char_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">mosaic_chars</span><span class="p">)</span>
<a id="__codelineno-89-11" name="__codelineno-89-11"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
<a id="__codelineno-89-12" name="__codelineno-89-12"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">char</span> <span class="o">*</span> <span class="n">length</span>
<a id="__codelineno-89-13" name="__codelineno-89-13"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">_mosaic</span>
<a id="__codelineno-89-14" name="__codelineno-89-14"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-89-15" name="__codelineno-89-15"></a>
<a id="__codelineno-89-16" name="__codelineno-89-16"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">re</span>
<a id="__codelineno-89-17" name="__codelineno-89-17"></a>
<a id="__codelineno-89-18" name="__codelineno-89-18"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">make_cyclic_mosaic</span><span class="p">(),</span> <span class="s2">&quot;商店共10个苹果，小明以12元每斤的价格买走了&quot;</span><span class="p">)</span>
<a id="__codelineno-89-19" name="__codelineno-89-19"></a><span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="s1">&#39;商店共**个苹果，小明以xx元每斤的价格买走了&#39;</span>
<a id="__codelineno-89-20" name="__codelineno-89-20"></a>
<a id="__codelineno-89-21" name="__codelineno-89-21"></a><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">make_cyclic_mosaic</span><span class="p">(),</span> <span class="s2">&quot;商店共10个苹果，小明以12元每斤的价格买走了&quot;</span><span class="p">)</span>
<a id="__codelineno-89-22" name="__codelineno-89-22"></a><span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="s1">&#39;商店共**个苹果，小明以xx元每斤的价格买走了&#39;</span>
</code></pre></div></td></tr></table></div></p>
<p>使用类来替换有状态函数：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-90-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-90-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-90-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-90-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-90-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-90-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-90-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-90-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-90-10">10</a></span>
<span class="normal"><a href="#__codelineno-90-11">11</a></span>
<span class="normal"><a href="#__codelineno-90-12">12</a></span>
<span class="normal"><a href="#__codelineno-90-13">13</a></span>
<span class="normal"><a href="#__codelineno-90-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">CyclicMosaic</span><span class="p">:</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;使用会轮换的屏蔽字符，基于类实现&quot;&quot;&quot;</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">_chars</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]</span>
<a id="__codelineno-90-4" name="__codelineno-90-4"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-90-5" name="__codelineno-90-5"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_char_index</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-90-6" name="__codelineno-90-6"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matchobj</span><span class="p">):</span>
<a id="__codelineno-90-7" name="__codelineno-90-7"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">char</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_chars</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_char_index</span><span class="p">]</span>
<a id="__codelineno-90-8" name="__codelineno-90-8"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_char_index</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_char_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chars</span><span class="p">)</span>
<a id="__codelineno-90-9" name="__codelineno-90-9"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matchobj</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>
<a id="__codelineno-90-10" name="__codelineno-90-10"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">char</span> <span class="o">*</span> <span class="n">length</span>
<a id="__codelineno-90-11" name="__codelineno-90-11"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-90-12" name="__codelineno-90-12"></a>
<a id="__codelineno-90-13" name="__codelineno-90-13"></a><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\d+&quot;</span><span class="p">,</span> <span class="n">CyclicMosaic</span><span class="p">()</span><span class="o">.</span><span class="n">generate</span><span class="p">,</span> <span class="s2">&quot;商店用有100个苹果，小明以12元每斤的价格买走了8个&quot;</span><span class="p">)</span>
<a id="__codelineno-90-14" name="__codelineno-90-14"></a><span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="s1">&#39;商店用有***个苹果，小明以xx元每斤的价格买走了*个&#39;</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="lambda">你没有那么需要lambda<a class="headerlink" href="#lambda" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span>
<span class="normal"><a href="#__codelineno-91-2">2</a></span>
<span class="normal"><a href="#__codelineno-91-3">3</a></span>
<span class="normal"><a href="#__codelineno-91-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;11&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>上面的匿名函数，其实什么也没干，知识把调用的值传给了int，可以直接这么写：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span>
<span class="normal"><a href="#__codelineno-92-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div></p>
<p>用lambda获取字典某个key的值:
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">:</span><span class="n">obj</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
可以改为使用<code>operator</code>模块里的函数来代替：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span>
<span class="normal"><a href="#__codelineno-94-3">3</a></span>
<span class="normal"><a href="#__codelineno-94-4">4</a></span>
<span class="normal"><a href="#__codelineno-94-5">5</a></span>
<span class="normal"><a href="#__codelineno-94-6">6</a></span>
<span class="normal"><a href="#__codelineno-94-7">7</a></span>
<span class="normal"><a href="#__codelineno-94-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3"></a><span class="c1"># 返回一个新的函数，等同于obj[&#39;name&#39;]</span>
<a id="__codelineno-94-4" name="__codelineno-94-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<a id="__codelineno-94-5" name="__codelineno-94-5"></a><span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<a id="__codelineno-94-6" name="__codelineno-94-6"></a>
<a id="__codelineno-94-7" name="__codelineno-94-7"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">itemgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;foo&quot;</span><span class="p">})</span>
<a id="__codelineno-94-8" name="__codelineno-94-8"></a><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="s1">&#39;foo&#39;</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<p>除了<code>itemgetter()</code>以外，<code>operator</code>模块里还有许多有用的函数，它们都可以用来替代简单的操作运算类匿名函数，比如<code>add()</code>、<code>attrgetter()</code>等</p>
<h2 id="_46">装饰器<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h2>
<h3 id="functoolswraps">使用functools.wraps()修饰包装函数<a class="headerlink" href="#functoolswraps" title="Permanent link">&para;</a></h3>
<p>由于装饰器函数会重新定义被装饰器的函数属性，所以需要使用wraps装饰器来保留原函数的属性
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-96-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-96-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-96-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-96-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-96-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-96-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-96-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-96-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-96-10">10</a></span>
<span class="normal"><a href="#__codelineno-96-11">11</a></span>
<span class="normal"><a href="#__codelineno-96-12">12</a></span>
<span class="normal"><a href="#__codelineno-96-13">13</a></span>
<span class="normal"><a href="#__codelineno-96-14">14</a></span>
<span class="normal"><a href="#__codelineno-96-15">15</a></span>
<span class="normal"><a href="#__codelineno-96-16">16</a></span>
<span class="normal"><a href="#__codelineno-96-17">17</a></span>
<span class="normal"><a href="#__codelineno-96-18">18</a></span>
<span class="normal"><a href="#__codelineno-96-19">19</a></span>
<span class="normal"><a href="#__codelineno-96-20">20</a></span>
<span class="normal"><a href="#__codelineno-96-21">21</a></span>
<span class="normal"><a href="#__codelineno-96-22">22</a></span>
<span class="normal"><a href="#__codelineno-96-23">23</a></span>
<span class="normal"><a href="#__codelineno-96-24">24</a></span>
<span class="normal"><a href="#__codelineno-96-25">25</a></span>
<span class="normal"><a href="#__codelineno-96-26">26</a></span>
<span class="normal"><a href="#__codelineno-96-27">27</a></span>
<span class="normal"><a href="#__codelineno-96-28">28</a></span>
<span class="normal"><a href="#__codelineno-96-29">29</a></span>
<span class="normal"><a href="#__codelineno-96-30">30</a></span>
<span class="normal"><a href="#__codelineno-96-31">31</a></span>
<span class="normal"><a href="#__codelineno-96-32">32</a></span>
<span class="normal"><a href="#__codelineno-96-33">33</a></span>
<span class="normal"><a href="#__codelineno-96-34">34</a></span>
<span class="normal"><a href="#__codelineno-96-35">35</a></span>
<span class="normal"><a href="#__codelineno-96-36">36</a></span>
<span class="normal"><a href="#__codelineno-96-37">37</a></span>
<span class="normal"><a href="#__codelineno-96-38">38</a></span>
<span class="normal"><a href="#__codelineno-96-39">39</a></span>
<span class="normal"><a href="#__codelineno-96-40">40</a></span>
<span class="normal"><a href="#__codelineno-96-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a><span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="n">print_args</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-96-4" name="__codelineno-96-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;装饰器: 打印函数耗时&quot;&quot;&quot;</span>
<a id="__codelineno-96-5" name="__codelineno-96-5"></a>    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-96-6" name="__codelineno-96-6"></a>        <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-96-7" name="__codelineno-96-7"></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-96-8" name="__codelineno-96-8"></a>            <span class="n">st</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<a id="__codelineno-96-9" name="__codelineno-96-9"></a>            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-96-10" name="__codelineno-96-10"></a>            <span class="k">if</span> <span class="n">print_args</span><span class="p">:</span>
<a id="__codelineno-96-11" name="__codelineno-96-11"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">, kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-96-12" name="__codelineno-96-12"></a>            <span class="k">return</span> <span class="n">ret</span>
<a id="__codelineno-96-13" name="__codelineno-96-13"></a>        <span class="k">return</span> <span class="n">wrapper</span>
<a id="__codelineno-96-14" name="__codelineno-96-14"></a>    <span class="k">return</span> <span class="n">decorator</span>
<a id="__codelineno-96-15" name="__codelineno-96-15"></a>
<a id="__codelineno-96-16" name="__codelineno-96-16"></a><span class="k">def</span> <span class="nf">calls_counter</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<a id="__codelineno-96-17" name="__codelineno-96-17"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-96-18" name="__codelineno-96-18"></a><span class="sd">    装饰器：记录函数被调用了多少次</span>
<a id="__codelineno-96-19" name="__codelineno-96-19"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-96-20" name="__codelineno-96-20"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-96-21" name="__codelineno-96-21"></a>    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-96-22" name="__codelineno-96-22"></a>    <span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-96-23" name="__codelineno-96-23"></a>        <span class="k">nonlocal</span> <span class="n">counter</span>
<a id="__codelineno-96-24" name="__codelineno-96-24"></a>        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-96-25" name="__codelineno-96-25"></a>        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-96-26" name="__codelineno-96-26"></a>    <span class="k">def</span> <span class="nf">print_counter</span><span class="p">():</span>
<a id="__codelineno-96-27" name="__codelineno-96-27"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Counter: </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-96-28" name="__codelineno-96-28"></a>    <span class="n">decorate</span><span class="o">.</span><span class="n">print_counter</span> <span class="o">=</span> <span class="n">print_counter</span>
<a id="__codelineno-96-29" name="__codelineno-96-29"></a>    <span class="k">return</span> <span class="n">decorate</span>
<a id="__codelineno-96-30" name="__codelineno-96-30"></a>
<a id="__codelineno-96-31" name="__codelineno-96-31"></a><span class="nd">@timer</span><span class="p">(</span><span class="n">print_args</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-96-32" name="__codelineno-96-32"></a><span class="nd">@calls_counte</span>
<a id="__codelineno-96-33" name="__codelineno-96-33"></a><span class="k">def</span> <span class="nf">random_sleep</span><span class="p">():</span>
<a id="__codelineno-96-34" name="__codelineno-96-34"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;随机小睡一会&quot;&quot;&quot;</span>
<a id="__codelineno-96-35" name="__codelineno-96-35"></a>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
<a id="__codelineno-96-36" name="__codelineno-96-36"></a>
<a id="__codelineno-96-37" name="__codelineno-96-37"></a><span class="n">In</span> <span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="n">random_sleep</span><span class="o">.</span><span class="vm">__doc__</span>
<a id="__codelineno-96-38" name="__codelineno-96-38"></a><span class="n">Out</span><span class="p">[</span><span class="mi">79</span><span class="p">]:</span> <span class="s1">&#39;随机小睡一会&#39;</span>
<a id="__codelineno-96-39" name="__codelineno-96-39"></a>
<a id="__codelineno-96-40" name="__codelineno-96-40"></a><span class="n">In</span> <span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="n">random_sleep</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-96-41" name="__codelineno-96-41"></a><span class="n">Out</span><span class="p">[</span><span class="mi">80</span><span class="p">]:</span> <span class="s1">&#39;random_sleep&#39;</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_47">装饰器实现可选参数<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-97-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-97-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-97-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-97-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-97-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-97-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-97-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-97-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-97-10">10</a></span>
<span class="normal"><a href="#__codelineno-97-11">11</a></span>
<span class="normal"><a href="#__codelineno-97-12">12</a></span>
<span class="normal"><a href="#__codelineno-97-13">13</a></span>
<span class="normal"><a href="#__codelineno-97-14">14</a></span>
<span class="normal"><a href="#__codelineno-97-15">15</a></span>
<span class="normal"><a href="#__codelineno-97-16">16</a></span>
<span class="normal"><a href="#__codelineno-97-17">17</a></span>
<span class="normal"><a href="#__codelineno-97-18">18</a></span>
<span class="normal"><a href="#__codelineno-97-19">19</a></span>
<span class="normal"><a href="#__codelineno-97-20">20</a></span>
<span class="normal"><a href="#__codelineno-97-21">21</a></span>
<span class="normal"><a href="#__codelineno-97-22">22</a></span>
<span class="normal"><a href="#__codelineno-97-23">23</a></span>
<span class="normal"><a href="#__codelineno-97-24">24</a></span>
<span class="normal"><a href="#__codelineno-97-25">25</a></span>
<span class="normal"><a href="#__codelineno-97-26">26</a></span>
<span class="normal"><a href="#__codelineno-97-27">27</a></span>
<span class="normal"><a href="#__codelineno-97-28">28</a></span>
<span class="normal"><a href="#__codelineno-97-29">29</a></span>
<span class="normal"><a href="#__codelineno-97-30">30</a></span>
<span class="normal"><a href="#__codelineno-97-31">31</a></span>
<span class="normal"><a href="#__codelineno-97-32">32</a></span>
<span class="normal"><a href="#__codelineno-97-33">33</a></span>
<span class="normal"><a href="#__codelineno-97-34">34</a></span>
<span class="normal"><a href="#__codelineno-97-35">35</a></span>
<span class="normal"><a href="#__codelineno-97-36">36</a></span>
<span class="normal"><a href="#__codelineno-97-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">96</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">delayed_start</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-97-2" name="__codelineno-97-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-97-3" name="__codelineno-97-3"></a><span class="s2">    ...:     在执行被装饰函数之前，等待一段时间</span>
<a id="__codelineno-97-4" name="__codelineno-97-4"></a><span class="s2">    ...:     :param duration: 需要等待的秒数</span>
<a id="__codelineno-97-5" name="__codelineno-97-5"></a><span class="s2">    ...:     &quot;&quot;&quot;</span>
<a id="__codelineno-97-6" name="__codelineno-97-6"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">_func</span><span class="p">):</span>
<a id="__codelineno-97-7" name="__codelineno-97-7"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-97-8" name="__codelineno-97-8"></a>    <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
<a id="__codelineno-97-9" name="__codelineno-97-9"></a>    <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wait for </span><span class="si">{</span><span class="n">duration</span><span class="si">}</span><span class="s2"> second before starting...&quot;</span><span class="p">)</span>
<a id="__codelineno-97-10" name="__codelineno-97-10"></a>    <span class="o">...</span><span class="p">:</span>             <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
<a id="__codelineno-97-11" name="__codelineno-97-11"></a>    <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="n">_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-97-12" name="__codelineno-97-12"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">wrapper</span>
<a id="__codelineno-97-13" name="__codelineno-97-13"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-97-14" name="__codelineno-97-14"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">decorator</span>
<a id="__codelineno-97-15" name="__codelineno-97-15"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-97-16" name="__codelineno-97-16"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-97-17" name="__codelineno-97-17"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-97-18" name="__codelineno-97-18"></a>
<a id="__codelineno-97-19" name="__codelineno-97-19"></a><span class="n">In</span> <span class="p">[</span><span class="mi">97</span><span class="p">]:</span> <span class="nd">@delayed_start</span>
<a id="__codelineno-97-20" name="__codelineno-97-20"></a>    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<a id="__codelineno-97-21" name="__codelineno-97-21"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<a id="__codelineno-97-22" name="__codelineno-97-22"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-97-23" name="__codelineno-97-23"></a>
<a id="__codelineno-97-24" name="__codelineno-97-24"></a><span class="n">In</span> <span class="p">[</span><span class="mi">98</span><span class="p">]:</span> <span class="n">foo</span><span class="p">()</span>
<a id="__codelineno-97-25" name="__codelineno-97-25"></a><span class="o">&lt;</span><span class="n">function</span> <span class="n">foo</span> <span class="n">at</span> <span class="mh">0x000002708C931E10</span><span class="o">&gt;</span> <span class="mi">1</span>
<a id="__codelineno-97-26" name="__codelineno-97-26"></a><span class="n">Wait</span> <span class="k">for</span> <span class="mi">1</span> <span class="n">second</span> <span class="n">before</span> <span class="n">starting</span><span class="o">...</span>
<a id="__codelineno-97-27" name="__codelineno-97-27"></a><span class="n">hello</span>
<a id="__codelineno-97-28" name="__codelineno-97-28"></a>
<a id="__codelineno-97-29" name="__codelineno-97-29"></a><span class="n">In</span> <span class="p">[</span><span class="mi">99</span><span class="p">]:</span> <span class="nd">@delayed_start</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-97-30" name="__codelineno-97-30"></a>    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<a id="__codelineno-97-31" name="__codelineno-97-31"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
<a id="__codelineno-97-32" name="__codelineno-97-32"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-97-33" name="__codelineno-97-33"></a>
<a id="__codelineno-97-34" name="__codelineno-97-34"></a><span class="n">In</span> <span class="p">[</span><span class="mi">100</span><span class="p">]:</span> <span class="n">foo</span><span class="p">()</span>
<a id="__codelineno-97-35" name="__codelineno-97-35"></a><span class="kc">None</span> <span class="mi">1</span>
<a id="__codelineno-97-36" name="__codelineno-97-36"></a><span class="n">Wait</span> <span class="k">for</span> <span class="mi">1</span> <span class="n">second</span> <span class="n">before</span> <span class="n">starting</span><span class="o">...</span>
<a id="__codelineno-97-37" name="__codelineno-97-37"></a><span class="n">hello</span>
</code></pre></div></td></tr></table></div>
<h3 id="_48">用类实现装饰器(函数替换)<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-98-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-98-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-98-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-98-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-98-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-98-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-98-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-98-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-98-10">10</a></span>
<span class="normal"><a href="#__codelineno-98-11">11</a></span>
<span class="normal"><a href="#__codelineno-98-12">12</a></span>
<span class="normal"><a href="#__codelineno-98-13">13</a></span>
<span class="normal"><a href="#__codelineno-98-14">14</a></span>
<span class="normal"><a href="#__codelineno-98-15">15</a></span>
<span class="normal"><a href="#__codelineno-98-16">16</a></span>
<span class="normal"><a href="#__codelineno-98-17">17</a></span>
<span class="normal"><a href="#__codelineno-98-18">18</a></span>
<span class="normal"><a href="#__codelineno-98-19">19</a></span>
<span class="normal"><a href="#__codelineno-98-20">20</a></span>
<span class="normal"><a href="#__codelineno-98-21">21</a></span>
<span class="normal"><a href="#__codelineno-98-22">22</a></span>
<span class="normal"><a href="#__codelineno-98-23">23</a></span>
<span class="normal"><a href="#__codelineno-98-24">24</a></span>
<span class="normal"><a href="#__codelineno-98-25">25</a></span>
<span class="normal"><a href="#__codelineno-98-26">26</a></span>
<span class="normal"><a href="#__codelineno-98-27">27</a></span>
<span class="normal"><a href="#__codelineno-98-28">28</a></span>
<span class="normal"><a href="#__codelineno-98-29">29</a></span>
<span class="normal"><a href="#__codelineno-98-30">30</a></span>
<span class="normal"><a href="#__codelineno-98-31">31</a></span>
<span class="normal"><a href="#__codelineno-98-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">time</span>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a>
<a id="__codelineno-98-5" name="__codelineno-98-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">timer</span><span class="p">:</span>
<a id="__codelineno-98-6" name="__codelineno-98-6"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-98-7" name="__codelineno-98-7"></a><span class="s2">    ...:     装饰器： 打印函数耗时</span>
<a id="__codelineno-98-8" name="__codelineno-98-8"></a><span class="s2">    ...:     :param print_args: 是否打印方法名和参数，默认为False</span>
<a id="__codelineno-98-9" name="__codelineno-98-9"></a><span class="s2">    ...:     &quot;&quot;&quot;</span>
<a id="__codelineno-98-10" name="__codelineno-98-10"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_args</span><span class="p">):</span>
<a id="__codelineno-98-11" name="__codelineno-98-11"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">print_args</span> <span class="o">=</span> <span class="n">print_args</span>
<a id="__codelineno-98-12" name="__codelineno-98-12"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<a id="__codelineno-98-13" name="__codelineno-98-13"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<a id="__codelineno-98-14" name="__codelineno-98-14"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-98-15" name="__codelineno-98-15"></a>    <span class="o">...</span><span class="p">:</span>             <span class="n">st</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<a id="__codelineno-98-16" name="__codelineno-98-16"></a>    <span class="o">...</span><span class="p">:</span>             <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-98-17" name="__codelineno-98-17"></a>    <span class="o">...</span><span class="p">:</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_args</span><span class="p">:</span>
<a id="__codelineno-98-18" name="__codelineno-98-18"></a>    <span class="o">...</span><span class="p">:</span>                 <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, args: </span><span class="si">{</span><span class="n">args</span><span class="si">}</span><span class="s2">, kwargs: </span><span class="si">{</span><span class="n">kwargs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-98-19" name="__codelineno-98-19"></a>    <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time cost: </span><span class="si">{}</span><span class="s2"> seonds&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">st</span><span class="p">))</span>
<a id="__codelineno-98-20" name="__codelineno-98-20"></a>    <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="n">ret</span>
<a id="__codelineno-98-21" name="__codelineno-98-21"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">decorated</span>
<a id="__codelineno-98-22" name="__codelineno-98-22"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-98-23" name="__codelineno-98-23"></a>
<a id="__codelineno-98-24" name="__codelineno-98-24"></a><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="nd">@timer</span><span class="p">(</span><span class="n">print_args</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-98-25" name="__codelineno-98-25"></a>    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">random_sleep</span><span class="p">():</span>
<a id="__codelineno-98-26" name="__codelineno-98-26"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;随机小睡一会&quot;&quot;&quot;</span>
<a id="__codelineno-98-27" name="__codelineno-98-27"></a>    <span class="o">...</span><span class="p">:</span>     <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>
<a id="__codelineno-98-28" name="__codelineno-98-28"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-98-29" name="__codelineno-98-29"></a>
<a id="__codelineno-98-30" name="__codelineno-98-30"></a><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">random_sleep</span><span class="p">()</span>
<a id="__codelineno-98-31" name="__codelineno-98-31"></a><span class="n">random_sleep</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="p">(),</span> <span class="n">kwargs</span><span class="p">:</span> <span class="p">{}</span>
<a id="__codelineno-98-32" name="__codelineno-98-32"></a><span class="n">time</span> <span class="n">cost</span><span class="p">:</span> <span class="mf">0.34521829999721376</span> <span class="n">seonds</span>
</code></pre></div></td></tr></table></div>
<h3 id="_49">用类实现装饰器(实例替换)<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-99-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-99-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-99-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-99-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-99-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-99-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-99-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-99-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-99-10">10</a></span>
<span class="normal"><a href="#__codelineno-99-11">11</a></span>
<span class="normal"><a href="#__codelineno-99-12">12</a></span>
<span class="normal"><a href="#__codelineno-99-13">13</a></span>
<span class="normal"><a href="#__codelineno-99-14">14</a></span>
<span class="normal"><a href="#__codelineno-99-15">15</a></span>
<span class="normal"><a href="#__codelineno-99-16">16</a></span>
<span class="normal"><a href="#__codelineno-99-17">17</a></span>
<span class="normal"><a href="#__codelineno-99-18">18</a></span>
<span class="normal"><a href="#__codelineno-99-19">19</a></span>
<span class="normal"><a href="#__codelineno-99-20">20</a></span>
<span class="normal"><a href="#__codelineno-99-21">21</a></span>
<span class="normal"><a href="#__codelineno-99-22">22</a></span>
<span class="normal"><a href="#__codelineno-99-23">23</a></span>
<span class="normal"><a href="#__codelineno-99-24">24</a></span>
<span class="normal"><a href="#__codelineno-99-25">25</a></span>
<span class="normal"><a href="#__codelineno-99-26">26</a></span>
<span class="normal"><a href="#__codelineno-99-27">27</a></span>
<span class="normal"><a href="#__codelineno-99-28">28</a></span>
<span class="normal"><a href="#__codelineno-99-29">29</a></span>
<span class="normal"><a href="#__codelineno-99-30">30</a></span>
<span class="normal"><a href="#__codelineno-99-31">31</a></span>
<span class="normal"><a href="#__codelineno-99-32">32</a></span>
<span class="normal"><a href="#__codelineno-99-33">33</a></span>
<span class="normal"><a href="#__codelineno-99-34">34</a></span>
<span class="normal"><a href="#__codelineno-99-35">35</a></span>
<span class="normal"><a href="#__codelineno-99-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">DelayedStart</span><span class="p">:</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;在执行被装饰函数前，等待1秒钟&quot;&quot;&quot;</span>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
<a id="__codelineno-99-4" name="__codelineno-99-4"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
<a id="__codelineno-99-5" name="__codelineno-99-5"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
<a id="__codelineno-99-6" name="__codelineno-99-6"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-99-7" name="__codelineno-99-7"></a>   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wait for 1 second before starting...&quot;</span><span class="p">)</span>
<a id="__codelineno-99-8" name="__codelineno-99-8"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-99-9" name="__codelineno-99-9"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-99-10" name="__codelineno-99-10"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">eager_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-99-11" name="__codelineno-99-11"></a>   <span class="o">...</span><span class="p">:</span>         <span class="s2">&quot;&quot;&quot;跳过等待，立即执行被装饰函数&quot;&quot;&quot;</span>
<a id="__codelineno-99-12" name="__codelineno-99-12"></a>   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Call without delay&quot;</span><span class="p">)</span>
<a id="__codelineno-99-13" name="__codelineno-99-13"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-99-14" name="__codelineno-99-14"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-99-15" name="__codelineno-99-15"></a>
<a id="__codelineno-99-16" name="__codelineno-99-16"></a><span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="nd">@DelayedStart</span>
<a id="__codelineno-99-17" name="__codelineno-99-17"></a>    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
<a id="__codelineno-99-18" name="__codelineno-99-18"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
<a id="__codelineno-99-19" name="__codelineno-99-19"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-99-20" name="__codelineno-99-20"></a>
<a id="__codelineno-99-21" name="__codelineno-99-21"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">hello</span>
<a id="__codelineno-99-22" name="__codelineno-99-22"></a><span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">DelayedStart</span> <span class="n">at</span> <span class="mh">0x2723ea71180</span><span class="o">&gt;</span>
<a id="__codelineno-99-23" name="__codelineno-99-23"></a>
<a id="__codelineno-99-24" name="__codelineno-99-24"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="nb">type</span><span class="p">(</span><span class="n">hello</span><span class="p">)</span>
<a id="__codelineno-99-25" name="__codelineno-99-25"></a><span class="n">Out</span><span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">__main__</span><span class="o">.</span><span class="n">DelayedStart</span>
<a id="__codelineno-99-26" name="__codelineno-99-26"></a>
<a id="__codelineno-99-27" name="__codelineno-99-27"></a><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">hello</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-99-28" name="__codelineno-99-28"></a><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="s1">&#39;hello&#39;</span>
<a id="__codelineno-99-29" name="__codelineno-99-29"></a>
<a id="__codelineno-99-30" name="__codelineno-99-30"></a><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">hello</span><span class="p">()</span>
<a id="__codelineno-99-31" name="__codelineno-99-31"></a><span class="n">Wait</span> <span class="k">for</span> <span class="mi">1</span> <span class="n">second</span> <span class="n">before</span> <span class="n">starting</span><span class="o">...</span>
<a id="__codelineno-99-32" name="__codelineno-99-32"></a><span class="n">hello</span> <span class="n">world</span>
<a id="__codelineno-99-33" name="__codelineno-99-33"></a>
<a id="__codelineno-99-34" name="__codelineno-99-34"></a><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">hello</span><span class="o">.</span><span class="n">eager_call</span><span class="p">()</span>
<a id="__codelineno-99-35" name="__codelineno-99-35"></a><span class="n">Call</span> <span class="n">without</span> <span class="n">delay</span>
<a id="__codelineno-99-36" name="__codelineno-99-36"></a><span class="n">hello</span> <span class="n">world</span>
</code></pre></div></td></tr></table></div>
<h3 id="_50">用类实现带有参数的装饰器<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-100-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-100-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-100-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-100-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-100-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-100-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-100-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-100-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-100-10">10</a></span>
<span class="normal"><a href="#__codelineno-100-11">11</a></span>
<span class="normal"><a href="#__codelineno-100-12">12</a></span>
<span class="normal"><a href="#__codelineno-100-13">13</a></span>
<span class="normal"><a href="#__codelineno-100-14">14</a></span>
<span class="normal"><a href="#__codelineno-100-15">15</a></span>
<span class="normal"><a href="#__codelineno-100-16">16</a></span>
<span class="normal"><a href="#__codelineno-100-17">17</a></span>
<span class="normal"><a href="#__codelineno-100-18">18</a></span>
<span class="normal"><a href="#__codelineno-100-19">19</a></span>
<span class="normal"><a href="#__codelineno-100-20">20</a></span>
<span class="normal"><a href="#__codelineno-100-21">21</a></span>
<span class="normal"><a href="#__codelineno-100-22">22</a></span>
<span class="normal"><a href="#__codelineno-100-23">23</a></span>
<span class="normal"><a href="#__codelineno-100-24">24</a></span>
<span class="normal"><a href="#__codelineno-100-25">25</a></span>
<span class="normal"><a href="#__codelineno-100-26">26</a></span>
<span class="normal"><a href="#__codelineno-100-27">27</a></span>
<span class="normal"><a href="#__codelineno-100-28">28</a></span>
<span class="normal"><a href="#__codelineno-100-29">29</a></span>
<span class="normal"><a href="#__codelineno-100-30">30</a></span>
<span class="normal"><a href="#__codelineno-100-31">31</a></span>
<span class="normal"><a href="#__codelineno-100-32">32</a></span>
<span class="normal"><a href="#__codelineno-100-33">33</a></span>
<span class="normal"><a href="#__codelineno-100-34">34</a></span>
<span class="normal"><a href="#__codelineno-100-35">35</a></span>
<span class="normal"><a href="#__codelineno-100-36">36</a></span>
<span class="normal"><a href="#__codelineno-100-37">37</a></span>
<span class="normal"><a href="#__codelineno-100-38">38</a></span>
<span class="normal"><a href="#__codelineno-100-39">39</a></span>
<span class="normal"><a href="#__codelineno-100-40">40</a></span>
<span class="normal"><a href="#__codelineno-100-41">41</a></span>
<span class="normal"><a href="#__codelineno-100-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">DelayedStart</span><span class="p">:</span>
<a id="__codelineno-100-2" name="__codelineno-100-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-100-3" name="__codelineno-100-3"></a><span class="s2">    ...:     在执行被装饰函数之前，等待一段时间</span>
<a id="__codelineno-100-4" name="__codelineno-100-4"></a><span class="s2">    ...:     :param func: 被装饰的函数</span>
<a id="__codelineno-100-5" name="__codelineno-100-5"></a><span class="s2">    ...:     :param duration: 需要等待的秒数</span>
<a id="__codelineno-100-6" name="__codelineno-100-6"></a><span class="s2">    ...:     &quot;&quot;&quot;</span>
<a id="__codelineno-100-7" name="__codelineno-100-7"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-100-8" name="__codelineno-100-8"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">update_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
<a id="__codelineno-100-9" name="__codelineno-100-9"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
<a id="__codelineno-100-10" name="__codelineno-100-10"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
<a id="__codelineno-100-11" name="__codelineno-100-11"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-100-12" name="__codelineno-100-12"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wait for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2"> second before starting...&quot;</span><span class="p">)</span>
<a id="__codelineno-100-13" name="__codelineno-100-13"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
<a id="__codelineno-100-14" name="__codelineno-100-14"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-100-15" name="__codelineno-100-15"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">eager_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-100-16" name="__codelineno-100-16"></a>    <span class="o">...</span><span class="p">:</span>         <span class="s2">&quot;&quot;&quot;跳过等待，立即执行被装饰的函数&quot;&quot;&quot;</span>
<a id="__codelineno-100-17" name="__codelineno-100-17"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Call without delay&quot;</span><span class="p">)</span>
<a id="__codelineno-100-18" name="__codelineno-100-18"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-100-19" name="__codelineno-100-19"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-100-20" name="__codelineno-100-20"></a>
<a id="__codelineno-100-21" name="__codelineno-100-21"></a><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">delayed_start</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-100-22" name="__codelineno-100-22"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;装饰器：推迟某个函数的执行&quot;&quot;&quot;</span>
<a id="__codelineno-100-23" name="__codelineno-100-23"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">DelayedStart</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-100-24" name="__codelineno-100-24"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-100-25" name="__codelineno-100-25"></a>
<a id="__codelineno-100-26" name="__codelineno-100-26"></a><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-100-27" name="__codelineno-100-27"></a>
<a id="__codelineno-100-28" name="__codelineno-100-28"></a><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nd">@delayed_start</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-100-29" name="__codelineno-100-29"></a>    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
<a id="__codelineno-100-30" name="__codelineno-100-30"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
<a id="__codelineno-100-31" name="__codelineno-100-31"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-100-32" name="__codelineno-100-32"></a>
<a id="__codelineno-100-33" name="__codelineno-100-33"></a><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">hello</span>
<a id="__codelineno-100-34" name="__codelineno-100-34"></a><span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">DelayedStart</span> <span class="n">at</span> <span class="mh">0x2723e014580</span><span class="o">&gt;</span>
<a id="__codelineno-100-35" name="__codelineno-100-35"></a>
<a id="__codelineno-100-36" name="__codelineno-100-36"></a><span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">hello</span><span class="p">()</span>
<a id="__codelineno-100-37" name="__codelineno-100-37"></a><span class="n">Wait</span> <span class="k">for</span> <span class="mi">2</span> <span class="n">second</span> <span class="n">before</span> <span class="n">starting</span><span class="o">...</span>
<a id="__codelineno-100-38" name="__codelineno-100-38"></a><span class="n">hello</span> <span class="n">world</span>
<a id="__codelineno-100-39" name="__codelineno-100-39"></a>
<a id="__codelineno-100-40" name="__codelineno-100-40"></a><span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">hello</span><span class="o">.</span><span class="n">eager_call</span><span class="p">()</span>
<a id="__codelineno-100-41" name="__codelineno-100-41"></a><span class="n">Call</span> <span class="n">without</span> <span class="n">delay</span>
<a id="__codelineno-100-42" name="__codelineno-100-42"></a><span class="n">hello</span> <span class="n">world</span>
</code></pre></div></td></tr></table></div>
<h3 id="wrapt">使用wrapt模块助力装饰器编写<a class="headerlink" href="#wrapt" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-101-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-101-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-101-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-101-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-101-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-101-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-101-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-101-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-101-10">10</a></span>
<span class="normal"><a href="#__codelineno-101-11">11</a></span>
<span class="normal"><a href="#__codelineno-101-12">12</a></span>
<span class="normal"><a href="#__codelineno-101-13">13</a></span>
<span class="normal"><a href="#__codelineno-101-14">14</a></span>
<span class="normal"><a href="#__codelineno-101-15">15</a></span>
<span class="normal"><a href="#__codelineno-101-16">16</a></span>
<span class="normal"><a href="#__codelineno-101-17">17</a></span>
<span class="normal"><a href="#__codelineno-101-18">18</a></span>
<span class="normal"><a href="#__codelineno-101-19">19</a></span>
<span class="normal"><a href="#__codelineno-101-20">20</a></span>
<span class="normal"><a href="#__codelineno-101-21">21</a></span>
<span class="normal"><a href="#__codelineno-101-22">22</a></span>
<span class="normal"><a href="#__codelineno-101-23">23</a></span>
<span class="normal"><a href="#__codelineno-101-24">24</a></span>
<span class="normal"><a href="#__codelineno-101-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">provide_number</span><span class="p">(</span><span class="n">min_num</span><span class="p">,</span> <span class="n">max_num</span><span class="p">):</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nd">@wrapt</span><span class="o">.</span><span class="n">decorator</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">wrapped</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">num</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">min_num</span><span class="p">,</span> <span class="n">max_num</span><span class="p">)</span>
<a id="__codelineno-101-5" name="__codelineno-101-5"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span><span class="p">,)</span> <span class="o">+</span> <span class="n">args</span>
<a id="__codelineno-101-6" name="__codelineno-101-6"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="n">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-101-7" name="__codelineno-101-7"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">wrapper</span>
<a id="__codelineno-101-8" name="__codelineno-101-8"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-101-9" name="__codelineno-101-9"></a>
<a id="__codelineno-101-10" name="__codelineno-101-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="nd">@provide_number</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-101-11" name="__codelineno-101-11"></a>    <span class="o">...</span><span class="p">:</span> <span class="k">def</span> <span class="nf">print_random_number</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
<a id="__codelineno-101-12" name="__codelineno-101-12"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<a id="__codelineno-101-13" name="__codelineno-101-13"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-101-14" name="__codelineno-101-14"></a>
<a id="__codelineno-101-15" name="__codelineno-101-15"></a><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">print_random_number</span><span class="p">()</span>
<a id="__codelineno-101-16" name="__codelineno-101-16"></a><span class="mi">98</span>
<a id="__codelineno-101-17" name="__codelineno-101-17"></a>
<a id="__codelineno-101-18" name="__codelineno-101-18"></a><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
<a id="__codelineno-101-19" name="__codelineno-101-19"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nd">@provide_number</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-101-20" name="__codelineno-101-20"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">print_random_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
<a id="__codelineno-101-21" name="__codelineno-101-21"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
<a id="__codelineno-101-22" name="__codelineno-101-22"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-101-23" name="__codelineno-101-23"></a>
<a id="__codelineno-101-24" name="__codelineno-101-24"></a><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">Foo</span><span class="p">()</span><span class="o">.</span><span class="n">print_random_number</span><span class="p">()</span>
<a id="__codelineno-101-25" name="__codelineno-101-25"></a><span class="mi">82</span>
</code></pre></div></td></tr></table></div>
<h2 id="_51">面向对象编程<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h2>
<h3 id="_52">修改实例字典数据<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-102-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-102-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-102-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-102-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-102-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-102-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-102-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-102-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-102-10">10</a></span>
<span class="normal"><a href="#__codelineno-102-11">11</a></span>
<span class="normal"><a href="#__codelineno-102-12">12</a></span>
<span class="normal"><a href="#__codelineno-102-13">13</a></span>
<span class="normal"><a href="#__codelineno-102-14">14</a></span>
<span class="normal"><a href="#__codelineno-102-15">15</a></span>
<span class="normal"><a href="#__codelineno-102-16">16</a></span>
<span class="normal"><a href="#__codelineno-102-17">17</a></span>
<span class="normal"><a href="#__codelineno-102-18">18</a></span>
<span class="normal"><a href="#__codelineno-102-19">19</a></span>
<span class="normal"><a href="#__codelineno-102-20">20</a></span>
<span class="normal"><a href="#__codelineno-102-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
<a id="__codelineno-102-5" name="__codelineno-102-5"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-102-6" name="__codelineno-102-6"></a>   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hi, My name is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, I&#39;m </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-102-7" name="__codelineno-102-7"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-102-8" name="__codelineno-102-8"></a>
<a id="__codelineno-102-9" name="__codelineno-102-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">Person</span><span class="o">.</span><span class="vm">__dict__</span>
<a id="__codelineno-102-10" name="__codelineno-102-10"></a><span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
<a id="__codelineno-102-11" name="__codelineno-102-11"></a><span class="n">mappingproxy</span><span class="p">({</span><span class="s1">&#39;__module__&#39;</span><span class="p">:</span> <span class="s1">&#39;__main__&#39;</span><span class="p">,</span>
<a id="__codelineno-102-12" name="__codelineno-102-12"></a>              <span class="s1">&#39;__init__&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">__main__</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-102-13" name="__codelineno-102-13"></a>              <span class="s1">&#39;say&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">__main__</span><span class="o">.</span><span class="n">Person</span><span class="o">.</span><span class="n">say</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-102-14" name="__codelineno-102-14"></a>              <span class="s1">&#39;__dict__&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="s1">&#39;__dict__&#39;</span> <span class="n">of</span> <span class="s1">&#39;Person&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-102-15" name="__codelineno-102-15"></a>              <span class="s1">&#39;__weakref__&#39;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">attribute</span> <span class="s1">&#39;__weakref__&#39;</span> <span class="n">of</span> <span class="s1">&#39;Person&#39;</span> <span class="n">objects</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-102-16" name="__codelineno-102-16"></a>              <span class="s1">&#39;__doc__&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<a id="__codelineno-102-17" name="__codelineno-102-17"></a>
<a id="__codelineno-102-18" name="__codelineno-102-18"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;yanghe&quot;</span><span class="p">,</span><span class="mi">18</span><span class="p">)</span>
<a id="__codelineno-102-19" name="__codelineno-102-19"></a>
<a id="__codelineno-102-20" name="__codelineno-102-20"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="vm">__dict__</span>
<a id="__codelineno-102-21" name="__codelineno-102-21"></a><span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;yanghe&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li>类的<code>__dict__</code>里，保存着类的文档，所有方法等数据</li>
<li>实例<code>__dict__</code>里，保存着当前实例所有属性数据</li>
</ol>
<p>有一份<code>Person</code>实例的属性字典，把这份属性字典更新到<code>Person</code>的实例当中，使用遍历来设置属性：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1">1</a></span>
<span class="normal"><a href="#__codelineno-103-2">2</a></span>
<span class="normal"><a href="#__codelineno-103-3">3</a></span>
<span class="normal"><a href="#__codelineno-103-4">4</a></span>
<span class="normal"><a href="#__codelineno-103-5">5</a></span>
<span class="normal"><a href="#__codelineno-103-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="nb">setattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a>
<a id="__codelineno-103-5" name="__codelineno-103-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="vm">__dict__</span>
<a id="__codelineno-103-6" name="__codelineno-103-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;andrew&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>在使用<code>setattr</code>方法时，可以使用类的<code>__setattr__</code>魔法方法来控制
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-104-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-104-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-104-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-104-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-104-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-104-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-104-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-104-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-104-10">10</a></span>
<span class="normal"><a href="#__codelineno-104-11">11</a></span>
<span class="normal"><a href="#__codelineno-104-12">12</a></span>
<span class="normal"><a href="#__codelineno-104-13">13</a></span>
<span class="normal"><a href="#__codelineno-104-14">14</a></span>
<span class="normal"><a href="#__codelineno-104-15">15</a></span>
<span class="normal"><a href="#__codelineno-104-16">16</a></span>
<span class="normal"><a href="#__codelineno-104-17">17</a></span>
<span class="normal"><a href="#__codelineno-104-18">18</a></span>
<span class="normal"><a href="#__codelineno-104-19">19</a></span>
<span class="normal"><a href="#__codelineno-104-20">20</a></span>
<span class="normal"><a href="#__codelineno-104-21">21</a></span>
<span class="normal"><a href="#__codelineno-104-22">22</a></span>
<span class="normal"><a href="#__codelineno-104-23">23</a></span>
<span class="normal"><a href="#__codelineno-104-24">24</a></span>
<span class="normal"><a href="#__codelineno-104-25">25</a></span>
<span class="normal"><a href="#__codelineno-104-26">26</a></span>
<span class="normal"><a href="#__codelineno-104-27">27</a></span>
<span class="normal"><a href="#__codelineno-104-28">28</a></span>
<span class="normal"><a href="#__codelineno-104-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
<a id="__codelineno-104-3" name="__codelineno-104-3"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-104-4" name="__codelineno-104-4"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
<a id="__codelineno-104-5" name="__codelineno-104-5"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-104-6" name="__codelineno-104-6"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hi My name is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, I&#39;m </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-104-7" name="__codelineno-104-7"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-104-8" name="__codelineno-104-8"></a>    <span class="o">...</span><span class="p">:</span>         <span class="c1"># 不允许设置年龄小于0</span>
<a id="__codelineno-104-9" name="__codelineno-104-9"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;age&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-104-10" name="__codelineno-104-10"></a>    <span class="o">...</span><span class="p">:</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid age value: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-104-11" name="__codelineno-104-11"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-104-12" name="__codelineno-104-12"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-104-13" name="__codelineno-104-13"></a>
<a id="__codelineno-104-14" name="__codelineno-104-14"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;yanghe&quot;</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-104-15" name="__codelineno-104-15"></a>
<a id="__codelineno-104-16" name="__codelineno-104-16"></a><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
<a id="__codelineno-104-17" name="__codelineno-104-17"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-104-18" name="__codelineno-104-18"></a><span class="ne">ValueError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-104-19" name="__codelineno-104-19"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-104-20" name="__codelineno-104-20"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">p</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
<a id="__codelineno-104-21" name="__codelineno-104-21"></a>
<a id="__codelineno-104-22" name="__codelineno-104-22"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">10</span><span class="p">,</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-104-23" name="__codelineno-104-23"></a>      <span class="mi">7</span> <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-104-24" name="__codelineno-104-24"></a>      <span class="mi">8</span>     <span class="c1"># 不允许设置年龄小于0</span>
<a id="__codelineno-104-25" name="__codelineno-104-25"></a>      <span class="mi">9</span>     <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;age&quot;</span> <span class="ow">and</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-104-26" name="__codelineno-104-26"></a><span class="o">---&gt;</span> <span class="mi">10</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid age value: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-104-27" name="__codelineno-104-27"></a>     <span class="mi">11</span>     <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-104-28" name="__codelineno-104-28"></a>
<a id="__codelineno-104-29" name="__codelineno-104-29"></a><span class="ne">ValueError</span><span class="p">:</span> <span class="n">Invalid</span> <span class="n">age</span> <span class="n">value</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span>
</code></pre></div></td></tr></table></div></p>
<p>如果直接操作<code>__dict__</code>字典，就可以无视这个限制：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1">1</a></span>
<span class="normal"><a href="#__codelineno-105-2">2</a></span>
<span class="normal"><a href="#__codelineno-105-3">3</a></span>
<span class="normal"><a href="#__codelineno-105-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a>
<a id="__codelineno-105-3" name="__codelineno-105-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">say</span><span class="p">()</span>
<a id="__codelineno-105-4" name="__codelineno-105-4"></a><span class="n">Hi</span> <span class="n">My</span> <span class="n">name</span> <span class="ow">is</span> <span class="n">yanghe</span><span class="p">,</span> <span class="n">I</span><span class="s1">&#39;m -3</span>
</code></pre></div></td></tr></table></div></p>
<p>或者使用<code>update</code>来更新：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1">1</a></span>
<span class="normal"><a href="#__codelineno-106-2">2</a></span>
<span class="normal"><a href="#__codelineno-106-3">3</a></span>
<span class="normal"><a href="#__codelineno-106-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;tom&quot;</span><span class="p">,</span><span class="s2">&quot;age&quot;</span><span class="p">:</span><span class="mi">30</span><span class="p">})</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="vm">__dict__</span>
<a id="__codelineno-106-4" name="__codelineno-106-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;tom&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="property">property 属性对象<a class="headerlink" href="#property" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-107-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-107-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-107-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-107-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-107-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-107-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-107-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-107-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-107-10">10</a></span>
<span class="normal"><a href="#__codelineno-107-11">11</a></span>
<span class="normal"><a href="#__codelineno-107-12">12</a></span>
<span class="normal"><a href="#__codelineno-107-13">13</a></span>
<span class="normal"><a href="#__codelineno-107-14">14</a></span>
<span class="normal"><a href="#__codelineno-107-15">15</a></span>
<span class="normal"><a href="#__codelineno-107-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">FilePath</span><span class="p">:</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
<a id="__codelineno-107-4" name="__codelineno-107-4"></a>   <span class="o">...</span><span class="p">:</span>     <span class="nd">@property</span>
<a id="__codelineno-107-5" name="__codelineno-107-5"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">basename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-107-6" name="__codelineno-107-6"></a>   <span class="o">...</span><span class="p">:</span>         <span class="s2">&quot;&quot;&quot;获取文件名&quot;&quot;&quot;</span>
<a id="__codelineno-107-7" name="__codelineno-107-7"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-107-8" name="__codelineno-107-8"></a>   <span class="o">...</span><span class="p">:</span>     <span class="nd">@basename</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-107-9" name="__codelineno-107-9"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">basename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-107-10" name="__codelineno-107-10"></a>   <span class="o">...</span><span class="p">:</span>         <span class="s2">&quot;&quot;&quot;修改当前路径里的文件名部分&quot;&quot;&quot;</span>
<a id="__codelineno-107-11" name="__codelineno-107-11"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">new_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-107-12" name="__codelineno-107-12"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_path</span><span class="p">)</span>
<a id="__codelineno-107-13" name="__codelineno-107-13"></a>   <span class="o">...</span><span class="p">:</span>     <span class="nd">@basename</span><span class="o">.</span><span class="n">deleter</span>
<a id="__codelineno-107-14" name="__codelineno-107-14"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">basename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-107-15" name="__codelineno-107-15"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Can not delete basename!&quot;</span><span class="p">)</span>
<a id="__codelineno-107-16" name="__codelineno-107-16"></a>   <span class="o">...</span><span class="p">:</span>
</code></pre></div></td></tr></table></div>
<p>除了<code>@property</code>以外，描述符也能做到同样的事情，并且功能更多，更强大。</p>
<h3 id="_53">鸭子类型<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h3>
<p>只会关注对象的行为，而不关注是不是某个具体的对象类型</p>
<blockquote>
<p>当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以称为鸭子。
                                                              ——来自“鸭子类型”的维基百科词条
</p>
</blockquote>
<p>也就是说，虽然Python提供了检查类型的函数<code>isinstace()</code>，但是鸭子类型并不推荐你使用它。</p>
<p>使用<code>hasattr</code>给鸭子类型增加校验，判断类型是不是有该方法，没有该方法就让它报错，统计文件中元音数量(增加校验)：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-108-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-108-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-108-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-108-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-108-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-108-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-108-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-108-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-108-10">10</a></span>
<span class="normal"><a href="#__codelineno-108-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="k">def</span> <span class="nf">count_vowels</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;统计某个文件中原因字母（aeiou）的数量&quot;&quot;&quot;</span>
<a id="__codelineno-108-3" name="__codelineno-108-3"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s2">&quot;read&quot;</span><span class="p">):</span>
<a id="__codelineno-108-4" name="__codelineno-108-4"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;must provide a valid file object&quot;</span><span class="p">)</span>
<a id="__codelineno-108-5" name="__codelineno-108-5"></a>    <span class="n">VOWELS_LETTERS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;e&quot;</span><span class="p">,</span><span class="s2">&quot;i&quot;</span><span class="p">,</span><span class="s2">&quot;o&quot;</span><span class="p">,</span><span class="s2">&quot;u&quot;</span><span class="p">}</span>
<a id="__codelineno-108-6" name="__codelineno-108-6"></a>    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-108-7" name="__codelineno-108-7"></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-108-8" name="__codelineno-108-8"></a>        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
<a id="__codelineno-108-9" name="__codelineno-108-9"></a>            <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">VOWELS_LETTERS</span><span class="p">:</span>
<a id="__codelineno-108-10" name="__codelineno-108-10"></a>                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-108-11" name="__codelineno-108-11"></a>    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_54">抽象类<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h3>
<p>只要该类实现了<code>validate</code>方法，就被当作<code>Validator</code>的子类
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-109-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-109-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-109-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-109-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-109-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-109-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-109-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-109-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-109-10">10</a></span>
<span class="normal"><a href="#__codelineno-109-11">11</a></span>
<span class="normal"><a href="#__codelineno-109-12">12</a></span>
<span class="normal"><a href="#__codelineno-109-13">13</a></span>
<span class="normal"><a href="#__codelineno-109-14">14</a></span>
<span class="normal"><a href="#__codelineno-109-15">15</a></span>
<span class="normal"><a href="#__codelineno-109-16">16</a></span>
<span class="normal"><a href="#__codelineno-109-17">17</a></span>
<span class="normal"><a href="#__codelineno-109-18">18</a></span>
<span class="normal"><a href="#__codelineno-109-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Validator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-109-2" name="__codelineno-109-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;校验器抽象类&quot;&quot;&quot;</span>
<a id="__codelineno-109-3" name="__codelineno-109-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nd">@classmethod</span>
<a id="__codelineno-109-4" name="__codelineno-109-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">__subclasshook__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
<a id="__codelineno-109-5" name="__codelineno-109-5"></a>    <span class="o">...</span><span class="p">:</span>         <span class="s2">&quot;&quot;&quot;任何提供了validate方法的类，都被当作Validator的子类&quot;&quot;&quot;</span>
<a id="__codelineno-109-6" name="__codelineno-109-6"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="s2">&quot;validate&quot;</span> <span class="ow">in</span> <span class="n">B</span><span class="o">.</span><span class="vm">__dict__</span> <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="n">C</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">):</span>
<a id="__codelineno-109-7" name="__codelineno-109-7"></a>    <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-109-8" name="__codelineno-109-8"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">NotImplemented</span>
<a id="__codelineno-109-9" name="__codelineno-109-9"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-109-10" name="__codelineno-109-10"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">raise</span> <span class="bp">NotImplemented</span>
<a id="__codelineno-109-11" name="__codelineno-109-11"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-109-12" name="__codelineno-109-12"></a>
<a id="__codelineno-109-13" name="__codelineno-109-13"></a><span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">StringValidator</span><span class="p">:</span>
<a id="__codelineno-109-14" name="__codelineno-109-14"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-109-15" name="__codelineno-109-15"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">pass</span>
<a id="__codelineno-109-16" name="__codelineno-109-16"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-109-17" name="__codelineno-109-17"></a>
<a id="__codelineno-109-18" name="__codelineno-109-18"></a><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">StringValidator</span><span class="p">(),</span> <span class="n">Validator</span><span class="p">)</span>
<a id="__codelineno-109-19" name="__codelineno-109-19"></a><span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
通过<code>__subclasshook__</code>类方法，我们可以定制抽象类的子类判断逻辑，这种子类只关心结构，不关心实际的继承逻辑，所以常称为“结构化子类”。</p>
<p>抽象类实现子类的注册：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-110-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-110-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-110-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-110-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-110-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-110-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-110-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-110-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-110-10">10</a></span>
<span class="normal"><a href="#__codelineno-110-11">11</a></span>
<span class="normal"><a href="#__codelineno-110-12">12</a></span>
<span class="normal"><a href="#__codelineno-110-13">13</a></span>
<span class="normal"><a href="#__codelineno-110-14">14</a></span>
<span class="normal"><a href="#__codelineno-110-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">pass</span>
<a id="__codelineno-110-3" name="__codelineno-110-3"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-110-4" name="__codelineno-110-4"></a>
<a id="__codelineno-110-5" name="__codelineno-110-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Validator</span><span class="p">)</span>
<a id="__codelineno-110-6" name="__codelineno-110-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="kc">False</span>
<a id="__codelineno-110-7" name="__codelineno-110-7"></a>
<a id="__codelineno-110-8" name="__codelineno-110-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">Validator</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span>
<a id="__codelineno-110-9" name="__codelineno-110-9"></a><span class="n">Out</span><span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">__main__</span><span class="o">.</span><span class="n">Foo</span>
<a id="__codelineno-110-10" name="__codelineno-110-10"></a>
<a id="__codelineno-110-11" name="__codelineno-110-11"></a><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Foo</span><span class="p">(),</span> <span class="n">Validator</span><span class="p">)</span>
<a id="__codelineno-110-12" name="__codelineno-110-12"></a><span class="n">Out</span><span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-110-13" name="__codelineno-110-13"></a>
<a id="__codelineno-110-14" name="__codelineno-110-14"></a><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Validator</span><span class="p">)</span>
<a id="__codelineno-110-15" name="__codelineno-110-15"></a><span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div></p>
<p>有了抽象类以后，我们可以使用<code>isinstance(obj,type)</code>来进行鸭子类型编程风格的类型校验了，只要待匹配类型type是抽象类，类型检查就符合鸭子类型编程风格----<strong>只校验行为，不校验类型</strong></p>
<h4 id="_55">其它功能<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h4>
<p>利用<code>abc</code>模块的<code>@abstractmethod</code>装饰器，可以把某个方法标记成抽象方法，如果在子类没有重写抽象方法，那么它就无法正常实例化
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-111-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-111-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-111-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-111-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-111-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-111-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-111-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-111-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-111-10">10</a></span>
<span class="normal"><a href="#__codelineno-111-11">11</a></span>
<span class="normal"><a href="#__codelineno-111-12">12</a></span>
<span class="normal"><a href="#__codelineno-111-13">13</a></span>
<span class="normal"><a href="#__codelineno-111-14">14</a></span>
<span class="normal"><a href="#__codelineno-111-15">15</a></span>
<span class="normal"><a href="#__codelineno-111-16">16</a></span>
<span class="normal"><a href="#__codelineno-111-17">17</a></span>
<span class="normal"><a href="#__codelineno-111-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Validator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;校验器抽象类&quot;&quot;&quot;</span>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="nd">@abstractmethod</span>
<a id="__codelineno-111-4" name="__codelineno-111-4"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-111-5" name="__codelineno-111-5"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">raise</span> <span class="bp">NotImplemented</span>
<a id="__codelineno-111-6" name="__codelineno-111-6"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-111-7" name="__codelineno-111-7"></a>
<a id="__codelineno-111-8" name="__codelineno-111-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">InvalidValidator</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span>
<a id="__codelineno-111-9" name="__codelineno-111-9"></a>    <span class="o">...</span><span class="p">:</span>     <span class="o">...</span>
<a id="__codelineno-111-10" name="__codelineno-111-10"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-111-11" name="__codelineno-111-11"></a>
<a id="__codelineno-111-12" name="__codelineno-111-12"></a><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">InvalidValidator</span><span class="p">()</span>
<a id="__codelineno-111-13" name="__codelineno-111-13"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-111-14" name="__codelineno-111-14"></a><span class="ne">TypeError</span>                                 <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-111-15" name="__codelineno-111-15"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-111-16" name="__codelineno-111-16"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">InvalidValidator</span><span class="p">()</span>
<a id="__codelineno-111-17" name="__codelineno-111-17"></a>
<a id="__codelineno-111-18" name="__codelineno-111-18"></a><span class="ne">TypeError</span><span class="p">:</span> <span class="n">Can</span><span class="s1">&#39;t instantiate abstract class InvalidValidator with abstract methods validate</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="mixin">Mixin模式<a class="headerlink" href="#mixin" title="Permanent link">&para;</a></h3>
<p><code>Mixin</code>是一种把额外功能”混入“某个类的技术，在python中，我们可以用多重继承来实现<code>Mixin</code>模式
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-112-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-112-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-112-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-112-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-112-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-112-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-112-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-112-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-112-10">10</a></span>
<span class="normal"><a href="#__codelineno-112-11">11</a></span>
<span class="normal"><a href="#__codelineno-112-12">12</a></span>
<span class="normal"><a href="#__codelineno-112-13">13</a></span>
<span class="normal"><a href="#__codelineno-112-14">14</a></span>
<span class="normal"><a href="#__codelineno-112-15">15</a></span>
<span class="normal"><a href="#__codelineno-112-16">16</a></span>
<span class="normal"><a href="#__codelineno-112-17">17</a></span>
<span class="normal"><a href="#__codelineno-112-18">18</a></span>
<span class="normal"><a href="#__codelineno-112-19">19</a></span>
<span class="normal"><a href="#__codelineno-112-20">20</a></span>
<span class="normal"><a href="#__codelineno-112-21">21</a></span>
<span class="normal"><a href="#__codelineno-112-22">22</a></span>
<span class="normal"><a href="#__codelineno-112-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">InfoDumperMixin</span><span class="p">:</span>
<a id="__codelineno-112-2" name="__codelineno-112-2"></a>    <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;Mixin: 输出当前实例信息&quot;&quot;&quot;</span>
<a id="__codelineno-112-3" name="__codelineno-112-3"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">dump_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-112-4" name="__codelineno-112-4"></a>    <span class="o">...</span><span class="p">:</span>         <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
<a id="__codelineno-112-5" name="__codelineno-112-5"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of mumbers: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
<a id="__codelineno-112-6" name="__codelineno-112-6"></a>    <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Details:&quot;</span><span class="p">)</span>
<a id="__codelineno-112-7" name="__codelineno-112-7"></a>    <span class="o">...</span><span class="p">:</span>         <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-112-8" name="__codelineno-112-8"></a>    <span class="o">...</span><span class="p">:</span>             <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; - </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-112-9" name="__codelineno-112-9"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-112-10" name="__codelineno-112-10"></a>
<a id="__codelineno-112-11" name="__codelineno-112-11"></a><span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">InfoDumperMixin</span><span class="p">):</span>
<a id="__codelineno-112-12" name="__codelineno-112-12"></a>    <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
<a id="__codelineno-112-13" name="__codelineno-112-13"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-112-14" name="__codelineno-112-14"></a>    <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
<a id="__codelineno-112-15" name="__codelineno-112-15"></a>    <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-112-16" name="__codelineno-112-16"></a>
<a id="__codelineno-112-17" name="__codelineno-112-17"></a><span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;Jack&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-112-18" name="__codelineno-112-18"></a>
<a id="__codelineno-112-19" name="__codelineno-112-19"></a><span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">dump_info</span><span class="p">()</span>
<a id="__codelineno-112-20" name="__codelineno-112-20"></a><span class="n">Number</span> <span class="n">of</span> <span class="n">mumbers</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-112-21" name="__codelineno-112-21"></a><span class="n">Details</span><span class="p">:</span>
<a id="__codelineno-112-22" name="__codelineno-112-22"></a> <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Jack</span>
<a id="__codelineno-112-23" name="__codelineno-112-23"></a> <span class="o">-</span> <span class="n">age</span><span class="p">:</span> <span class="mi">20</span>
</code></pre></div></td></tr></table></div></p>
<p>使用<code>Mixin</code>类的注意点：
 1. 为了实现某个复杂的功能
 1. 一个类通常会混入多个类
 3. 大多数<code>Mixin</code>不能单独使用</p>
<h3 id="_56">继承<a class="headerlink" href="#_56" title="Permanent link">&para;</a></h3>
<p>继承是一种极为机密得耦合关系，为了避免继承惹来得麻烦，每当你创建新的继承关系时，应该试着问自己几个问题：
- 我要让B类继承A类，但B类和A真的代表同一种东西吗？如果它两不是同类，为什么要继承？
- 即使B和A类时同类，那它们真的需要继承来表明类型关系吗？要知道，Python时鸭子类型的，你不用继承也能实现多态。
- 如果继承只是为了让B类复用A类的几个方法，那么用组合来替代继承会不会更好？</p>
<h3 id="__init_subclass">使用__init_subclass替代元类<a class="headerlink" href="#__init_subclass" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-113-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-113-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-113-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-113-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-113-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-113-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-113-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-113-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-113-10">10</a></span>
<span class="normal"><a href="#__codelineno-113-11">11</a></span>
<span class="normal"><a href="#__codelineno-113-12">12</a></span>
<span class="normal"><a href="#__codelineno-113-13">13</a></span>
<span class="normal"><a href="#__codelineno-113-14">14</a></span>
<span class="normal"><a href="#__codelineno-113-15">15</a></span>
<span class="normal"><a href="#__codelineno-113-16">16</a></span>
<span class="normal"><a href="#__codelineno-113-17">17</a></span>
<span class="normal"><a href="#__codelineno-113-18">18</a></span>
<span class="normal"><a href="#__codelineno-113-19">19</a></span>
<span class="normal"><a href="#__codelineno-113-20">20</a></span>
<span class="normal"><a href="#__codelineno-113-21">21</a></span>
<span class="normal"><a href="#__codelineno-113-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Validator</span><span class="p">:</span>
<a id="__codelineno-113-2" name="__codelineno-113-2"></a>   <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;校验器基类：同一注册所有校验器类，方便后续使用&quot;&quot;&quot;</span>
<a id="__codelineno-113-3" name="__codelineno-113-3"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">_validators</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-113-4" name="__codelineno-113-4"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">__init_subclass__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-113-5" name="__codelineno-113-5"></a>   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> registered, extra kwargs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
<a id="__codelineno-113-6" name="__codelineno-113-6"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">Validator</span><span class="o">.</span><span class="n">_validators</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
<a id="__codelineno-113-7" name="__codelineno-113-7"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-113-8" name="__codelineno-113-8"></a>
<a id="__codelineno-113-9" name="__codelineno-113-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">StringValidator</span><span class="p">(</span><span class="n">Validator</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">):</span>
<a id="__codelineno-113-10" name="__codelineno-113-10"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;string&quot;</span>
<a id="__codelineno-113-11" name="__codelineno-113-11"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-113-12" name="__codelineno-113-12"></a><span class="n">StringValidator</span> <span class="n">registered</span><span class="p">,</span> <span class="n">extra</span> <span class="n">kwargs</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">}</span>
<a id="__codelineno-113-13" name="__codelineno-113-13"></a>
<a id="__codelineno-113-14" name="__codelineno-113-14"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">IntegerValidator</span><span class="p">(</span><span class="n">Validator</span><span class="p">):</span>
<a id="__codelineno-113-15" name="__codelineno-113-15"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;int&quot;</span>
<a id="__codelineno-113-16" name="__codelineno-113-16"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-113-17" name="__codelineno-113-17"></a><span class="n">IntegerValidator</span> <span class="n">registered</span><span class="p">,</span> <span class="n">extra</span> <span class="n">kwargs</span><span class="p">:</span> <span class="p">{}</span>
<a id="__codelineno-113-18" name="__codelineno-113-18"></a>
<a id="__codelineno-113-19" name="__codelineno-113-19"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">Validator</span><span class="o">.</span><span class="n">_validators</span>
<a id="__codelineno-113-20" name="__codelineno-113-20"></a><span class="n">Out</span><span class="p">[</span><span class="mi">4</span><span class="p">]:</span>
<a id="__codelineno-113-21" name="__codelineno-113-21"></a><span class="p">{</span><span class="s1">&#39;StringValidator&#39;</span><span class="p">:</span> <span class="n">__main__</span><span class="o">.</span><span class="n">StringValidator</span><span class="p">,</span>
<a id="__codelineno-113-22" name="__codelineno-113-22"></a> <span class="s1">&#39;IntegerValidator&#39;</span><span class="p">:</span> <span class="n">__main__</span><span class="o">.</span><span class="n">IntegerValidator</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_57">在分支中寻找多态的应用时机<a class="headerlink" href="#_57" title="Permanent link">&para;</a></h3>
<p>未使用多态的代码：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-114-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-114-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-114-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-114-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-114-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-114-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-114-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-114-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-114-10">10</a></span>
<span class="normal"><a href="#__codelineno-114-11">11</a></span>
<span class="normal"><a href="#__codelineno-114-12">12</a></span>
<span class="normal"><a href="#__codelineno-114-13">13</a></span>
<span class="normal"><a href="#__codelineno-114-14">14</a></span>
<span class="normal"><a href="#__codelineno-114-15">15</a></span>
<span class="normal"><a href="#__codelineno-114-16">16</a></span>
<span class="normal"><a href="#__codelineno-114-17">17</a></span>
<span class="normal"><a href="#__codelineno-114-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="k">class</span> <span class="nc">FancyLogger</span><span class="p">:</span>
<a id="__codelineno-114-2" name="__codelineno-114-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;日志类：支持向文件、Redis、ES等服务输出日志&quot;&quot;&quot;</span>
<a id="__codelineno-114-3" name="__codelineno-114-3"></a>    <span class="n">_redis_max_length</span> <span class="o">=</span> <span class="mi">1024</span>
<a id="__codelineno-114-4" name="__codelineno-114-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">OutputType</span><span class="o">.</span><span class="n">FILE</span><span class="p">):</span>
<a id="__codelineno-114-5" name="__codelineno-114-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">=</span> <span class="n">output_type</span>
<a id="__codelineno-114-6" name="__codelineno-114-6"></a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<a id="__codelineno-114-7" name="__codelineno-114-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;打印日志&quot;&quot;&quot;</span>
<a id="__codelineno-114-8" name="__codelineno-114-8"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">==</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">FILE</span><span class="p">:</span>
<a id="__codelineno-114-9" name="__codelineno-114-9"></a>            <span class="o">...</span>
<a id="__codelineno-114-10" name="__codelineno-114-10"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">==</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">REDIS</span><span class="p">:</span>
<a id="__codelineno-114-11" name="__codelineno-114-11"></a>            <span class="o">...</span>
<a id="__codelineno-114-12" name="__codelineno-114-12"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">==</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">ES</span><span class="p">:</span>
<a id="__codelineno-114-13" name="__codelineno-114-13"></a>            <span class="o">...</span>
<a id="__codelineno-114-14" name="__codelineno-114-14"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-114-15" name="__codelineno-114-15"></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;output type invalid&#39;</span><span class="p">)</span>
<a id="__codelineno-114-16" name="__codelineno-114-16"></a>    <span class="k">def</span> <span class="nf">pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<a id="__codelineno-114-17" name="__codelineno-114-17"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_type</span> <span class="o">==</span> <span class="n">OutputType</span><span class="o">.</span><span class="n">REDIS</span><span class="p">:</span>
<a id="__codelineno-114-18" name="__codelineno-114-18"></a>            <span class="k">return</span> <span class="n">message</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">_redis_max_length</span><span class="p">]</span>
</code></pre></div></td></tr></table></div></p>
<p>对于三种日志类型，我们可以创建下面的Writer类：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-115-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-115-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-115-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-115-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-115-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-115-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-115-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-115-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-115-10">10</a></span>
<span class="normal"><a href="#__codelineno-115-11">11</a></span>
<span class="normal"><a href="#__codelineno-115-12">12</a></span>
<span class="normal"><a href="#__codelineno-115-13">13</a></span>
<span class="normal"><a href="#__codelineno-115-14">14</a></span>
<span class="normal"><a href="#__codelineno-115-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="k">class</span> <span class="nc">FileWriter</span><span class="p">:</span>
<a id="__codelineno-115-2" name="__codelineno-115-2"></a>    <span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<a id="__codelineno-115-3" name="__codelineno-115-3"></a>        <span class="o">...</span>
<a id="__codelineno-115-4" name="__codelineno-115-4"></a>
<a id="__codelineno-115-5" name="__codelineno-115-5"></a><span class="k">class</span> <span class="nc">RedisWriter</span><span class="p">:</span>
<a id="__codelineno-115-6" name="__codelineno-115-6"></a>    <span class="n">max_length</span> <span class="o">=</span> <span class="mi">1024</span>
<a id="__codelineno-115-7" name="__codelineno-115-7"></a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<a id="__codelineno-115-8" name="__codelineno-115-8"></a>        <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<a id="__codelineno-115-9" name="__codelineno-115-9"></a>    <span class="k">def</span> <span class="nf">_pre_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<a id="__codelineno-115-10" name="__codelineno-115-10"></a>        <span class="c1"># Redis 对日志最大长度有限制，需要进行裁剪</span>
<a id="__codelineno-115-11" name="__codelineno-115-11"></a>        <span class="k">return</span> <span class="n">message</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_length</span><span class="p">]</span>
<a id="__codelineno-115-12" name="__codelineno-115-12"></a>
<a id="__codelineno-115-13" name="__codelineno-115-13"></a><span class="k">class</span> <span class="nc">EsWriter</span><span class="p">:</span>
<a id="__codelineno-115-14" name="__codelineno-115-14"></a>    <span class="k">def</span> <span class="nf">writer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message</span><span class="p">):</span>
<a id="__codelineno-115-15" name="__codelineno-115-15"></a>        <span class="o">...</span>
</code></pre></div></td></tr></table></div></p>
<p>基于这些不同的<code>Writer</code>类， <code>FancyLogger</code>可以简化成下面这样：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1">1</a></span>
<span class="normal"><a href="#__codelineno-116-2">2</a></span>
<span class="normal"><a href="#__codelineno-116-3">3</a></span>
<span class="normal"><a href="#__codelineno-116-4">4</a></span>
<span class="normal"><a href="#__codelineno-116-5">5</a></span>
<span class="normal"><a href="#__codelineno-116-6">6</a></span>
<span class="normal"><a href="#__codelineno-116-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="k">class</span> <span class="nc">FancyLogger</span><span class="p">:</span>
<a id="__codelineno-116-2" name="__codelineno-116-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;日志类：支持向文件、Redis、Es等服务输出日志&quot;&quot;&quot;</span>
<a id="__codelineno-116-3" name="__codelineno-116-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_writer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-116-4" name="__codelineno-116-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span> <span class="o">=</span> <span class="n">output_writer</span> <span class="ow">or</span> <span class="n">FileWriter</span>
<a id="__codelineno-116-5" name="__codelineno-116-5"></a>        <span class="o">...</span>
<a id="__codelineno-116-6" name="__codelineno-116-6"></a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<a id="__codelineno-116-7" name="__codelineno-116-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_writer</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<p>找到使用多态的时机：
- 有许多if/else判断，并且这些判断语句的条件都非常类似
- 有许多针对类型isinstance()判断逻辑</p>
<h3 id="_58">有序组织你的类方法<a class="headerlink" href="#_58" title="Permanent link">&para;</a></h3>
<ul>
<li><code>__init__</code>实例化方法应该总是放在类的最前面，<code>__new__</code>方方法同理</li>
<li>公有方法放到类的前面，私有方法大部分自身实现的细节，放到靠后的位置</li>
<li>至于类方法、静态方法和属性对象，直接参考公有/私有的思路即可</li>
<li>以__开头的魔法方法比较特殊，我们通常按照方法的中药程度来决定他们的位置，比如迭代器的<code>__iter__</code>方法应该放到非常靠前的位置，因为它是构成类接口的重要方法</li>
</ul>
<h3 id="_59">函数搭配，干活不累<a class="headerlink" href="#_59" title="Permanent link">&para;</a></h3>
<h4 id="api">用函数降低API使用成本<a class="headerlink" href="#api" title="Permanent link">&para;</a></h4>
<p>requests.request()函数来说，它的内部实现：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1">1</a></span>
<span class="normal"><a href="#__codelineno-117-2">2</a></span>
<span class="normal"><a href="#__codelineno-117-3">3</a></span>
<span class="normal"><a href="#__codelineno-117-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="kn">from</span> <span class="nn">reqeust</span> <span class="kn">import</span> <span class="n">sessions</span>
<a id="__codelineno-117-2" name="__codelineno-117-2"></a><span class="k">def</span> <span class="nf">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-117-3" name="__codelineno-117-3"></a>    <span class="k">with</span> <span class="n">sessions</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<a id="__codelineno-117-4" name="__codelineno-117-4"></a>        <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
在使用者角度来看，显然调用函数比实例化<code>Session()</code>对象要讨喜得多</p>
<p>像上面这种函数搭配面向对象的代码非常多见，有点像设计模式中<code>外观模式</code>，在该模式中，函数作为一种简化API的工具，封装了复杂的面向对象共嗯那个，大大降低使用成本。</p>
<h4 id="_60">实现预绑定方法模式<a class="headerlink" href="#_60" title="Permanent link">&para;</a></h4>
<p>预绑定方法模式是一种将对象方法绑定为函数的模式。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-118-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-118-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-118-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-118-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-118-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-118-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-118-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-118-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-118-10">10</a></span>
<span class="normal"><a href="#__codelineno-118-11">11</a></span>
<span class="normal"><a href="#__codelineno-118-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="k">class</span> <span class="nc">AppConfig</span><span class="p">:</span>
<a id="__codelineno-118-2" name="__codelineno-118-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;程序配置类，使用预绑定模式&quot;&quot;&quot;</span>
<a id="__codelineno-118-3" name="__codelineno-118-3"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-118-4" name="__codelineno-118-4"></a>        <span class="o">...</span>
<a id="__codelineno-118-5" name="__codelineno-118-5"></a>    <span class="k">def</span> <span class="nf">get_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-118-6" name="__codelineno-118-6"></a>        <span class="o">...</span>
<a id="__codelineno-118-7" name="__codelineno-118-7"></a>    <span class="k">def</span> <span class="nf">realod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-118-8" name="__codelineno-118-8"></a>        <span class="o">...</span>
<a id="__codelineno-118-9" name="__codelineno-118-9"></a>
<a id="__codelineno-118-10" name="__codelineno-118-10"></a><span class="n">_config</span> <span class="o">=</span> <span class="n">AppConfig</span><span class="p">()</span>
<a id="__codelineno-118-11" name="__codelineno-118-11"></a><span class="n">get_database_config</span> <span class="o">=</span> <span class="n">_config</span><span class="o">.</span><span class="n">get_database</span>
<a id="__codelineno-118-12" name="__codelineno-118-12"></a><span class="n">reload_config</span> <span class="o">=</span> <span class="n">_config</span><span class="o">.</span><span class="n">reload</span>
</code></pre></div></td></tr></table></div></p>
<p>其他模块就可以调用普通函数一样操作应用配置对象：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1">1</a></span>
<span class="normal"><a href="#__codelineno-119-2">2</a></span>
<span class="normal"><a href="#__codelineno-119-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="kn">from</span> <span class="nn">project.config</span> <span class="kn">import</span> <span class="n">get_database_conf</span>
<a id="__codelineno-119-2" name="__codelineno-119-2"></a><span class="n">db_conf</span> <span class="o">=</span> <span class="n">get_database_conf</span><span class="p">()</span>
<a id="__codelineno-119-3" name="__codelineno-119-3"></a><span class="n">reload_config</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></p>
<h2 id="_61">面向对象设计原则(上)<a class="headerlink" href="#_61" title="Permanent link">&para;</a></h2>
<p>在面向对象对象领域，除了23中经典设计模式外，还有许多经典的设计原则。同具体的设计模式相比，原则通常更抽象、实用性更广，更适合融入Python编程中。而在所有设计原则中，SOLID最为有名。
SOLID单词里的5个字母，分别代表5条设计原则。
- S：single responsibility principle（单一职责原则，SRP）
- O：open-closed principle（开放–关闭原则，OCP）。
- L：Liskov substitution principle（里式替换原则，LSP）。
- I：interface segregation principle（接口隔离原则，ISP）。
- D：dependency inversion principle（依赖倒置原则，DIP）。</p>
<h3 id="_62">类型注解基础<a class="headerlink" href="#_62" title="Permanent link">&para;</a></h3>
<p>加上类型注解的代码：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-120-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-120-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-120-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-120-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-120-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-120-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-120-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-120-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-120-10">10</a></span>
<span class="normal"><a href="#__codelineno-120-11">11</a></span>
<span class="normal"><a href="#__codelineno-120-12">12</a></span>
<span class="normal"><a href="#__codelineno-120-13">13</a></span>
<span class="normal"><a href="#__codelineno-120-14">14</a></span>
<span class="normal"><a href="#__codelineno-120-15">15</a></span>
<span class="normal"><a href="#__codelineno-120-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<a id="__codelineno-120-2" name="__codelineno-120-2"></a>
<a id="__codelineno-120-3" name="__codelineno-120-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="k">class</span> <span class="nc">Duck</span><span class="p">:</span>
<a id="__codelineno-120-4" name="__codelineno-120-4"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-120-5" name="__codelineno-120-5"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
<a id="__codelineno-120-6" name="__codelineno-120-6"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">quack</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-120-7" name="__codelineno-120-7"></a>   <span class="o">...</span><span class="p">:</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Hi, I&#39;m a </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="si">}</span><span class="s2"> duck!&quot;</span><span class="p">)</span>
<a id="__codelineno-120-8" name="__codelineno-120-8"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-120-9" name="__codelineno-120-9"></a>
<a id="__codelineno-120-10" name="__codelineno-120-10"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">create_random_ducks</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Duck</span><span class="p">]:</span>
<a id="__codelineno-120-11" name="__codelineno-120-11"></a>   <span class="o">...</span><span class="p">:</span>     <span class="n">ducks</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Duck</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-120-12" name="__codelineno-120-12"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">number</span><span class="p">:</span>
<a id="__codelineno-120-13" name="__codelineno-120-13"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">color</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">])</span>
<a id="__codelineno-120-14" name="__codelineno-120-14"></a>   <span class="o">...</span><span class="p">:</span>         <span class="n">ducks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Duck</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">))</span>
<a id="__codelineno-120-15" name="__codelineno-120-15"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">ducks</span>
<a id="__codelineno-120-16" name="__codelineno-120-16"></a>   <span class="o">...</span><span class="p">:</span>
</code></pre></div></td></tr></table></div></p>
<p>typing时类型注解用到的主要模块，除了List以外，该模块内还有许多与类型有关的特殊对象，举例如下：
- Dict: 字典类型， 例如<code>Dict[Str, int]</code>代表键为字符串，值为整形的字典
- Callable：可调用对象，例如<code>Callable[[str,str],List[str]]</code>表示接收两个字符作为参数，返回字符串列表的可调用对象
- TextIO：使用文本协议的类文件类型，相应的，还有二进制类型BinaryIO
- Any：代表任何类型</p>
<h3 id="ocp-">OCP：开放-关闭原则<a class="headerlink" href="#ocp-" title="Permanent link">&para;</a></h3>
<p><code>SOLID</code>原则的第二条<code>OCP</code>（开放-关闭原则）。该原则认为：<strong>类应该对扩展开放，对修改关闭</strong>，换句话说，你可以在不修改某个类的前提下，扩展它的行为。</p>
<h2 id="_63">数据模型与描述符<a class="headerlink" href="#_63" title="Permanent link">&para;</a></h2>
<h3 id="_64">字符串魔法方法<a class="headerlink" href="#_64" title="Permanent link">&para;</a></h3>
<h4 id="repr____str"><strong>repr__和__str</strong><a class="headerlink" href="#repr____str" title="Permanent link">&para;</a></h4>
<ul>
<li><code>__repr__</code>： 非正式场景使用，使用print打印出来，或者用<code>str()</code>转换为字符串，对用户友好。</li>
<li><code>__str__</code>：正式场景，在调用对象时，需要快速知道对象里面的详细内容。</li>
<li>如果只定义<code>__repr__</code>，那么<code>__repr__</code>的结果会用于所有需要字符串的场景。</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-121-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-121-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-121-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-121-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-121-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-121-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-121-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-121-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-121-10">10</a></span>
<span class="normal"><a href="#__codelineno-121-11">11</a></span>
<span class="normal"><a href="#__codelineno-121-12">12</a></span>
<span class="normal"><a href="#__codelineno-121-13">13</a></span>
<span class="normal"><a href="#__codelineno-121-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="n">favorite_color</span><span class="p">):</span>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-121-4" name="__codelineno-121-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
<a id="__codelineno-121-5" name="__codelineno-121-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">favorite_color</span> <span class="o">=</span> <span class="n">favorite_color</span>
<a id="__codelineno-121-6" name="__codelineno-121-6"></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-121-7" name="__codelineno-121-7"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-121-8" name="__codelineno-121-8"></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-121-9" name="__codelineno-121-9"></a>        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{cls_name}</span><span class="s1">(name=</span><span class="si">{name!r}</span><span class="s1">, age=</span><span class="si">{age!r}</span><span class="s1">, favorite_color=</span><span class="si">{color!r}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
<a id="__codelineno-121-10" name="__codelineno-121-10"></a>            <span class="n">cls_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
<a id="__codelineno-121-11" name="__codelineno-121-11"></a>            <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-121-12" name="__codelineno-121-12"></a>            <span class="n">age</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">,</span>
<a id="__codelineno-121-13" name="__codelineno-121-13"></a>            <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">favorite_color</span><span class="p">,</span>
<a id="__codelineno-121-14" name="__codelineno-121-14"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1">1</a></span>
<span class="normal"><a href="#__codelineno-122-2">2</a></span>
<span class="normal"><a href="#__codelineno-122-3">3</a></span>
<span class="normal"><a href="#__codelineno-122-4">4</a></span>
<span class="normal"><a href="#__codelineno-122-5">5</a></span>
<span class="normal"><a href="#__codelineno-122-6">6</a></span>
<span class="normal"><a href="#__codelineno-122-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;yanghe&quot;</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<a id="__codelineno-122-2" name="__codelineno-122-2"></a>
<a id="__codelineno-122-3" name="__codelineno-122-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">p</span>
<a id="__codelineno-122-4" name="__codelineno-122-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;yanghe&#39;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">favorite_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<a id="__codelineno-122-5" name="__codelineno-122-5"></a>
<a id="__codelineno-122-6" name="__codelineno-122-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-122-7" name="__codelineno-122-7"></a><span class="n">yanghe</span>
</code></pre></div></td></tr></table></div>
<p><code>!r</code>可以给格式化的字符串自动加上引号，但注意的是指定格式化字符串必须是一个变量，而不能直接给一个字符串或者其它类型数据
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1">1</a></span>
<span class="normal"><a href="#__codelineno-123-2">2</a></span>
<span class="normal"><a href="#__codelineno-123-3">3</a></span>
<span class="normal"><a href="#__codelineno-123-4">4</a></span>
<span class="normal"><a href="#__codelineno-123-5">5</a></span>
<span class="normal"><a href="#__codelineno-123-6">6</a></span>
<span class="normal"><a href="#__codelineno-123-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">age</span> <span class="o">=</span> <span class="s2">&quot;18&quot;</span>
<a id="__codelineno-123-2" name="__codelineno-123-2"></a>
<a id="__codelineno-123-3" name="__codelineno-123-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s2">&quot;age is </span><span class="si">{age!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">)</span>
<a id="__codelineno-123-4" name="__codelineno-123-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="s2">&quot;age is &#39;18&#39;&quot;</span>
<a id="__codelineno-123-5" name="__codelineno-123-5"></a>
<a id="__codelineno-123-6" name="__codelineno-123-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s2">&quot;age is </span><span class="si">{age!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">age</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<a id="__codelineno-123-7" name="__codelineno-123-7"></a><span class="n">Out</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="s1">&#39;age is 18&#39;</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="format"><strong>format</strong><a class="headerlink" href="#format" title="Permanent link">&para;</a></h4>
<p>通过定义<code>__format__</code>魔法方法，可以为一种对象定义多种字符串的表现形式。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-124-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-124-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-124-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-124-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-124-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-124-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-124-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-124-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-124-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-124-10">10</a></span>
<span class="normal"><a href="#__codelineno-124-11">11</a></span>
<span class="normal"><a href="#__codelineno-124-12">12</a></span>
<span class="normal"><a href="#__codelineno-124-13">13</a></span>
<span class="normal"><a href="#__codelineno-124-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1"></a><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
<a id="__codelineno-124-2" name="__codelineno-124-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">favorite_color</span><span class="p">):</span>
<a id="__codelineno-124-3" name="__codelineno-124-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-124-4" name="__codelineno-124-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
<a id="__codelineno-124-5" name="__codelineno-124-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">favorite_color</span> <span class="o">=</span> <span class="n">favorite_color</span>
<a id="__codelineno-124-6" name="__codelineno-124-6"></a>    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">):</span>
<a id="__codelineno-124-7" name="__codelineno-124-7"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;定义对象在字符串格式化的行为</span>
<a id="__codelineno-124-8" name="__codelineno-124-8"></a><span class="sd">        :param format_spec: 需要的格式，默认为&#39;&#39;</span>
<a id="__codelineno-124-9" name="__codelineno-124-9"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-124-10" name="__codelineno-124-10"></a>        <span class="k">if</span> <span class="n">format_spec</span> <span class="o">==</span> <span class="s2">&quot;verbose&quot;</span><span class="p">:</span>
<a id="__codelineno-124-11" name="__codelineno-124-11"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">)[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">favorite_color</span><span class="si">}</span><span class="s2">]&quot;</span>
<a id="__codelineno-124-12" name="__codelineno-124-12"></a>        <span class="k">elif</span> <span class="n">format_spec</span> <span class="o">==</span> <span class="s2">&quot;simple&quot;</span><span class="p">:</span>
<a id="__codelineno-124-13" name="__codelineno-124-13"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-124-14" name="__codelineno-124-14"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-125-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-125-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-125-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-125-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-125-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-125-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-125-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-125-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-125-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-125-10">10</a></span>
<span class="normal"><a href="#__codelineno-125-11">11</a></span>
<span class="normal"><a href="#__codelineno-125-12">12</a></span>
<span class="normal"><a href="#__codelineno-125-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&quot;yanghe&quot;</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
<a id="__codelineno-125-2" name="__codelineno-125-2"></a>
<a id="__codelineno-125-3" name="__codelineno-125-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="s2">&quot;{p:verbose}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a id="__codelineno-125-4" name="__codelineno-125-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="s1">&#39;yanghe(18)[black]&#39;</span>
<a id="__codelineno-125-5" name="__codelineno-125-5"></a>
<a id="__codelineno-125-6" name="__codelineno-125-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">verbose</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-125-7" name="__codelineno-125-7"></a><span class="n">Out</span><span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="s1">&#39;yanghe(18)[black]&#39;</span>
<a id="__codelineno-125-8" name="__codelineno-125-8"></a>
<a id="__codelineno-125-9" name="__codelineno-125-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">:</span><span class="s2">simple</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-125-10" name="__codelineno-125-10"></a><span class="n">Out</span><span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="s1">&#39;yanghe(18)&#39;</span>
<a id="__codelineno-125-11" name="__codelineno-125-11"></a>
<a id="__codelineno-125-12" name="__codelineno-125-12"></a><span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-125-13" name="__codelineno-125-13"></a><span class="n">Out</span><span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="s1">&#39;yanghe&#39;</span>
</code></pre></div></td></tr></table></div>
<h3 id="_65">比较重载运算符<a class="headerlink" href="#_65" title="Permanent link">&para;</a></h3>
<p>比较运算符是专门用来对比两个对象的运算符，比较运算符相关的魔法方法有六个：
- <code>__lt__</code> ：obj &lt; other
- <code>__le__</code>：obj &lt;= other
- <code>__eq__</code>：obj == other
- <code>__ne__</code>：obj != other
- <code>__gt__</code>：obj &gt; other
- <code>__ge__</code>：obj =&gt; other</p>
<p>例子：以正方形来举例
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-126-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-126-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-126-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-126-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-126-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-126-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-126-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-126-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-126-10">10</a></span>
<span class="normal"><a href="#__codelineno-126-11">11</a></span>
<span class="normal"><a href="#__codelineno-126-12">12</a></span>
<span class="normal"><a href="#__codelineno-126-13">13</a></span>
<span class="normal"><a href="#__codelineno-126-14">14</a></span>
<span class="normal"><a href="#__codelineno-126-15">15</a></span>
<span class="normal"><a href="#__codelineno-126-16">16</a></span>
<span class="normal"><a href="#__codelineno-126-17">17</a></span>
<span class="normal"><a href="#__codelineno-126-18">18</a></span>
<span class="normal"><a href="#__codelineno-126-19">19</a></span>
<span class="normal"><a href="#__codelineno-126-20">20</a></span>
<span class="normal"><a href="#__codelineno-126-21">21</a></span>
<span class="normal"><a href="#__codelineno-126-22">22</a></span>
<span class="normal"><a href="#__codelineno-126-23">23</a></span>
<span class="normal"><a href="#__codelineno-126-24">24</a></span>
<span class="normal"><a href="#__codelineno-126-25">25</a></span>
<span class="normal"><a href="#__codelineno-126-26">26</a></span>
<span class="normal"><a href="#__codelineno-126-27">27</a></span>
<span class="normal"><a href="#__codelineno-126-28">28</a></span>
<span class="normal"><a href="#__codelineno-126-29">29</a></span>
<span class="normal"><a href="#__codelineno-126-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="k">class</span> <span class="nc">Square</span><span class="p">:</span>
<a id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;正方形</span>
<a id="__codelineno-126-3" name="__codelineno-126-3"></a><span class="sd">    :param length: 边长</span>
<a id="__codelineno-126-4" name="__codelineno-126-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-126-5" name="__codelineno-126-5"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<a id="__codelineno-126-6" name="__codelineno-126-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
<a id="__codelineno-126-7" name="__codelineno-126-7"></a>    <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-126-8" name="__codelineno-126-8"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">**</span> <span class="mi">2</span>
<a id="__codelineno-126-9" name="__codelineno-126-9"></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-126-10" name="__codelineno-126-10"></a>        <span class="c1"># 在判断两个对象是否相等，先校验other是否为当前类型</span>
<a id="__codelineno-126-11" name="__codelineno-126-11"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
<a id="__codelineno-126-12" name="__codelineno-126-12"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span>
<a id="__codelineno-126-13" name="__codelineno-126-13"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-126-14" name="__codelineno-126-14"></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-126-15" name="__codelineno-126-15"></a>        <span class="c1"># 不等于运算的结果一般会直接对于&quot;等于&quot;取反</span>
<a id="__codelineno-126-16" name="__codelineno-126-16"></a>        <span class="c1"># return not self.__eq__(self, other)</span>
<a id="__codelineno-126-17" name="__codelineno-126-17"></a>        <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">other</span><span class="p">)</span>
<a id="__codelineno-126-18" name="__codelineno-126-18"></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-126-19" name="__codelineno-126-19"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
<a id="__codelineno-126-20" name="__codelineno-126-20"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span>
<a id="__codelineno-126-21" name="__codelineno-126-21"></a>        <span class="c1"># 如果对象不支持某种运算，可以直接返回NotImplemented值</span>
<a id="__codelineno-126-22" name="__codelineno-126-22"></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
<a id="__codelineno-126-23" name="__codelineno-126-23"></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-126-24" name="__codelineno-126-24"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__lt__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<a id="__codelineno-126-25" name="__codelineno-126-25"></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-126-26" name="__codelineno-126-26"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
<a id="__codelineno-126-27" name="__codelineno-126-27"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span>
<a id="__codelineno-126-28" name="__codelineno-126-28"></a>        <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-126-29" name="__codelineno-126-29"></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-126-30" name="__codelineno-126-30"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__gt__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="total_ordering">使用@total_ordering简化描述符的编写<a class="headerlink" href="#total_ordering" title="Permanent link">&para;</a></h4>
<p>如果使用<code>@total_ordering</code>装饰一个类，那么在重载类的比较运算符时，只需要实现<code>__eq__</code>方法，然后再<code>__lt__</code>、<code>__le__</code>、<code>__gt__</code>、<code>__ge__</code>四个方法里随意挑一个实现即可，<code>@total_ordering</code>会帮你自动补全剩下所有方法
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-127-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-127-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-127-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-127-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-127-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-127-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-127-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-127-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-127-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-127-10">10</a></span>
<span class="normal"><a href="#__codelineno-127-11">11</a></span>
<span class="normal"><a href="#__codelineno-127-12">12</a></span>
<span class="normal"><a href="#__codelineno-127-13">13</a></span>
<span class="normal"><a href="#__codelineno-127-14">14</a></span>
<span class="normal"><a href="#__codelineno-127-15">15</a></span>
<span class="normal"><a href="#__codelineno-127-16">16</a></span>
<span class="normal"><a href="#__codelineno-127-17">17</a></span>
<span class="normal"><a href="#__codelineno-127-18">18</a></span>
<span class="normal"><a href="#__codelineno-127-19">19</a></span>
<span class="normal"><a href="#__codelineno-127-20">20</a></span>
<span class="normal"><a href="#__codelineno-127-21">21</a></span>
<span class="normal"><a href="#__codelineno-127-22">22</a></span>
<span class="normal"><a href="#__codelineno-127-23">23</a></span>
<span class="normal"><a href="#__codelineno-127-24">24</a></span>
<span class="normal"><a href="#__codelineno-127-25">25</a></span>
<span class="normal"><a href="#__codelineno-127-26">26</a></span>
<span class="normal"><a href="#__codelineno-127-27">27</a></span>
<span class="normal"><a href="#__codelineno-127-28">28</a></span>
<span class="normal"><a href="#__codelineno-127-29">29</a></span>
<span class="normal"><a href="#__codelineno-127-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1"></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">total_ordering</span>
<a id="__codelineno-127-2" name="__codelineno-127-2"></a><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="nd">@total_ordering</span>
<a id="__codelineno-127-3" name="__codelineno-127-3"></a>   <span class="o">...</span><span class="p">:</span> <span class="k">class</span> <span class="nc">Square</span><span class="p">:</span>
<a id="__codelineno-127-4" name="__codelineno-127-4"></a>   <span class="o">...</span><span class="p">:</span>     <span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-127-5" name="__codelineno-127-5"></a><span class="s2">   ...:     正方形</span>
<a id="__codelineno-127-6" name="__codelineno-127-6"></a><span class="s2">   ...:     :param length: 边长</span>
<a id="__codelineno-127-7" name="__codelineno-127-7"></a><span class="s2">   ...:     &quot;&quot;&quot;</span>
<a id="__codelineno-127-8" name="__codelineno-127-8"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
<a id="__codelineno-127-9" name="__codelineno-127-9"></a>   <span class="o">...</span><span class="p">:</span>         <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="n">length</span>
<a id="__codelineno-127-10" name="__codelineno-127-10"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-127-11" name="__codelineno-127-11"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">**</span> <span class="mi">2</span>
<a id="__codelineno-127-12" name="__codelineno-127-12"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-127-13" name="__codelineno-127-13"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
<a id="__codelineno-127-14" name="__codelineno-127-14"></a>   <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span>
<a id="__codelineno-127-15" name="__codelineno-127-15"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-127-16" name="__codelineno-127-16"></a>   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<a id="__codelineno-127-17" name="__codelineno-127-17"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
<a id="__codelineno-127-18" name="__codelineno-127-18"></a>   <span class="o">...</span><span class="p">:</span>             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">length</span>
<a id="__codelineno-127-19" name="__codelineno-127-19"></a>   <span class="o">...</span><span class="p">:</span>         <span class="k">return</span> <span class="bp">NotImplemented</span>
<a id="__codelineno-127-20" name="__codelineno-127-20"></a>   <span class="o">...</span><span class="p">:</span>
<a id="__codelineno-127-21" name="__codelineno-127-21"></a>
<a id="__codelineno-127-22" name="__codelineno-127-22"></a><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Square</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-127-23" name="__codelineno-127-23"></a>
<a id="__codelineno-127-24" name="__codelineno-127-24"></a><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">Square</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-127-25" name="__codelineno-127-25"></a>
<a id="__codelineno-127-26" name="__codelineno-127-26"></a><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">s</span> <span class="o">==</span> <span class="n">s1</span>
<a id="__codelineno-127-27" name="__codelineno-127-27"></a><span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="kc">True</span>
<a id="__codelineno-127-28" name="__codelineno-127-28"></a>
<a id="__codelineno-127-29" name="__codelineno-127-29"></a><span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">s1</span> <span class="o">&gt;=</span> <span class="n">s</span>
<a id="__codelineno-127-30" name="__codelineno-127-30"></a><span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="_66">描述符<a class="headerlink" href="#_66" title="Permanent link">&para;</a></h3>
<p>描述符(descriptor)是Python对象模型里的一种特殊协议，它主要和4个魔法方法有关：<code>__get__</code>、<code>__set__</code>、<code>__delete__</code>和<code>__set_name__</code>
从定义上来说，除了最后一个方法<code>__set__name__</code>以外，任何一个实现了<code>__get__</code>、<code>__set__</code>或<code>__delete__</code>的类，都可以成为描述符类，它的对象叫做描述符对象。
<strong>描述符之所以叫这个名字，因为它“描述”了Python获取与设置一个类（实例）成员的整个过程</strong></p>
<h4 id="__get__">__get__方法<a class="headerlink" href="#__get__" title="Permanent link">&para;</a></h4>
<p>写一个打印帮助信息的描述类：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-128-1">1</a></span>
<span class="normal"><a href="#__codelineno-128-2">2</a></span>
<span class="normal"><a href="#__codelineno-128-3">3</a></span>
<span class="normal"><a href="#__codelineno-128-4">4</a></span>
<span class="normal"><a href="#__codelineno-128-5">5</a></span>
<span class="normal"><a href="#__codelineno-128-6">6</a></span>
<span class="normal"><a href="#__codelineno-128-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="k">class</span> <span class="nc">InfoDescriptor</span><span class="p">:</span>
<a id="__codelineno-128-2" name="__codelineno-128-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;打印帮助信息的描述符&quot;&quot;&quot;</span>
<a id="__codelineno-128-3" name="__codelineno-128-3"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-128-4" name="__codelineno-128-4"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calling __get__, instance: </span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">, owner: </span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-128-5" name="__codelineno-128-5"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
<a id="__codelineno-128-6" name="__codelineno-128-6"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calling without instance&quot;</span><span class="p">)</span>
<a id="__codelineno-128-7" name="__codelineno-128-7"></a>        <span class="k">return</span> <span class="s2">&quot;infomative descriptor&quot;</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-129-1">1</a></span>
<span class="normal"><a href="#__codelineno-129-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1"></a><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
<a id="__codelineno-129-2" name="__codelineno-129-2"></a>    <span class="n">bar</span> <span class="o">=</span> <span class="n">InfoDescriptor</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>当通过绑定的类来调用，<code>instance</code>为None，<code>owner</code>为描述符对象所绑定的类</li>
<li>当通过绑定类的实例对象来调用，<code>instance</code>为绑定类的实例，<code>owner</code>为描述符对象所绑定的类</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1">1</a></span>
<span class="normal"><a href="#__codelineno-130-2">2</a></span>
<span class="normal"><a href="#__codelineno-130-3">3</a></span>
<span class="normal"><a href="#__codelineno-130-4">4</a></span>
<span class="normal"><a href="#__codelineno-130-5">5</a></span>
<span class="normal"><a href="#__codelineno-130-6">6</a></span>
<span class="normal"><a href="#__codelineno-130-7">7</a></span>
<span class="normal"><a href="#__codelineno-130-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">Foo</span><span class="o">.</span><span class="n">bar</span>
<a id="__codelineno-130-2" name="__codelineno-130-2"></a><span class="n">Calling</span> <span class="fm">__get__</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">Foo</span><span class="s1">&#39;&gt;</span>
<a id="__codelineno-130-3" name="__codelineno-130-3"></a><span class="n">Calling</span> <span class="n">without</span> <span class="n">instance</span><span class="o">...</span>
<a id="__codelineno-130-4" name="__codelineno-130-4"></a><span class="n">Out</span><span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="s1">&#39;informative descriptor&#39;</span>
<a id="__codelineno-130-5" name="__codelineno-130-5"></a>
<a id="__codelineno-130-6" name="__codelineno-130-6"></a><span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">Foo</span><span class="p">()</span><span class="o">.</span><span class="n">bar</span>
<a id="__codelineno-130-7" name="__codelineno-130-7"></a><span class="n">Calling</span> <span class="fm">__get__</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">Foo</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x000001DB2F9F0520</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">__main__</span><span class="o">.</span><span class="n">Foo</span><span class="s1">&#39;&gt;</span>
<a id="__codelineno-130-8" name="__codelineno-130-8"></a><span class="n">Out</span><span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="s1">&#39;informative descriptor&#39;</span>
</code></pre></div></td></tr></table></div>
<h4 id="__set__">__set__方法<a class="headerlink" href="#__set__" title="Permanent link">&para;</a></h4>
<p><code>__set__</code>方法用来自定义设置某个实例属性时的行为。<code>instance</code>是绑定类实例对象，<code>value</code>是所需要设置的值。</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-131-1">1</a></span>
<span class="normal"><a href="#__codelineno-131-2">2</a></span>
<span class="normal"><a href="#__codelineno-131-3">3</a></span>
<span class="normal"><a href="#__codelineno-131-4">4</a></span>
<span class="normal"><a href="#__codelineno-131-5">5</a></span>
<span class="normal"><a href="#__codelineno-131-6">6</a></span>
<span class="normal"><a href="#__codelineno-131-7">7</a></span>
<span class="normal"><a href="#__codelineno-131-8">8</a></span>
<span class="normal"><a href="#__codelineno-131-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1"></a><span class="k">class</span> <span class="nc">InfoDescriptor</span><span class="p">:</span>
<a id="__codelineno-131-2" name="__codelineno-131-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;打印帮助信息的描述符&quot;&quot;&quot;</span>
<a id="__codelineno-131-3" name="__codelineno-131-3"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-131-4" name="__codelineno-131-4"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calling __get__, instance: </span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">, owner: </span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-131-5" name="__codelineno-131-5"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
<a id="__codelineno-131-6" name="__codelineno-131-6"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calling without instance&quot;</span><span class="p">)</span>
<a id="__codelineno-131-7" name="__codelineno-131-7"></a>        <span class="k">return</span> <span class="s2">&quot;infomative descriptor&quot;</span>
<a id="__codelineno-131-8" name="__codelineno-131-8"></a>    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-131-9" name="__codelineno-131-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calling __set__, instance: </span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">, value: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>如果用描述符所绑定的类来设置，那么就会覆盖该描述符对象，再次设置值就不会出发任何逻辑了
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-132-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-132-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-132-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-132-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-132-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-132-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-132-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-132-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-132-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-132-10">10</a></span>
<span class="normal"><a href="#__codelineno-132-11">11</a></span>
<span class="normal"><a href="#__codelineno-132-12">12</a></span>
<span class="normal"><a href="#__codelineno-132-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="mi">42</span>
<a id="__codelineno-132-2" name="__codelineno-132-2"></a><span class="n">Calling</span> <span class="fm">__set__</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">__main__</span><span class="o">.</span><span class="n">Foo</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x000001DB2F8A7400</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="mi">42</span>
<a id="__codelineno-132-3" name="__codelineno-132-3"></a>
<a id="__codelineno-132-4" name="__codelineno-132-4"></a><span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="n">Foo</span><span class="o">.</span><span class="n">bar</span>
<a id="__codelineno-132-5" name="__codelineno-132-5"></a><span class="n">Calling</span> <span class="fm">__get__</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="p">{</span><span class="n">instance</span><span class="p">},</span> <span class="n">owner</span><span class="p">:</span> <span class="p">{</span><span class="n">owner</span><span class="p">}</span>
<a id="__codelineno-132-6" name="__codelineno-132-6"></a><span class="n">Calling</span> <span class="n">without</span> <span class="n">instance</span>
<a id="__codelineno-132-7" name="__codelineno-132-7"></a><span class="n">Out</span><span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="s1">&#39;infomative descriptor&#39;</span>
<a id="__codelineno-132-8" name="__codelineno-132-8"></a>
<a id="__codelineno-132-9" name="__codelineno-132-9"></a><span class="n">In</span> <span class="p">[</span><span class="mi">56</span><span class="p">]:</span> <span class="n">Foo</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-132-10" name="__codelineno-132-10"></a>
<a id="__codelineno-132-11" name="__codelineno-132-11"></a><span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<a id="__codelineno-132-12" name="__codelineno-132-12"></a>
<a id="__codelineno-132-13" name="__codelineno-132-13"></a><span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">f</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="mi">42</span>
</code></pre></div></td></tr></table></div></p>
<h4 id="__delete__">__delete__方法<a class="headerlink" href="#__delete__" title="Permanent link">&para;</a></h4>
<p><code>__delete__</code>方法是用来控制实例属性被删除的行为
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-133-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-133-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-133-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-133-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-133-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-133-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-133-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-133-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-133-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-133-10">10</a></span>
<span class="normal"><a href="#__codelineno-133-11">11</a></span>
<span class="normal"><a href="#__codelineno-133-12">12</a></span>
<span class="normal"><a href="#__codelineno-133-13">13</a></span>
<span class="normal"><a href="#__codelineno-133-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1"></a><span class="k">class</span> <span class="nc">InfoDescriptor</span><span class="p">:</span>
<a id="__codelineno-133-2" name="__codelineno-133-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;打印帮助信息的描述符&quot;&quot;&quot;</span>
<a id="__codelineno-133-3" name="__codelineno-133-3"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">owner</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-133-4" name="__codelineno-133-4"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calling __get__, instance: </span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">, owner: </span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-133-5" name="__codelineno-133-5"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
<a id="__codelineno-133-6" name="__codelineno-133-6"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Calling without instance&quot;</span><span class="p">)</span>
<a id="__codelineno-133-7" name="__codelineno-133-7"></a>        <span class="k">return</span> <span class="s2">&quot;infomative descriptor&quot;</span>
<a id="__codelineno-133-8" name="__codelineno-133-8"></a>    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-133-9" name="__codelineno-133-9"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calling __set__, instance: </span><span class="si">{</span><span class="n">instance</span><span class="si">}</span><span class="s2">, value: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-133-10" name="__codelineno-133-10"></a>    <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
<a id="__codelineno-133-11" name="__codelineno-133-11"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Deleteion not supported&#39;</span><span class="p">)</span>
<a id="__codelineno-133-12" name="__codelineno-133-12"></a>
<a id="__codelineno-133-13" name="__codelineno-133-13"></a><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
<a id="__codelineno-133-14" name="__codelineno-133-14"></a>    <span class="n">bar</span> <span class="o">=</span> <span class="n">InfoDescriptor</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-134-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-134-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-134-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-134-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-134-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-134-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-134-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-134-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-134-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-134-10">10</a></span>
<span class="normal"><a href="#__codelineno-134-11">11</a></span>
<span class="normal"><a href="#__codelineno-134-12">12</a></span>
<span class="normal"><a href="#__codelineno-134-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1"></a><span class="n">f</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<a id="__codelineno-134-2" name="__codelineno-134-2"></a>
<a id="__codelineno-134-3" name="__codelineno-134-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="k">del</span> <span class="n">f</span><span class="o">.</span><span class="n">bar</span>
<a id="__codelineno-134-4" name="__codelineno-134-4"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-134-5" name="__codelineno-134-5"></a><span class="ne">RuntimeError</span>                              <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-134-6" name="__codelineno-134-6"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">65</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-134-7" name="__codelineno-134-7"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="k">del</span> <span class="n">f</span><span class="o">.</span><span class="n">bar</span>
<a id="__codelineno-134-8" name="__codelineno-134-8"></a>
<a id="__codelineno-134-9" name="__codelineno-134-9"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">59</span><span class="p">],</span> <span class="n">line</span> <span class="mi">11</span><span class="p">,</span> <span class="ow">in</span> <span class="n">InfoDescriptor</span><span class="o">.</span><span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
<a id="__codelineno-134-10" name="__codelineno-134-10"></a>     <span class="mi">10</span> <span class="k">def</span> <span class="fm">__delete__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
<a id="__codelineno-134-11" name="__codelineno-134-11"></a><span class="o">---&gt;</span> <span class="mi">11</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Deletion not supported!&#39;</span><span class="p">)</span>
<a id="__codelineno-134-12" name="__codelineno-134-12"></a>
<a id="__codelineno-134-13" name="__codelineno-134-13"></a><span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Deletion</span> <span class="ow">not</span> <span class="n">supported</span><span class="err">!</span>
</code></pre></div></td></tr></table></div>
<h4 id="set_name"><strong>set_name</strong> 方法<a class="headerlink" href="#set_name" title="Permanent link">&para;</a></h4>
<p><strong><code>__set_name__</code>方法的触发时机是在owner类被创建时</strong>，它接收的两个参数含义：
- <code>owner</code>：描述符对象当前绑定的类
- <code>name</code>：描述符所绑定的属性名称</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-135-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-135-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-135-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-135-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-135-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-135-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-135-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-135-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-135-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-135-10">10</a></span>
<span class="normal"><a href="#__codelineno-135-11">11</a></span>
<span class="normal"><a href="#__codelineno-135-12">12</a></span>
<span class="normal"><a href="#__codelineno-135-13">13</a></span>
<span class="normal"><a href="#__codelineno-135-14">14</a></span>
<span class="normal"><a href="#__codelineno-135-15">15</a></span>
<span class="normal"><a href="#__codelineno-135-16">16</a></span>
<span class="normal"><a href="#__codelineno-135-17">17</a></span>
<span class="normal"><a href="#__codelineno-135-18">18</a></span>
<span class="normal"><a href="#__codelineno-135-19">19</a></span>
<span class="normal"><a href="#__codelineno-135-20">20</a></span>
<span class="normal"><a href="#__codelineno-135-21">21</a></span>
<span class="normal"><a href="#__codelineno-135-22">22</a></span>
<span class="normal"><a href="#__codelineno-135-23">23</a></span>
<span class="normal"><a href="#__codelineno-135-24">24</a></span>
<span class="normal"><a href="#__codelineno-135-25">25</a></span>
<span class="normal"><a href="#__codelineno-135-26">26</a></span>
<span class="normal"><a href="#__codelineno-135-27">27</a></span>
<span class="normal"><a href="#__codelineno-135-28">28</a></span>
<span class="normal"><a href="#__codelineno-135-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1"></a><span class="k">class</span> <span class="nc">IntegerField</span><span class="p">:</span>
<a id="__codelineno-135-2" name="__codelineno-135-2"></a>    <span class="p">:</span><span class="n">param</span> <span class="n">min_value</span><span class="p">:</span> <span class="n">允许的最小值</span>
<a id="__codelineno-135-3" name="__codelineno-135-3"></a>    <span class="p">:</span><span class="n">param</span> <span class="n">max_value</span><span class="p">:</span> <span class="n">允许的最大值</span>
<a id="__codelineno-135-4" name="__codelineno-135-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_value</span><span class="p">,</span> <span class="n">max_value</span><span class="p">):</span>
<a id="__codelineno-135-5" name="__codelineno-135-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">=</span> <span class="n">min_value</span>
<a id="__codelineno-135-6" name="__codelineno-135-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span> <span class="o">=</span> <span class="n">max_value</span>
<a id="__codelineno-135-7" name="__codelineno-135-7"></a>    <span class="k">def</span> <span class="nf">__set_name__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<a id="__codelineno-135-8" name="__codelineno-135-8"></a>        <span class="c1"># 将绑定属性名保存描述符对象中</span>
<a id="__codelineno-135-9" name="__codelineno-135-9"></a>        <span class="c1"># 对于age = IntegerField(...)来说，此处name就是&quot;age&quot;</span>
<a id="__codelineno-135-10" name="__codelineno-135-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
<a id="__codelineno-135-11" name="__codelineno-135-11"></a>    <span class="k">def</span> <span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-135-12" name="__codelineno-135-12"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">instance</span><span class="p">:</span>
<a id="__codelineno-135-13" name="__codelineno-135-13"></a>            <span class="k">return</span> <span class="bp">self</span>
<a id="__codelineno-135-14" name="__codelineno-135-14"></a>        <span class="c1"># 在数据存取时，使用动态的self._name</span>
<a id="__codelineno-135-15" name="__codelineno-135-15"></a>        <span class="k">return</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
<a id="__codelineno-135-16" name="__codelineno-135-16"></a>    <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-135-17" name="__codelineno-135-17"></a>        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-135-18" name="__codelineno-135-18"></a>        <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-135-19" name="__codelineno-135-19"></a>    <span class="k">def</span> <span class="nf">_validate_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-135-20" name="__codelineno-135-20"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;校验值是否为符合要求的整数&quot;&quot;&quot;</span>
<a id="__codelineno-135-21" name="__codelineno-135-21"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-135-22" name="__codelineno-135-22"></a>            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-135-23" name="__codelineno-135-23"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
<a id="__codelineno-135-24" name="__codelineno-135-24"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value is not validinteger!&quot;</span><span class="p">)</span>
<a id="__codelineno-135-25" name="__codelineno-135-25"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">):</span>
<a id="__codelineno-135-26" name="__codelineno-135-26"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-135-27" name="__codelineno-135-27"></a>                <span class="sa">f</span><span class="s2">&quot;value must between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="si">}</span><span class="s2">!&quot;</span>
<a id="__codelineno-135-28" name="__codelineno-135-28"></a>            <span class="p">)</span>
<a id="__codelineno-135-29" name="__codelineno-135-29"></a>        <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-136-1">1</a></span>
<span class="normal"><a href="#__codelineno-136-2">2</a></span>
<span class="normal"><a href="#__codelineno-136-3">3</a></span>
<span class="normal"><a href="#__codelineno-136-4">4</a></span>
<span class="normal"><a href="#__codelineno-136-5">5</a></span>
<span class="normal"><a href="#__codelineno-136-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1"></a><span class="k">class</span> <span class="nc">Rectangle</span><span class="p">:</span>
<a id="__codelineno-136-2" name="__codelineno-136-2"></a>    <span class="n">width</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-136-3" name="__codelineno-136-3"></a>    <span class="n">height</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">(</span><span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-136-4" name="__codelineno-136-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-136-5" name="__codelineno-136-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
<a id="__codelineno-136-6" name="__codelineno-136-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>    
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-137-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-137-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-137-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-137-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-137-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-137-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-137-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-137-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-137-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-137-10">10</a></span>
<span class="normal"><a href="#__codelineno-137-11">11</a></span>
<span class="normal"><a href="#__codelineno-137-12">12</a></span>
<span class="normal"><a href="#__codelineno-137-13">13</a></span>
<span class="normal"><a href="#__codelineno-137-14">14</a></span>
<span class="normal"><a href="#__codelineno-137-15">15</a></span>
<span class="normal"><a href="#__codelineno-137-16">16</a></span>
<span class="normal"><a href="#__codelineno-137-17">17</a></span>
<span class="normal"><a href="#__codelineno-137-18">18</a></span>
<span class="normal"><a href="#__codelineno-137-19">19</a></span>
<span class="normal"><a href="#__codelineno-137-20">20</a></span>
<span class="normal"><a href="#__codelineno-137-21">21</a></span>
<span class="normal"><a href="#__codelineno-137-22">22</a></span>
<span class="normal"><a href="#__codelineno-137-23">23</a></span>
<span class="normal"><a href="#__codelineno-137-24">24</a></span>
<span class="normal"><a href="#__codelineno-137-25">25</a></span>
<span class="normal"><a href="#__codelineno-137-26">26</a></span>
<span class="normal"><a href="#__codelineno-137-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">r</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-137-2" name="__codelineno-137-2"></a>
<a id="__codelineno-137-3" name="__codelineno-137-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">5</span>
<a id="__codelineno-137-4" name="__codelineno-137-4"></a>
<a id="__codelineno-137-5" name="__codelineno-137-5"></a><span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">height</span>
<a id="__codelineno-137-6" name="__codelineno-137-6"></a><span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="mi">1</span>
<a id="__codelineno-137-7" name="__codelineno-137-7"></a>
<a id="__codelineno-137-8" name="__codelineno-137-8"></a><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">r</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-137-9" name="__codelineno-137-9"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-137-10" name="__codelineno-137-10"></a><span class="ne">ValueError</span>                                <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-137-11" name="__codelineno-137-11"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-137-12" name="__codelineno-137-12"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">r</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-137-13" name="__codelineno-137-13"></a>
<a id="__codelineno-137-14" name="__codelineno-137-14"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">line</span> <span class="mi">19</span><span class="p">,</span> <span class="ow">in</span> <span class="n">IntegerField</span><span class="o">.</span><span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-137-15" name="__codelineno-137-15"></a>     <span class="mi">18</span> <span class="k">def</span> <span class="fm">__set__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<a id="__codelineno-137-16" name="__codelineno-137-16"></a><span class="o">---&gt;</span> <span class="mi">19</span>     <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-137-17" name="__codelineno-137-17"></a>     <span class="mi">20</span>     <span class="n">instance</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a id="__codelineno-137-18" name="__codelineno-137-18"></a>
<a id="__codelineno-137-19" name="__codelineno-137-19"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">line</span> <span class="mi">28</span><span class="p">,</span> <span class="ow">in</span> <span class="n">IntegerField</span><span class="o">.</span><span class="n">_validate_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-137-20" name="__codelineno-137-20"></a>     <span class="mi">26</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;value is not validinteger!&#39;</span><span class="p">)</span>
<a id="__codelineno-137-21" name="__codelineno-137-21"></a>     <span class="mi">27</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="p">):</span>
<a id="__codelineno-137-22" name="__codelineno-137-22"></a><span class="o">---&gt;</span> <span class="mi">28</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-137-23" name="__codelineno-137-23"></a>     <span class="mi">29</span>         <span class="sa">f</span><span class="s2">&quot;value must between </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_value</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_value</span><span class="si">}</span><span class="s2">!&quot;</span>
<a id="__codelineno-137-24" name="__codelineno-137-24"></a>     <span class="mi">30</span>         <span class="p">)</span>
<a id="__codelineno-137-25" name="__codelineno-137-25"></a>     <span class="mi">31</span> <span class="k">return</span> <span class="n">value</span>
<a id="__codelineno-137-26" name="__codelineno-137-26"></a>
<a id="__codelineno-137-27" name="__codelineno-137-27"></a><span class="ne">ValueError</span><span class="p">:</span> <span class="n">value</span> <span class="n">must</span> <span class="n">between</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">10</span><span class="err">!</span>
</code></pre></div></td></tr></table></div>
<h4 id="_67">数据描述符与非数据描述符<a class="headerlink" href="#_67" title="Permanent link">&para;</a></h4>
<p>按实现的方式的不同，描述符分为两大类：
1. 非数据描述符：只实现了<code>__get__</code>方法的描述符。
2. 数据描述符：实现了<code>__set__</code>或<code>__delete__</code>其中任何一个方法的描述符。</p>
<p>对于非数据描述符来说，可以直接用instance.attr = ... 来在实例级别重写描述符属性attr，让其读取逻辑不再受描述符的<code>__get__</code>方法管控。</p>
<p>对于数据描述符来说，你无法做到同样的事情。数据描述符所定义属性存储逻辑拥有极高的优先级，无法轻易在实例层面被重写。</p>
<p>所有的python实例方法，类方法、静态方法都是非数据描述符，可以轻易覆盖它们。而<code>property()</code>是数据描述符，你无法直接通过重写修改它的行为。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-138-1">1</a></span>
<span class="normal"><a href="#__codelineno-138-2">2</a></span>
<span class="normal"><a href="#__codelineno-138-3">3</a></span>
<span class="normal"><a href="#__codelineno-138-4">4</a></span>
<span class="normal"><a href="#__codelineno-138-5">5</a></span>
<span class="normal"><a href="#__codelineno-138-6">6</a></span>
<span class="normal"><a href="#__codelineno-138-7">7</a></span>
<span class="normal"><a href="#__codelineno-138-8">8</a></span>
<span class="normal"><a href="#__codelineno-138-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1"></a><span class="k">class</span> <span class="nc">DuckWithProperty</span><span class="p">:</span>
<a id="__codelineno-138-2" name="__codelineno-138-2"></a>    <span class="nd">@property</span>
<a id="__codelineno-138-3" name="__codelineno-138-3"></a>    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-138-4" name="__codelineno-138-4"></a>        <span class="k">return</span> <span class="s1">&#39;gray&#39;</span>
<a id="__codelineno-138-5" name="__codelineno-138-5"></a>
<a id="__codelineno-138-6" name="__codelineno-138-6"></a><span class="k">class</span> <span class="nc">DuckWithStaticMethod</span><span class="p">:</span>
<a id="__codelineno-138-7" name="__codelineno-138-7"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-138-8" name="__codelineno-138-8"></a>    <span class="k">def</span> <span class="nf">color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-138-9" name="__codelineno-138-9"></a>        <span class="k">return</span> <span class="s1">&#39;gray&#39;</span>
</code></pre></div></td></tr></table></div></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-139-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-139-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-139-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-139-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-139-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-139-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-139-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-139-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-139-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-139-10">10</a></span>
<span class="normal"><a href="#__codelineno-139-11">11</a></span>
<span class="normal"><a href="#__codelineno-139-12">12</a></span>
<span class="normal"><a href="#__codelineno-139-13">13</a></span>
<span class="normal"><a href="#__codelineno-139-14">14</a></span>
<span class="normal"><a href="#__codelineno-139-15">15</a></span>
<span class="normal"><a href="#__codelineno-139-16">16</a></span>
<span class="normal"><a href="#__codelineno-139-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1"></a><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="n">DuckWidthProperty</span><span class="p">()</span>
<a id="__codelineno-139-2" name="__codelineno-139-2"></a>
<a id="__codelineno-139-3" name="__codelineno-139-3"></a><span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
<a id="__codelineno-139-4" name="__codelineno-139-4"></a><span class="o">---------------------------------------------------------------------------</span>
<a id="__codelineno-139-5" name="__codelineno-139-5"></a><span class="ne">AttributeError</span>                            <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<a id="__codelineno-139-6" name="__codelineno-139-6"></a><span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<a id="__codelineno-139-7" name="__codelineno-139-7"></a><span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">d</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;yellow&#39;</span>
<a id="__codelineno-139-8" name="__codelineno-139-8"></a>
<a id="__codelineno-139-9" name="__codelineno-139-9"></a><span class="ne">AttributeError</span><span class="p">:</span> <span class="n">can</span><span class="s1">&#39;t set attribute &#39;</span><span class="n">color</span>
<a id="__codelineno-139-10" name="__codelineno-139-10"></a>
<a id="__codelineno-139-11" name="__codelineno-139-11"></a>
<a id="__codelineno-139-12" name="__codelineno-139-12"></a><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="n">DuckWithStaticMethod</span><span class="p">()</span>
<a id="__codelineno-139-13" name="__codelineno-139-13"></a>
<a id="__codelineno-139-14" name="__codelineno-139-14"></a><span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;yellow&quot;</span>
<a id="__codelineno-139-15" name="__codelineno-139-15"></a>
<a id="__codelineno-139-16" name="__codelineno-139-16"></a><span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">d</span><span class="o">.</span><span class="n">color</span>
<a id="__codelineno-139-17" name="__codelineno-139-17"></a><span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="s1">&#39;yellow&#39;</span>
</code></pre></div></td></tr></table></div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["toc.follow", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.instant", "navigation.instant.progress", "navigation.top", "navigation.sections"], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>