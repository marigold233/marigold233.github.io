
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../..">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.11">
    
    
      
        <title>我的Linux&win命令帮助手册 - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://cdn.staticfile.org/lxgw-wenkai-screen-webfont/1.7.0/lxgwwenkaiscreen.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#top" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              我的Linux&win命令帮助手册
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  Linux

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Linux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Linux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    我的Linux&win命令帮助手册
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    我的Linux&win命令帮助手册
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#top" class="md-nav__link">
    <span class="md-ellipsis">
      top
    </span>
  </a>
  
    <nav class="md-nav" aria-label="top">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu" class="md-nav__link">
    <span class="md-ellipsis">
      实时降序CPU或内存占用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      参考
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ps" class="md-nav__link">
    <span class="md-ellipsis">
      ps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu_1" class="md-nav__link">
    <span class="md-ellipsis">
      查看占用 CPU 最多的进程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      查看占用内存最多的进程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      过滤指定程序导致标题遗漏问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpumem" class="md-nav__link">
    <span class="md-ellipsis">
      查看指定进程的CPUMEM使用率
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#procpidstatus" class="md-nav__link">
    <span class="md-ellipsis">
      /proc/pid/status 查看内存使用率
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pidstat" class="md-nav__link">
    <span class="md-ellipsis">
      pidstat
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pidstat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu_2" class="md-nav__link">
    <span class="md-ellipsis">
      查看指定进程CPU内存占用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io" class="md-nav__link">
    <span class="md-ellipsis">
      查看指定进程IO占用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      批量测试端口的连通性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-nmon" class="md-nav__link">
    <span class="md-ellipsis">
      性能监测工具-Nmon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tail-fio" class="md-nav__link">
    <span class="md-ellipsis">
      tail -f加管道命令后不能及时输出的问题（IO缓冲
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemd" class="md-nav__link">
    <span class="md-ellipsis">
      systemd相关命令
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux最大打开文件数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dasel" class="md-nav__link">
    <span class="md-ellipsis">
      dasel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dasel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desal" class="md-nav__link">
    <span class="md-ellipsis">
      基于desal写的脚本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      参考
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iptables" class="md-nav__link">
    <span class="md-ellipsis">
      iptables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iptables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      防火墙规则
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shellstderrstdout" class="md-nav__link">
    <span class="md-ellipsis">
      shell将stderr输出到stdout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grephelp" class="md-nav__link">
    <span class="md-ellipsis">
      grep过滤命令help参数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yum-config-manager" class="md-nav__link">
    <span class="md-ellipsis">
      yum-config-manager配置工具
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coda" class="md-nav__link">
    <span class="md-ellipsis">
      coda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#last" class="md-nav__link">
    <span class="md-ellipsis">
      last
    </span>
  </a>
  
    <nav class="md-nav" aria-label="last">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      重启服务器的时间
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nc" class="md-nav__link">
    <span class="md-ellipsis">
      nc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python3" class="md-nav__link">
    <span class="md-ellipsis">
      python3 开启文件服务器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      haproxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="haproxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      创建账号
    </span>
  </a>
  
    <nav class="md-nav" aria-label="创建账号">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#haproxy_1" class="md-nav__link">
    <span class="md-ellipsis">
      平滑重启haproxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numfmt" class="md-nav__link">
    <span class="md-ellipsis">
      numfmt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shuf" class="md-nav__link">
    <span class="md-ellipsis">
      shuf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pmap" class="md-nav__link">
    <span class="md-ellipsis">
      pmap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      查看进程线程&amp;进程详细信息
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#awk" class="md-nav__link">
    <span class="md-ellipsis">
      awk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="awk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      使用正则进行分组
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tar" class="md-nav__link">
    <span class="md-ellipsis">
      tar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      通过标准输入进行打包
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#curl" class="md-nav__link">
    <span class="md-ellipsis">
      curl
    </span>
  </a>
  
    <nav class="md-nav" aria-label="curl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      学习资料
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https" class="md-nav__link">
    <span class="md-ellipsis">
      忽略https证书和进行密码认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rescurl" class="md-nav__link">
    <span class="md-ellipsis">
      将res结果作为另外一个curl的参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curl-debug" class="md-nav__link">
    <span class="md-ellipsis">
      curl debug
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      随机生成密码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux_1" class="md-nav__link">
    <span class="md-ellipsis">
      调整Linux系统连接数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="调整Linux系统连接数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      临时调整
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todo" class="md-nav__link">
    <span class="md-ellipsis">
      永久修改(TODO)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-socket" class="md-nav__link">
    <span class="md-ellipsis">
      linux socket连接数统计
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx_2" class="md-nav__link">
    <span class="md-ellipsis">
      NGINX
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NGINX">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx_3" class="md-nav__link">
    <span class="md-ellipsis">
      通过信号控制NGINX
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shc-shell" class="md-nav__link">
    <span class="md-ellipsis">
      shc 加密shell脚本
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      docker-compose
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strip" class="md-nav__link">
    <span class="md-ellipsis">
      strip — 丢弃对象文件中的符号和其他数据
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nmcli" class="md-nav__link">
    <span class="md-ellipsis">
      nmcli
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wget" class="md-nav__link">
    <span class="md-ellipsis">
      wget
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcregrep-pcre2grep" class="md-nav__link">
    <span class="md-ellipsis">
      pcregrep &amp; pcre2grep
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sudo" class="md-nav__link">
    <span class="md-ellipsis">
      sudo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      windows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="windows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bvssh" class="md-nav__link">
    <span class="md-ellipsis">
      Bvssh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vboxmanage" class="md-nav__link">
    <span class="md-ellipsis">
      VBoxManage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work" class="md-nav__link">
    <span class="md-ellipsis">
      work
    </span>
  </a>
  
    <nav class="md-nav" aria-label="work">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#idcardcaches" class="md-nav__link">
    <span class="md-ellipsis">
      处理idCardCaches目录文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caches" class="md-nav__link">
    <span class="md-ellipsis">
      处理Caches目录文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    <span class="md-ellipsis">
      network业务量按每小时统计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networ" class="md-nav__link">
    <span class="md-ellipsis">
      networ业务量按每分钟统计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error" class="md-nav__link">
    <span class="md-ellipsis">
      统计ERROR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warn" class="md-nav__link">
    <span class="md-ellipsis">
      统计WARN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp" class="md-nav__link">
    <span class="md-ellipsis">
      统计TCP连接状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      程序打开文件数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server_statustxt" class="md-nav__link">
    <span class="md-ellipsis">
      动态刷新server_status.txt文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#top" class="md-nav__link">
    <span class="md-ellipsis">
      top
    </span>
  </a>
  
    <nav class="md-nav" aria-label="top">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu" class="md-nav__link">
    <span class="md-ellipsis">
      实时降序CPU或内存占用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      参考
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ps" class="md-nav__link">
    <span class="md-ellipsis">
      ps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu_1" class="md-nav__link">
    <span class="md-ellipsis">
      查看占用 CPU 最多的进程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      查看占用内存最多的进程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      过滤指定程序导致标题遗漏问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cpumem" class="md-nav__link">
    <span class="md-ellipsis">
      查看指定进程的CPUMEM使用率
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#procpidstatus" class="md-nav__link">
    <span class="md-ellipsis">
      /proc/pid/status 查看内存使用率
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pidstat" class="md-nav__link">
    <span class="md-ellipsis">
      pidstat
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pidstat">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cpu_2" class="md-nav__link">
    <span class="md-ellipsis">
      查看指定进程CPU内存占用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#io" class="md-nav__link">
    <span class="md-ellipsis">
      查看指定进程IO占用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      批量测试端口的连通性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#-nmon" class="md-nav__link">
    <span class="md-ellipsis">
      性能监测工具-Nmon
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tail-fio" class="md-nav__link">
    <span class="md-ellipsis">
      tail -f加管道命令后不能及时输出的问题（IO缓冲
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemd" class="md-nav__link">
    <span class="md-ellipsis">
      systemd相关命令
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    <span class="md-ellipsis">
      Linux最大打开文件数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dasel" class="md-nav__link">
    <span class="md-ellipsis">
      dasel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dasel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#desal" class="md-nav__link">
    <span class="md-ellipsis">
      基于desal写的脚本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      参考
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#iptables" class="md-nav__link">
    <span class="md-ellipsis">
      iptables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="iptables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      防火墙规则
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shellstderrstdout" class="md-nav__link">
    <span class="md-ellipsis">
      shell将stderr输出到stdout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grephelp" class="md-nav__link">
    <span class="md-ellipsis">
      grep过滤命令help参数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yum-config-manager" class="md-nav__link">
    <span class="md-ellipsis">
      yum-config-manager配置工具
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coda" class="md-nav__link">
    <span class="md-ellipsis">
      coda
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#last" class="md-nav__link">
    <span class="md-ellipsis">
      last
    </span>
  </a>
  
    <nav class="md-nav" aria-label="last">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      重启服务器的时间
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nc" class="md-nav__link">
    <span class="md-ellipsis">
      nc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python3" class="md-nav__link">
    <span class="md-ellipsis">
      python3 开启文件服务器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      haproxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="haproxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      安装
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      创建账号
    </span>
  </a>
  
    <nav class="md-nav" aria-label="创建账号">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#haproxy_1" class="md-nav__link">
    <span class="md-ellipsis">
      平滑重启haproxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numfmt" class="md-nav__link">
    <span class="md-ellipsis">
      numfmt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shuf" class="md-nav__link">
    <span class="md-ellipsis">
      shuf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pmap" class="md-nav__link">
    <span class="md-ellipsis">
      pmap
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      查看进程线程&amp;进程详细信息
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#awk" class="md-nav__link">
    <span class="md-ellipsis">
      awk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="awk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      使用正则进行分组
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tar" class="md-nav__link">
    <span class="md-ellipsis">
      tar
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      通过标准输入进行打包
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#curl" class="md-nav__link">
    <span class="md-ellipsis">
      curl
    </span>
  </a>
  
    <nav class="md-nav" aria-label="curl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      学习资料
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https" class="md-nav__link">
    <span class="md-ellipsis">
      忽略https证书和进行密码认证
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rescurl" class="md-nav__link">
    <span class="md-ellipsis">
      将res结果作为另外一个curl的参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curl-debug" class="md-nav__link">
    <span class="md-ellipsis">
      curl debug
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      随机生成密码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux_1" class="md-nav__link">
    <span class="md-ellipsis">
      调整Linux系统连接数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="调整Linux系统连接数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      临时调整
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#todo" class="md-nav__link">
    <span class="md-ellipsis">
      永久修改(TODO)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linux-socket" class="md-nav__link">
    <span class="md-ellipsis">
      linux socket连接数统计
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nginx_2" class="md-nav__link">
    <span class="md-ellipsis">
      NGINX
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NGINX">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nginx_3" class="md-nav__link">
    <span class="md-ellipsis">
      通过信号控制NGINX
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shc-shell" class="md-nav__link">
    <span class="md-ellipsis">
      shc 加密shell脚本
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    <span class="md-ellipsis">
      Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      docker-compose
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#strip" class="md-nav__link">
    <span class="md-ellipsis">
      strip — 丢弃对象文件中的符号和其他数据
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nmcli" class="md-nav__link">
    <span class="md-ellipsis">
      nmcli
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wget" class="md-nav__link">
    <span class="md-ellipsis">
      wget
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcregrep-pcre2grep" class="md-nav__link">
    <span class="md-ellipsis">
      pcregrep &amp; pcre2grep
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sudo" class="md-nav__link">
    <span class="md-ellipsis">
      sudo
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    <span class="md-ellipsis">
      windows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="windows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bvssh" class="md-nav__link">
    <span class="md-ellipsis">
      Bvssh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vboxmanage" class="md-nav__link">
    <span class="md-ellipsis">
      VBoxManage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work" class="md-nav__link">
    <span class="md-ellipsis">
      work
    </span>
  </a>
  
    <nav class="md-nav" aria-label="work">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#idcardcaches" class="md-nav__link">
    <span class="md-ellipsis">
      处理idCardCaches目录文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caches" class="md-nav__link">
    <span class="md-ellipsis">
      处理Caches目录文件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network" class="md-nav__link">
    <span class="md-ellipsis">
      network业务量按每小时统计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networ" class="md-nav__link">
    <span class="md-ellipsis">
      networ业务量按每分钟统计
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error" class="md-nav__link">
    <span class="md-ellipsis">
      统计ERROR
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#warn" class="md-nav__link">
    <span class="md-ellipsis">
      统计WARN
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tcp" class="md-nav__link">
    <span class="md-ellipsis">
      统计TCP连接状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      程序打开文件数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#server_statustxt" class="md-nav__link">
    <span class="md-ellipsis">
      动态刷新server_status.txt文件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>我的Linux&win命令帮助手册</h1>

<h2 id="top">top<a class="headerlink" href="#top" title="Permanent link">&para;</a></h2>
<h3 id="cpu">实时降序CPU或内存占用<a class="headerlink" href="#cpu" title="Permanent link">&para;</a></h3>
<blockquote>
<p>top命令：在终端中运行top命令，然后按下"Shift + M"键，按内存使用量进行排序。这将显示当前运行的所有进程按照内存使用量从高到低的列表。您可以查看RES（Resident Set Size）列，它表示进程实际占用的物理内存。
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>Shift<span class="w"> </span>+<span class="w"> </span>M<span class="w"> </span>按mem降序
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>Shift<span class="w"> </span>+<span class="w"> </span>C<span class="w"> </span>按CPU降序
</code></pre></div></td></tr></table></div></p>
</blockquote>
<p>显示内存、swap占用百分比并显示进度条
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>top<span class="w"> </span>按下然后按m
</code></pre></div></td></tr></table></div></p>
<p>显示cpu占用百分比并显示进度条
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>top<span class="w"> </span>按下然后按t
</code></pre></div></td></tr></table></div></p>
<h3 id="_1">参考<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<ul>
<li>https://qiita.com/Kernel_OGSun/items/55afb7e93b445f1be019</li>
</ul>
<h2 id="ps">ps<a class="headerlink" href="#ps" title="Permanent link">&para;</a></h2>
<h3 id="cpu_1">查看占用 CPU 最多的进程<a class="headerlink" href="#cpu_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>ps<span class="w"> </span>aux<span class="w"> </span>--sort<span class="o">=</span>-%cpu<span class="w"> </span><span class="p">|</span><span class="w"> </span>head
</code></pre></div></td></tr></table></div>
<h3 id="_2">查看占用内存最多的进程<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>ps<span class="w"> </span>aux<span class="w"> </span>--sort<span class="o">=</span>-%mem<span class="w"> </span><span class="p">|</span><span class="w"> </span>head
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>ps<span class="w"> </span>aux<span class="w"> </span>--sort<span class="w"> </span>-rss
</code></pre></div></td></tr></table></div>
<h3 id="_3">过滤指定程序导致标题遗漏问题<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>使用多重匹配，多匹配一次<code>PID</code>就可以解决</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>ps<span class="w"> </span>axw<span class="w"> </span>-o<span class="w"> </span>pid,ppid,user,%cpu,vsz,wchan,command<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">&#39;(nginx|PID)&#39;</span>
</code></pre></div></td></tr></table></div>
<h3 id="cpumem">查看指定进程的CPUMEM使用率<a class="headerlink" href="#cpumem" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>ps<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>pgrep<span class="w"> </span>-f<span class="w"> </span>nginx<span class="w"> </span>-o<span class="k">)</span><span class="w"> </span>-o<span class="w"> </span>pid,user,%cpu,%mem,cmd
</code></pre></div></td></tr></table></div>
<p>参考：
<a href="https://www.runoob.com/linux/linux-comm-ps.html">Linux ps 命令 | 菜鸟教程 (runoob.com)</a></p>
<h2 id="procpidstatus">/proc/pid/status 查看内存使用率<a class="headerlink" href="#procpidstatus" title="Permanent link">&para;</a></h2>
<p>/proc/[PID]/status文件：每个运行的进程都在/proc目录下有一个以进程ID命名的目录。进入特定进程的目录（例如/proc/12345），然后查看status文件。在status文件中，可以找到VmRSS字段，它表示进程实际占用的物理内存。</p>
<p><code>cat /proc/12345/status | grep VmRSS</code></p>
<h2 id="pidstat">pidstat<a class="headerlink" href="#pidstat" title="Permanent link">&para;</a></h2>
<h3 id="cpu_2">查看指定进程CPU内存占用<a class="headerlink" href="#cpu_2" title="Permanent link">&para;</a></h3>
<p><strong>可以优先使用ps</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>./pidstat<span class="w"> </span>-ru<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>pgrep<span class="w"> </span>-o<span class="w"> </span>nginx<span class="k">)</span><span class="w"> </span>-h<span class="w"> </span>--human<span class="w"> </span><span class="m">1</span><span class="w"> </span>-l
</code></pre></div></td></tr></table></div>
<h3 id="io">查看指定进程IO占用<a class="headerlink" href="#io" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>./pidstat<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>pgrep<span class="w"> </span>-o<span class="w"> </span>nginx<span class="k">)</span><span class="w"> </span>-h<span class="w"> </span>--human<span class="w"> </span><span class="m">1</span><span class="w"> </span>-l
</code></pre></div></td></tr></table></div>
<h2 id="_4">批量测试端口的连通性<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;for i in {109..228}; do echo -n &quot;$i:&quot;;grep -q &quot;Connect&quot; &amp;&gt; /dev/null &lt;&lt;&lt; `echo | timeout 3s telnet 192.168.168.$i 7000`; echo $?;done&#39;</span>
</code></pre></div></td></tr></table></div>
<h2 id="-nmon">性能监测工具-Nmon<a class="headerlink" href="#-nmon" title="Permanent link">&para;</a></h2>
<h2 id="tail-fio">tail -f加管道命令后不能及时输出的问题（IO缓冲<a class="headerlink" href="#tail-fio" title="Permanent link">&para;</a></h2>
<ol>
<li>使用stdbuf命令
<code>tail -fn0 a.log | stdbuf -oL grep "F3 00" | grep SR</code></li>
<li>把标准输出重定向到标准错误上，并把错误也给管道（因为stderr是无缓冲的）
<code>tail -f &gt;&amp;2 |&amp; awk</code></li>
</ol>
<h2 id="systemd">systemd相关命令<a class="headerlink" href="#systemd" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># 列出正在运行的 Unit</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>$<span class="w"> </span>systemctl<span class="w"> </span>list-units
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="c1"># 重新加载一个服务的配置文件</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>apache.service
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="c1"># 重载所有修改过的配置文件</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="c1"># 显示某个 Unit 的所有底层参a数</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>$<span class="w"> </span>systemctl<span class="w"> </span>show<span class="w"> </span>httpd.service
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="c1"># 查看指定进程的日志</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>$<span class="w"> </span>sudo<span class="w"> </span>journalctl<span class="w"> </span><span class="nv">_PID</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="c1"># 查看某个路径的脚本的日志</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>$<span class="w"> </span>sudo<span class="w"> </span>journalctl<span class="w"> </span>/usr/bin/bash
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="c1"># 查看指定用户的日志</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a>$<span class="w"> </span>sudo<span class="w"> </span>journalctl<span class="w"> </span><span class="nv">_UID</span><span class="o">=</span><span class="m">33</span><span class="w"> </span>--since<span class="w"> </span>today
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="c1"># 查看某个 Unit 的日志</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a>$<span class="w"> </span>sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>nginx.service
<a id="__codelineno-10-18" name="__codelineno-10-18"></a>$<span class="w"> </span>sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>nginx.service<span class="w"> </span>--since<span class="w"> </span>today
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="c1"># 实时滚动显示某个 Unit 的最新日志</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a>$<span class="w"> </span>sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>nginx.service<span class="w"> </span>-f
</code></pre></div></td></tr></table></div>
<h2 id="linux">Linux最大打开文件数<a class="headerlink" href="#linux" title="Permanent link">&para;</a></h2>
<p>查看用户打开最大文件数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="nb">ulimit</span><span class="w"> </span>-n
</code></pre></div></td></tr></table></div>
<p>查看系统级的最大限制</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a>cat<span class="w"> </span>/proc/sys/fs/file-max
</code></pre></div></td></tr></table></div>
<p>按从大到小排序进程的最大打开文件数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a>lsof<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn<span class="w"> </span><span class="p">|</span><span class="w"> </span>more
</code></pre></div></td></tr></table></div>
<p>~ 只返回程序的pid：lsof -t -c Mail ~</p>
<h2 id="dasel">dasel<a class="headerlink" href="#dasel" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{&quot;users&quot;: [{&quot;name&quot;: &quot;Tom&quot;}]}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>dasel<span class="w"> </span>put<span class="w"> </span>object<span class="w"> </span>-p<span class="w"> </span>json<span class="w"> </span>-t<span class="w"> </span>string<span class="w"> </span><span class="s1">&#39;.users.[]&#39;</span><span class="w"> </span><span class="nv">name</span><span class="o">=</span>Frank
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>./dasel_linux_amd64<span class="w"> </span>delete<span class="w"> </span>-f<span class="w">  </span>example.json<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;.(?:host=192.168.168.33)&#39;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>./dasel_linux_amd64<span class="w"> </span>-n<span class="w"> </span>-f<span class="w">  </span>example.json<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;.(?:host=192.168.168.911)&#39;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w"> </span>./dasel_linux_amd64<span class="w"> </span>-n<span class="w"> </span>-f<span class="w">  </span>example.json<span class="w"> </span>-m<span class="w"> </span><span class="s1">&#39;[0].host&#39;</span><span class="w"> </span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w"> </span><span class="c1"># 将删除的内容输出到xxx.json，并不会删除源文件内容，如果不指定-o 则会在源文件上进行修改</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>./dasel_linux_amd64<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>example.json<span class="w"> </span><span class="s1">&#39;[0]&#39;</span><span class="w">  </span>-o<span class="w"> </span>xxx.json
</code></pre></div></td></tr></table></div>
<h3 id="desal">基于desal写的脚本<a class="headerlink" href="#desal" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">  1</a></span>
<span class="normal"><a href="#__codelineno-15-2">  2</a></span>
<span class="normal"><a href="#__codelineno-15-3">  3</a></span>
<span class="normal"><a href="#__codelineno-15-4">  4</a></span>
<span class="normal"><a href="#__codelineno-15-5">  5</a></span>
<span class="normal"><a href="#__codelineno-15-6">  6</a></span>
<span class="normal"><a href="#__codelineno-15-7">  7</a></span>
<span class="normal"><a href="#__codelineno-15-8">  8</a></span>
<span class="normal"><a href="#__codelineno-15-9">  9</a></span>
<span class="normal"><a href="#__codelineno-15-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-15-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-15-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-15-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-15-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-15-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-15-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-15-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-15-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-15-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-15-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-15-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-15-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-15-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-15-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-15-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-15-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-15-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-15-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-15-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-15-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-15-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-15-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-15-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-15-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-15-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-15-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-15-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-15-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-15-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-15-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-15-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-15-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-15-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-15-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-15-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-15-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-15-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-15-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-15-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-15-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-15-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-15-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-15-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-15-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-15-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-15-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-15-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-15-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-15-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-15-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-15-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-15-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-15-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-15-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-15-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-15-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-15-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-15-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-15-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-15-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-15-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-15-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-15-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-15-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-15-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-15-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-15-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-15-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-15-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-15-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-15-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-15-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-15-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-15-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-15-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-15-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-15-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-15-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-15-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-15-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-15-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-15-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-15-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-15-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-15-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-15-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-15-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-15-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-15-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-15-100">100</a></span>
<span class="normal"><a href="#__codelineno-15-101">101</a></span>
<span class="normal"><a href="#__codelineno-15-102">102</a></span>
<span class="normal"><a href="#__codelineno-15-103">103</a></span>
<span class="normal"><a href="#__codelineno-15-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="ch">#!/usr/bin/env bash</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nv">SCRIPT_LOG</span><span class="o">=</span><span class="s2">&quot;./logs/action_</span><span class="k">$(</span>date<span class="w"> </span><span class="s2">&quot;+%-Y-%m-%d&quot;</span><span class="k">)</span><span class="s2">.log&quot;</span><span class="w"> </span><span class="c1"># _$(date &quot;+%-Y-%m-%d&quot;).log</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="nv">DECODE_SERVER_CONFIG</span><span class="o">=</span>sam_servers.json
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="nv">DECODE_SERVER_QUANTITY</span><span class="o">=</span><span class="k">$(</span>./dasel<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span><span class="s1">&#39;[#]&#39;</span><span class="k">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="nv">DELETED_SERVER_CONFIG</span><span class="o">=</span>deleted-servers.json
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="k">function</span><span class="w"> </span>logger<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">        </span><span class="nv">level</span><span class="o">=</span><span class="nv">$1</span><span class="p">;</span><span class="w"> </span><span class="nv">msg</span><span class="o">=</span><span class="nv">$2</span><span class="p">;</span><span class="w"> </span><span class="nv">_output_file</span><span class="o">=</span><span class="si">${</span><span class="nv">3</span><span class="p">-true</span><span class="si">}</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nv">$_output_file</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">  </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span><span class="k">$(</span>dirname<span class="w"> </span><span class="nv">$SCRIPT_LOG</span><span class="k">)</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span><span class="k">$(</span>dirname<span class="w"> </span><span class="nv">$SCRIPT_LOG</span><span class="k">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">  </span><span class="o">[</span><span class="w"> </span>-f<span class="w"> </span><span class="nv">$SCRIPT_LOG</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span>touch<span class="w"> </span><span class="nv">$SCRIPT_LOG</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$level</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>info<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="k">then</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">                        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s2">&quot;+%F %T&quot;</span><span class="k">)</span><span class="s2"> [</span><span class="nv">$level</span><span class="s2">]: </span><span class="nv">$msg</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SCRIPT_LOG</span><span class="s2">&quot;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">                </span><span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$level</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>err<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="k">then</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">                        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\e[1;31m</span><span class="k">$(</span>date<span class="w"> </span><span class="s2">&quot;+%F %T&quot;</span><span class="k">)</span><span class="s2"> [</span><span class="nv">$level</span><span class="s2">]: </span><span class="nv">$msg</span><span class="s2">\e[0m&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SCRIPT_LOG</span><span class="s2">&quot;</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">                </span><span class="k">fi</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">         </span><span class="k">else</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$level</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>info<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="k">then</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">                        </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>date<span class="w"> </span><span class="s2">&quot;+%F %T&quot;</span><span class="k">)</span><span class="s2"> [</span><span class="nv">$level</span><span class="s2">]: </span><span class="nv">$msg</span><span class="s2">&quot;</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">                 </span><span class="k">elif</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$level</span><span class="w"> </span><span class="o">==</span><span class="w"> </span>err<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="k">then</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">                         </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\e[1;31m</span><span class="k">$(</span>date<span class="w"> </span><span class="s2">&quot;+%F %T&quot;</span><span class="k">)</span><span class="s2"> [</span><span class="nv">$level</span><span class="s2">]: </span><span class="nv">$msg</span><span class="s2">\e[0m&quot;</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">                 </span><span class="k">fi</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="o">}</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>touch<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;开始剔除失效的解码服务器...&quot;</span>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="nv">DELETE_SERVER_LIST</span><span class="o">=()</span>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a><span class="k">for</span><span class="w"> </span><span class="o">((</span><span class="nv">index</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span>index&lt;<span class="nv">$DECODE_SERVER_QUANTITY</span><span class="p">;</span><span class="w"> </span>index++<span class="o">))</span><span class="p">;</span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="k">do</span><span class="w"> </span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="w"> </span><span class="nv">IP</span><span class="o">=</span><span class="k">$(</span>./dasel<span class="w"> </span>--plain<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span><span class="s2">&quot;[</span><span class="nv">$index</span><span class="s2">].host&quot;</span><span class="k">)</span>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a><span class="w"> </span><span class="nv">PORT</span><span class="o">=</span><span class="k">$(</span>./dasel<span class="w"> </span>--plain<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span><span class="s2">&quot;[</span><span class="nv">$index</span><span class="s2">].port&quot;</span><span class="k">)</span>
<a id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span>./wait-for-it.sh<span class="w"> </span><span class="nv">$IP</span>:<span class="nv">$PORT</span><span class="w"> </span>-t<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
<a id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="w">  </span><span class="c1">#logger info  &quot;$IP:$PORT is open&quot; false</span>
<a id="__codelineno-15-38" name="__codelineno-15-38"></a><span class="w">  </span>:
<a id="__codelineno-15-39" name="__codelineno-15-39"></a><span class="w"> </span><span class="k">else</span>
<a id="__codelineno-15-40" name="__codelineno-15-40"></a><span class="w">  </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$IP</span><span class="s2">:</span><span class="nv">$PORT</span><span class="s2"> is closed&quot;</span><span class="w"> </span><span class="nb">false</span>
<a id="__codelineno-15-41" name="__codelineno-15-41"></a><span class="w">  </span><span class="nv">DELETE_SERVER_LIST</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$IP</span><span class="s2">:</span><span class="nv">$PORT</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-15-42" name="__codelineno-15-42"></a><span class="w"> </span><span class="k">fi</span>
<a id="__codelineno-15-43" name="__codelineno-15-43"></a><span class="k">done</span>
<a id="__codelineno-15-44" name="__codelineno-15-44"></a><span class="k">for</span><span class="w"> </span>server<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">DELETE_SERVER_LIST</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-15-45" name="__codelineno-15-45"></a><span class="w"> </span><span class="nv">DELETE_SERVER_IP</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="nv">$server</span><span class="k">)</span>
<a id="__codelineno-15-46" name="__codelineno-15-46"></a><span class="w"> </span><span class="nv">DELETE_SERVER_PORT</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="nv">$server</span><span class="k">)</span>
<a id="__codelineno-15-47" name="__codelineno-15-47"></a><span class="w"> </span><span class="c1"># 如果屏蔽IP已经存在屏蔽文件中, 还会判断在不在解码服务器列表中，如果在还会继续删掉，不在就会跳过</span>
<a id="__codelineno-15-48" name="__codelineno-15-48"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>./dasel<span class="w"> </span>-n<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;.(?:host=</span><span class="nv">$DELETE_SERVER_IP</span><span class="s2">)&quot;</span><span class="k">)</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>null<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-49" name="__codelineno-15-49"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>./dasel<span class="w"> </span>-n<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;.(?:host=</span><span class="nv">$DELETE_SERVER_IP</span><span class="s2">)&quot;</span><span class="k">)</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>null<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-50" name="__codelineno-15-50"></a><span class="w">       </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;*注意* </span><span class="nv">$server</span><span class="s2"> 该服务器还存在于 </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="s2"> ，进行删除操作&quot;</span>
<a id="__codelineno-15-51" name="__codelineno-15-51"></a><span class="w">       </span>./dasel<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;(?:host=</span><span class="nv">$DELETE_SERVER_IP</span><span class="s2">)&quot;</span>
<a id="__codelineno-15-52" name="__codelineno-15-52"></a><span class="w">      </span><span class="k">fi</span>
<a id="__codelineno-15-53" name="__codelineno-15-53"></a><span class="w">                        </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$server</span><span class="s2"> 该解码服务器已经存在于屏蔽列表中, 略过&quot;</span>
<a id="__codelineno-15-54" name="__codelineno-15-54"></a><span class="w">                        </span><span class="k">continue</span>
<a id="__codelineno-15-55" name="__codelineno-15-55"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-15-56" name="__codelineno-15-56"></a><span class="w">        </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;开始从 </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="s2"> 剔除解码服务器 </span><span class="nv">$server</span><span class="s2">&quot;</span>
<a id="__codelineno-15-57" name="__codelineno-15-57"></a><span class="w">        </span><span class="nv">SERVER_JSON</span><span class="o">=</span><span class="k">$(</span>./dasel<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;(?:host=</span><span class="nv">$DELETE_SERVER_IP</span><span class="s2">)&quot;</span><span class="k">)</span>
<a id="__codelineno-15-58" name="__codelineno-15-58"></a><span class="w">        </span>./dasel<span class="w"> </span>put<span class="w"> </span>document<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span><span class="s1">&#39;[]&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SERVER_JSON</span><span class="s2">&quot;</span>
<a id="__codelineno-15-59" name="__codelineno-15-59"></a><span class="w">        </span>./dasel<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;(?:host=</span><span class="nv">$DELETE_SERVER_IP</span><span class="s2">)&quot;</span>
<a id="__codelineno-15-60" name="__codelineno-15-60"></a><span class="w">        </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;解码服务器 </span><span class="nv">$server</span><span class="s2"> 剔除成功&quot;</span>
<a id="__codelineno-15-61" name="__codelineno-15-61"></a><span class="k">done</span>
<a id="__codelineno-15-62" name="__codelineno-15-62"></a>
<a id="__codelineno-15-63" name="__codelineno-15-63"></a>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;开始添加已经恢复的解码服务器到管理服务器解码服务器列表当中...&quot;</span>
<a id="__codelineno-15-64" name="__codelineno-15-64"></a><span class="nv">DELETED_SERVER_QUANTITY</span><span class="o">=</span><span class="k">$(</span>./dasel<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span><span class="s1">&#39;[#]&#39;</span><span class="k">)</span>
<a id="__codelineno-15-65" name="__codelineno-15-65"></a><span class="nv">RECOVER_SERVER_LIST</span><span class="o">=()</span>
<a id="__codelineno-15-66" name="__codelineno-15-66"></a><span class="k">for</span><span class="w"> </span><span class="o">((</span><span class="nv">index</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span>index&lt;<span class="nv">$DELETED_SERVER_QUANTITY</span><span class="p">;</span><span class="w"> </span>index++<span class="o">))</span><span class="p">;</span>
<a id="__codelineno-15-67" name="__codelineno-15-67"></a><span class="k">do</span><span class="w"> </span>
<a id="__codelineno-15-68" name="__codelineno-15-68"></a><span class="w"> </span><span class="nv">IP</span><span class="o">=</span><span class="k">$(</span>./dasel<span class="w"> </span>--plain<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span><span class="s2">&quot;[</span><span class="nv">$index</span><span class="s2">].host&quot;</span><span class="k">)</span>
<a id="__codelineno-15-69" name="__codelineno-15-69"></a><span class="w"> </span><span class="nv">PORT</span><span class="o">=</span><span class="k">$(</span>./dasel<span class="w"> </span>--plain<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span><span class="s2">&quot;[</span><span class="nv">$index</span><span class="s2">].port&quot;</span><span class="k">)</span>
<a id="__codelineno-15-70" name="__codelineno-15-70"></a><span class="w"> </span><span class="k">for</span><span class="w"> </span>server<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">DELETE_SERVER_LIST</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-15-71" name="__codelineno-15-71"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="nv">$server</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="si">${</span><span class="nv">IP</span><span class="si">}</span>:<span class="si">${</span><span class="nv">PORT</span><span class="si">}</span><span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-72" name="__codelineno-15-72"></a><span class="w">   </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">IP</span><span class="si">}</span><span class="s2">:</span><span class="si">${</span><span class="nv">PORT</span><span class="si">}</span><span class="s2"> 该服务器刚刚已经屏蔽，不恢复&quot;</span>
<a id="__codelineno-15-73" name="__codelineno-15-73"></a><span class="w">   </span><span class="k">continue</span><span class="w"> </span><span class="m">2</span>
<a id="__codelineno-15-74" name="__codelineno-15-74"></a><span class="w">  </span><span class="k">fi</span>
<a id="__codelineno-15-75" name="__codelineno-15-75"></a><span class="w"> </span><span class="k">done</span>
<a id="__codelineno-15-76" name="__codelineno-15-76"></a>
<a id="__codelineno-15-77" name="__codelineno-15-77"></a><span class="w"> </span><span class="k">if</span><span class="w"> </span>./wait-for-it.sh<span class="w"> </span><span class="nv">$IP</span>:<span class="nv">$PORT</span><span class="w"> </span>-t<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null
<a id="__codelineno-15-78" name="__codelineno-15-78"></a><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-79" name="__codelineno-15-79"></a><span class="w">  </span>logger<span class="w"> </span>info<span class="w">  </span><span class="s2">&quot;</span><span class="nv">$IP</span><span class="s2">:</span><span class="nv">$PORT</span><span class="s2"> is open&quot;</span><span class="w"> </span><span class="nb">false</span>
<a id="__codelineno-15-80" name="__codelineno-15-80"></a><span class="w">  </span><span class="nv">RECOVER_SERVER_LIST</span><span class="o">+=(</span><span class="s2">&quot;</span><span class="nv">$IP</span><span class="s2">:</span><span class="nv">$PORT</span><span class="s2">&quot;</span><span class="o">)</span>
<a id="__codelineno-15-81" name="__codelineno-15-81"></a><span class="w"> </span><span class="k">else</span>
<a id="__codelineno-15-82" name="__codelineno-15-82"></a><span class="w">  </span><span class="c1">#logger info &quot;$IP:$PORT is closed&quot; false</span>
<a id="__codelineno-15-83" name="__codelineno-15-83"></a><span class="w">  </span><span class="c1">#RECOVER_SERVER_LIST+=(&quot;$IP:$PORT&quot;)</span>
<a id="__codelineno-15-84" name="__codelineno-15-84"></a><span class="w">  </span>:
<a id="__codelineno-15-85" name="__codelineno-15-85"></a><span class="w"> </span><span class="k">fi</span>
<a id="__codelineno-15-86" name="__codelineno-15-86"></a><span class="k">done</span>
<a id="__codelineno-15-87" name="__codelineno-15-87"></a><span class="k">for</span><span class="w"> </span>server<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">RECOVER_SERVER_LIST</span><span class="p">[@]</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-15-88" name="__codelineno-15-88"></a><span class="w"> </span><span class="nv">RECOVER_SERVER_IP</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;{print $1}&#39;</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="nv">$server</span><span class="k">)</span>
<a id="__codelineno-15-89" name="__codelineno-15-89"></a><span class="w"> </span><span class="nv">RECOVER_SERVER_PORT</span><span class="o">=</span><span class="k">$(</span>awk<span class="w"> </span>-F:<span class="w"> </span><span class="s1">&#39;{print $2}&#39;</span><span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span><span class="nv">$server</span><span class="k">)</span>
<a id="__codelineno-15-90" name="__codelineno-15-90"></a><span class="w"> </span><span class="c1"># 恢复的解码IP已经存在于解码服务器列表中，还会继续判断是否在屏蔽列表中，如果在还会删掉屏蔽列表的，不在就会跳过</span>
<a id="__codelineno-15-91" name="__codelineno-15-91"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>./dasel<span class="w"> </span>-n<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;.(?:host=RECOVER_SERVER_IP)&quot;</span><span class="k">)</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>null<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-92" name="__codelineno-15-92"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">[[</span><span class="w"> </span><span class="k">$(</span>./dasel<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;(?:host=</span><span class="nv">$RECOVER_SERVER_IP</span><span class="s2">)&quot;</span><span class="k">)</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span>null<span class="w"> </span><span class="o">]]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<a id="__codelineno-15-93" name="__codelineno-15-93"></a><span class="w">       </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;*注意* </span><span class="nv">$server</span><span class="s2"> 该服务器还存在于 </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="s2"> ，进行删除操作&quot;</span>
<a id="__codelineno-15-94" name="__codelineno-15-94"></a><span class="w">       </span>./dasel<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;(?:host=</span><span class="nv">$RECOVER_SERVER_IP</span><span class="s2">)&quot;</span>
<a id="__codelineno-15-95" name="__codelineno-15-95"></a><span class="w">      </span><span class="k">fi</span>
<a id="__codelineno-15-96" name="__codelineno-15-96"></a><span class="w">                        </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$server</span><span class="s2"> 该解码服务器已经存在于解码服务器列表中, 略过&quot;</span>
<a id="__codelineno-15-97" name="__codelineno-15-97"></a><span class="w">                        </span><span class="k">continue</span>
<a id="__codelineno-15-98" name="__codelineno-15-98"></a><span class="w">        </span><span class="k">fi</span>
<a id="__codelineno-15-99" name="__codelineno-15-99"></a><span class="w">        </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;开始从 </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="s2"> 恢复解码服务器 </span><span class="nv">$server</span><span class="s2">&quot;</span>
<a id="__codelineno-15-100" name="__codelineno-15-100"></a><span class="w">        </span><span class="nv">SERVER_JSON</span><span class="o">=</span><span class="k">$(</span>./dasel<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;(?:host=</span><span class="nv">$RECOVER_SERVER_IP</span><span class="s2">)&quot;</span><span class="k">)</span>
<a id="__codelineno-15-101" name="__codelineno-15-101"></a><span class="w">        </span>./dasel<span class="w"> </span>put<span class="w"> </span>document<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DECODE_SERVER_CONFIG</span><span class="w"> </span><span class="s1">&#39;[]&#39;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$SERVER_JSON</span><span class="s2">&quot;</span>
<a id="__codelineno-15-102" name="__codelineno-15-102"></a><span class="w">        </span>./dasel<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span><span class="nv">$DELETED_SERVER_CONFIG</span><span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;(?:host=</span><span class="nv">$RECOVER_SERVER_IP</span><span class="s2">)&quot;</span>
<a id="__codelineno-15-103" name="__codelineno-15-103"></a><span class="w">        </span>logger<span class="w"> </span>info<span class="w"> </span><span class="s2">&quot;解码服务器 </span><span class="nv">$server</span><span class="s2"> 恢复成功&quot;</span>
<a id="__codelineno-15-104" name="__codelineno-15-104"></a><span class="k">done</span>
</code></pre></div></td></tr></table></div>
<h3 id="_5">参考<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/TomWright/dasel#one-tool-to-rule-them-all">TomWright/dasel: Select, put and delete data from JSON, TOML, YAML, XML and CSV files with a single tool. Supports conversion between formats and can be used as a Go package. (github.com)</a></li>
<li>jq表达式在线验证<a href="https://jqplay.org/">jq play</a></li>
</ul>
<h2 id="iptables">iptables<a class="headerlink" href="#iptables" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span>
<span class="normal"><a href="#__codelineno-16-31">31</a></span>
<span class="normal"><a href="#__codelineno-16-32">32</a></span>
<span class="normal"><a href="#__codelineno-16-33">33</a></span>
<span class="normal"><a href="#__codelineno-16-34">34</a></span>
<span class="normal"><a href="#__codelineno-16-35">35</a></span>
<span class="normal"><a href="#__codelineno-16-36">36</a></span>
<span class="normal"><a href="#__codelineno-16-37">37</a></span>
<span class="normal"><a href="#__codelineno-16-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># 清空自定义链、清空规则、清空规则计数器</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>iptables<span class="w"> </span>-X
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>iptables<span class="w"> </span>-F
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>iptables<span class="w"> </span>-Z
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="c1"># 指定多个端口</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-s<span class="w"> </span><span class="m">172</span>.16.0.0/16<span class="w"> </span>-d<span class="w"> </span><span class="m">172</span>.16.100.10<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>multiport<span class="w"> </span>--dports<span class="w"> </span><span class="m">20</span>:22,80<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-s<span class="w"> </span><span class="m">172</span>.16.0.0/16<span class="w"> </span>-d<span class="w"> </span><span class="m">172</span>.16.100.10<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>multiport<span class="w"> </span>--dports<span class="w"> </span><span class="m">20</span>:22,80<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-16-11" name="__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="c1"># iprange扩展</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="c1"># [!] --src-range from[-to] 源IP地址范围</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="c1"># [!] --dst-range from[-to] 目标IP地址范围</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a>iptabels<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-d<span class="w"> </span><span class="m">172</span>.16.1.100<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">80</span><span class="w"> </span>-m<span class="w"> </span>iprange<span class="w"> </span>--src-range<span class="w"> </span><span class="m">172</span>.16.1.5-192.16.1.10<span class="w"> </span>-j<span class="w"> </span>DROP
<a id="__codelineno-16-17" name="__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="c1"># mac 扩展</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="c1"># mac 模块可以指明源MAC地址,，适用于：PREROUTING, FORWARD，INPUT chains</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="c1"># [!] --mac-source xx:xx:xx:xx:xx</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-s<span class="w"> </span><span class="m">172</span>.16.0.100<span class="w"> </span>-m<span class="w"> </span>mac<span class="w"> </span>--mac-source<span class="w"> </span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="m">00</span>:50:56:12:34:56<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-16-23" name="__codelineno-16-23"></a>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="c1"># 持久保存</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="c1"># centos6:</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a>service<span class="w"> </span>iptables<span class="w"> </span>save
<a id="__codelineno-16-28" name="__codelineno-16-28"></a><span class="c1"># centos7、8</span>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a>iptables-save<span class="w"> </span>&gt;/PATH/TO/SOME_RULES_FILE
<a id="__codelineno-16-30" name="__codelineno-16-30"></a>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a><span class="c1"># 加载规则 centos7：</span>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a>iptables-restore<span class="w"> </span>&lt;<span class="w"> </span>/PATH/FROM/SOME_RULES_FILE
<a id="__codelineno-16-33" name="__codelineno-16-33"></a>-n,<span class="w"> </span>-noflush:<span class="w"> </span>不清除原有规则
<a id="__codelineno-16-34" name="__codelineno-16-34"></a>-t,<span class="w"> </span>-test:<span class="w"> </span>仅生成规则集，但不提交
<a id="__codelineno-16-35" name="__codelineno-16-35"></a>
<a id="__codelineno-16-36" name="__codelineno-16-36"></a><span class="c1"># centos6</span>
<a id="__codelineno-16-37" name="__codelineno-16-37"></a><span class="c1">#会自动从/etc/sysconfig/iptables 重新载入规则</span>
<a id="__codelineno-16-38" name="__codelineno-16-38"></a>service<span class="w">  </span>iptables<span class="w">  </span>restart
</code></pre></div></td></tr></table></div>
<h3 id="_6">防火墙规则<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<h4 id="nginx">内网nginx<a class="headerlink" href="#nginx" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># ssh 端口重要</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED<span class="w"> </span>--dport<span class="w"> </span><span class="m">5151</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="c1"># 服务相关</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="c1"># ng注意端口</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6100</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="c1"># 其它规则</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>INVALID<span class="w"> </span>-j<span class="w"> </span>DROP
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>lo<span class="w">  </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>icmp<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>iprange<span class="w"> </span>--src-range<span class="w"> </span><span class="m">10</span>.128.12.89-10.128.12.90<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">10050</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="c1"># END</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>all<span class="w"> </span>-s<span class="w"> </span>any/0<span class="w"> </span>-j<span class="w"> </span>DROP
</code></pre></div></td></tr></table></div>
<h4 id="nginx_1">公网nginx<a class="headerlink" href="#nginx_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># ssh 端口重要</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED<span class="w"> </span>--dport<span class="w"> </span><span class="m">5151</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="c1"># 服务相关，尽早匹配</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="c1"># ng注意端口</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w">  </span>-m<span class="w"> </span>state<span class="w"> </span><span class="nv">state</span><span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6000</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="c1"># 其它规则</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>INVALID<span class="w"> </span>-j<span class="w"> </span>DROP
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>lo<span class="w">  </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>icmp<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>iprange<span class="w"> </span>--src-range<span class="w"> </span><span class="m">10</span>.128.12.89-10.128.12.90<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="c1"># END</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>all<span class="w"> </span>-s<span class="w"> </span>any/0<span class="w"> </span>-j<span class="w"> </span>DROP
</code></pre></div></td></tr></table></div>
<h4 id="_7">管理服务器<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p><strong>注意92的的ssh端口是22（？）</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># ssh 端口重要</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED<span class="w"> </span>--dport<span class="w"> </span><span class="m">5151</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="c1"># 服务相关，尽早匹配</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="c1"># 管理服务对ng放行</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.128.12.12/24<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span><span class="nv">state</span><span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6200</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.128.12.13/24<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span><span class="nv">state</span><span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6200</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.128.12.61/24<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span><span class="nv">state</span><span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6200</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.128.12.62/24<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span><span class="nv">state</span><span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6200</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="c1"># 其它规则</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>INVALID<span class="w"> </span>-j<span class="w"> </span>DROP
<a id="__codelineno-19-16" name="__codelineno-19-16"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>lo<span class="w">  </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-19-17" name="__codelineno-19-17"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>icmp<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-19-18" name="__codelineno-19-18"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>iprange<span class="w"> </span>--src-range<span class="w"> </span><span class="m">10</span>.128.12.89-10.128.12.90<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-19-19" name="__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="c1"># END</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>all<span class="w"> </span>-s<span class="w"> </span>any/0<span class="w"> </span>-j<span class="w"> </span>DROP
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a>sudo<span class="w"> </span>-i
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>systemctl<span class="w"> </span>stop<span class="w"> </span>firewalld
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>systemctl<span class="w"> </span>disable<span class="w"> </span>firewalld
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>iptables<span class="w"> </span>-X
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>iptables<span class="w"> </span>-F
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>iptables<span class="w"> </span>-Z
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>netstat<span class="w"> </span>-anpt<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ssh<span class="w"> </span><span class="p">|</span><span class="w"> </span>head
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED<span class="w"> </span>--dport<span class="w"> </span><span class="m">5151</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.128.12.12<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6200</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.128.12.13<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6200</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-16" name="__codelineno-20-16"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.128.12.61<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6200</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-17" name="__codelineno-20-17"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>-s<span class="w"> </span><span class="m">10</span>.128.12.62<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>NEW,ESTABLISHED,RELATED<span class="w"> </span>--dport<span class="w"> </span><span class="m">6200</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="c1"># 其它规则</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="o">=</span>INVALID<span class="w"> </span>-j<span class="w"> </span>DROP
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-i<span class="w"> </span>lo<span class="w">  </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-23" name="__codelineno-20-23"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-p<span class="w"> </span>icmp<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-24" name="__codelineno-20-24"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>iprange<span class="w"> </span>--src-range<span class="w"> </span><span class="m">10</span>.128.12.89-10.128.12.90<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>iprange<span class="w"> </span>--src-range<span class="w"> </span><span class="m">10</span>.128.12.14-10.128.12.17<span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-26" name="__codelineno-20-26"></a>iptables<span class="w"> </span>-A<span class="w"> </span>INPUT<span class="w"> </span>-m<span class="w"> </span>state<span class="w"> </span>--state<span class="w"> </span>NEW<span class="w"> </span>-m<span class="w"> </span>tcp<span class="w"> </span>-p<span class="w"> </span>tcp<span class="w"> </span>--dport<span class="w"> </span><span class="m">10050</span><span class="w"> </span>-j<span class="w"> </span>ACCEPT
<a id="__codelineno-20-27" name="__codelineno-20-27"></a>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="c1">#iptables -A INPUT -p all -s any/0 -j DROP</span>
</code></pre></div></td></tr></table></div>
<h2 id="shellstderrstdout">shell将stderr输出到stdout<a class="headerlink" href="#shellstderrstdout" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># |&amp; == 2&gt;&amp;1</span>
</code></pre></div></td></tr></table></div>
<h2 id="grephelp">grep过滤命令help参数<a class="headerlink" href="#grephelp" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span>
<span class="normal"><a href="#__codelineno-22-2">2</a></span>
<span class="normal"><a href="#__codelineno-22-3">3</a></span>
<span class="normal"><a href="#__codelineno-22-4">4</a></span>
<span class="normal"><a href="#__codelineno-22-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a>pgrep<span class="w"> </span>--help1<span class="w"> </span><span class="p">|&amp;</span><span class="w"> </span>grep<span class="w"> </span>-wEc<span class="w"> </span>--<span class="w"> </span><span class="s1">&#39;-l|-f&#39;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>pgrep<span class="w"> </span>--help1<span class="w"> </span><span class="p">|&amp;</span><span class="w"> </span>grep<span class="w"> </span>-wEc<span class="w"> </span>--<span class="w"> </span><span class="s1">&#39;-a|-f&#39;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>pgrep<span class="w"> </span>--help1<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-wEc<span class="w"> </span>--<span class="w"> </span><span class="s1">&#39;-l|-f&#39;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>pgrep<span class="w"> </span>--help1<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-wEc<span class="w"> </span>--<span class="w"> </span><span class="s1">&#39;-a|-f&#39;</span>
</code></pre></div></td></tr></table></div>
<h2 id="yum-config-manager">yum-config-manager配置工具<a class="headerlink" href="#yum-config-manager" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>yum-utils
</code></pre></div></td></tr></table></div>
<p>建议使用阿里云yum源：（推荐）</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>https://download.docker.com/linux/centos/docker-ce.repo
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div></td></tr></table></div>
<h2 id="coda">coda<a class="headerlink" href="#coda" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span>
<span class="normal"><a href="#__codelineno-25-21">21</a></span>
<span class="normal"><a href="#__codelineno-25-22">22</a></span>
<span class="normal"><a href="#__codelineno-25-23">23</a></span>
<span class="normal"><a href="#__codelineno-25-24">24</a></span>
<span class="normal"><a href="#__codelineno-25-25">25</a></span>
<span class="normal"><a href="#__codelineno-25-26">26</a></span>
<span class="normal"><a href="#__codelineno-25-27">27</a></span>
<span class="normal"><a href="#__codelineno-25-28">28</a></span>
<span class="normal"><a href="#__codelineno-25-29">29</a></span>
<span class="normal"><a href="#__codelineno-25-30">30</a></span>
<span class="normal"><a href="#__codelineno-25-31">31</a></span>
<span class="normal"><a href="#__codelineno-25-32">32</a></span>
<span class="normal"><a href="#__codelineno-25-33">33</a></span>
<span class="normal"><a href="#__codelineno-25-34">34</a></span>
<span class="normal"><a href="#__codelineno-25-35">35</a></span>
<span class="normal"><a href="#__codelineno-25-36">36</a></span>
<span class="normal"><a href="#__codelineno-25-37">37</a></span>
<span class="normal"><a href="#__codelineno-25-38">38</a></span>
<span class="normal"><a href="#__codelineno-25-39">39</a></span>
<span class="normal"><a href="#__codelineno-25-40">40</a></span>
<span class="normal"><a href="#__codelineno-25-41">41</a></span>
<span class="normal"><a href="#__codelineno-25-42">42</a></span>
<span class="normal"><a href="#__codelineno-25-43">43</a></span>
<span class="normal"><a href="#__codelineno-25-44">44</a></span>
<span class="normal"><a href="#__codelineno-25-45">45</a></span>
<span class="normal"><a href="#__codelineno-25-46">46</a></span>
<span class="normal"><a href="#__codelineno-25-47">47</a></span>
<span class="normal"><a href="#__codelineno-25-48">48</a></span>
<span class="normal"><a href="#__codelineno-25-49">49</a></span>
<span class="normal"><a href="#__codelineno-25-50">50</a></span>
<span class="normal"><a href="#__codelineno-25-51">51</a></span>
<span class="normal"><a href="#__codelineno-25-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a># 查看conda版本，验证是否安装 
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>conda -V 
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a># 更新conda至最新版本
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>conda update conda 
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a># 更新所有包
<a id="__codelineno-25-8" name="__codelineno-25-8"></a>conda update --all 
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a># 更新指定的包
<a id="__codelineno-25-11" name="__codelineno-25-11"></a>conda update package_name 
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a># 创建名为env_name的新环境，并在该环境下安装名为package_name 的包，
<a id="__codelineno-25-14" name="__codelineno-25-14"></a># 可以指定新环境的版本号，例如：conda create -n python3 python=python3.7 numpy pandas，
<a id="__codelineno-25-15" name="__codelineno-25-15"></a># 创建了python3环境，python版本为3.7，同时还安装了numpy pandas包
<a id="__codelineno-25-16" name="__codelineno-25-16"></a>conda create -n env_name package_name 
<a id="__codelineno-25-17" name="__codelineno-25-17"></a>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a># 切换至env_name环境
<a id="__codelineno-25-19" name="__codelineno-25-19"></a>conda activate env_name 
<a id="__codelineno-25-20" name="__codelineno-25-20"></a>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a>#退出环境
<a id="__codelineno-25-22" name="__codelineno-25-22"></a>conda deactivate 
<a id="__codelineno-25-23" name="__codelineno-25-23"></a>
<a id="__codelineno-25-24" name="__codelineno-25-24"></a># 显示所有已经创建的环境
<a id="__codelineno-25-25" name="__codelineno-25-25"></a>conda info -e  
<a id="__codelineno-25-26" name="__codelineno-25-26"></a># 或者使用 
<a id="__codelineno-25-27" name="__codelineno-25-27"></a>conda env list
<a id="__codelineno-25-28" name="__codelineno-25-28"></a>
<a id="__codelineno-25-29" name="__codelineno-25-29"></a># 复制old_env_name为new_env_name
<a id="__codelineno-25-30" name="__codelineno-25-30"></a>conda create --name new_env_name --clone old_env_name 
<a id="__codelineno-25-31" name="__codelineno-25-31"></a>
<a id="__codelineno-25-32" name="__codelineno-25-32"></a># 删除环境
<a id="__codelineno-25-33" name="__codelineno-25-33"></a>conda remove --name env_name --all 
<a id="__codelineno-25-34" name="__codelineno-25-34"></a>
<a id="__codelineno-25-35" name="__codelineno-25-35"></a># 查看所有已经安装的包
<a id="__codelineno-25-36" name="__codelineno-25-36"></a>conda list 
<a id="__codelineno-25-37" name="__codelineno-25-37"></a>
<a id="__codelineno-25-38" name="__codelineno-25-38"></a># 在当前环境中安装包
<a id="__codelineno-25-39" name="__codelineno-25-39"></a>conda install package_name 
<a id="__codelineno-25-40" name="__codelineno-25-40"></a>
<a id="__codelineno-25-41" name="__codelineno-25-41"></a># 在指定环境中安装包
<a id="__codelineno-25-42" name="__codelineno-25-42"></a>conda install --name env_name package_name 
<a id="__codelineno-25-43" name="__codelineno-25-43"></a>
<a id="__codelineno-25-44" name="__codelineno-25-44"></a># 删除指定环境中的包
<a id="__codelineno-25-45" name="__codelineno-25-45"></a>conda remove -- name env_name package 
<a id="__codelineno-25-46" name="__codelineno-25-46"></a>
<a id="__codelineno-25-47" name="__codelineno-25-47"></a># 采用上一步方法删除环境失败时，可采用这种方法
<a id="__codelineno-25-48" name="__codelineno-25-48"></a>conda env remove -n env_name 
<a id="__codelineno-25-49" name="__codelineno-25-49"></a>
<a id="__codelineno-25-50" name="__codelineno-25-50"></a>
<a id="__codelineno-25-51" name="__codelineno-25-51"></a># 删除当前环境中的包
<a id="__codelineno-25-52" name="__codelineno-25-52"></a>conda remove package 
</code></pre></div></td></tr></table></div>
<h2 id="last">last<a class="headerlink" href="#last" title="Permanent link">&para;</a></h2>
<h3 id="_8">重启服务器的时间<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a>last<span class="w"> </span>-x<span class="w"> </span>reboot
</code></pre></div></td></tr></table></div>
<h2 id="nc">nc<a class="headerlink" href="#nc" title="Permanent link">&para;</a></h2>
<p><a href="https://www.cnblogs.com/adhzl/p/11147708.html">Ubuntu 切换 netcat 为 traditional版以及使用方法 - adhzl - 博客园 (cnblogs.com)</a></p>
<h2 id="python3">python3 开启文件服务器<a class="headerlink" href="#python3" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a>python3<span class="w"> </span>-m<span class="w"> </span>http.server
</code></pre></div></td></tr></table></div>
<h2 id="haproxy">haproxy<a class="headerlink" href="#haproxy" title="Permanent link">&para;</a></h2>
<h3 id="_9">安装<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a>apt<span class="w"> </span>install<span class="w">  </span>liblua5.4-dev<span class="w"> </span>lua5.4
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>make<span class="w"> </span><span class="nv">TARGET</span><span class="o">=</span>linux-glibc<span class="w"> </span><span class="nv">STATIC</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">LDFLAGS</span><span class="o">=</span>-static<span class="w"> </span><span class="nv">USE_LUA</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">USE_OPENSSL</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">USE_PCRE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">USE_ZLIB</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">USE_PROMEX</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">USE_CPU_AFFINITY</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">PREFIX</span><span class="o">=</span>/data/haproxy
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>make<span class="w"> </span>install<span class="w"> </span><span class="nv">PREFIX</span><span class="o">=</span>/apps/haproxy
</code></pre></div></td></tr></table></div>
<h2 id="_10">创建账号<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a>useradd<span class="w"> </span>-r<span class="w"> </span>-M<span class="w"> </span>-s<span class="w"> </span>/sbin/nologin<span class="w"> </span>haproxy
</code></pre></div></td></tr></table></div>
<h3 id="haproxy_1">平滑重启haproxy<a class="headerlink" href="#haproxy_1" title="Permanent link">&para;</a></h3>
<p>不影响现有链接</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a>haproxy<span class="w"> </span>-f<span class="w"> </span>haproxy.cfg<span class="w"> </span>-sf<span class="w"> </span><span class="k">$(</span>pgrep<span class="w"> </span>haproxy<span class="k">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="numfmt">numfmt<a class="headerlink" href="#numfmt" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span>
<span class="normal"><a href="#__codelineno-31-25">25</a></span>
<span class="normal"><a href="#__codelineno-31-26">26</a></span>
<span class="normal"><a href="#__codelineno-31-27">27</a></span>
<span class="normal"><a href="#__codelineno-31-28">28</a></span>
<span class="normal"><a href="#__codelineno-31-29">29</a></span>
<span class="normal"><a href="#__codelineno-31-30">30</a></span>
<span class="normal"><a href="#__codelineno-31-31">31</a></span>
<span class="normal"><a href="#__codelineno-31-32">32</a></span>
<span class="normal"><a href="#__codelineno-31-33">33</a></span>
<span class="normal"><a href="#__codelineno-31-34">34</a></span>
<span class="normal"><a href="#__codelineno-31-35">35</a></span>
<span class="normal"><a href="#__codelineno-31-36">36</a></span>
<span class="normal"><a href="#__codelineno-31-37">37</a></span>
<span class="normal"><a href="#__codelineno-31-38">38</a></span>
<span class="normal"><a href="#__codelineno-31-39">39</a></span>
<span class="normal"><a href="#__codelineno-31-40">40</a></span>
<span class="normal"><a href="#__codelineno-31-41">41</a></span>
<span class="normal"><a href="#__codelineno-31-42">42</a></span>
<span class="normal"><a href="#__codelineno-31-43">43</a></span>
<span class="normal"><a href="#__codelineno-31-44">44</a></span>
<span class="normal"><a href="#__codelineno-31-45">45</a></span>
<span class="normal"><a href="#__codelineno-31-46">46</a></span>
<span class="normal"><a href="#__codelineno-31-47">47</a></span>
<span class="normal"><a href="#__codelineno-31-48">48</a></span>
<span class="normal"><a href="#__codelineno-31-49">49</a></span>
<span class="normal"><a href="#__codelineno-31-50">50</a></span>
<span class="normal"><a href="#__codelineno-31-51">51</a></span>
<span class="normal"><a href="#__codelineno-31-52">52</a></span>
<span class="normal"><a href="#__codelineno-31-53">53</a></span>
<span class="normal"><a href="#__codelineno-31-54">54</a></span>
<span class="normal"><a href="#__codelineno-31-55">55</a></span>
<span class="normal"><a href="#__codelineno-31-56">56</a></span>
<span class="normal"><a href="#__codelineno-31-57">57</a></span>
<span class="normal"><a href="#__codelineno-31-58">58</a></span>
<span class="normal"><a href="#__codelineno-31-59">59</a></span>
<span class="normal"><a href="#__codelineno-31-60">60</a></span>
<span class="normal"><a href="#__codelineno-31-61">61</a></span>
<span class="normal"><a href="#__codelineno-31-62">62</a></span>
<span class="normal"><a href="#__codelineno-31-63">63</a></span>
<span class="normal"><a href="#__codelineno-31-64">64</a></span>
<span class="normal"><a href="#__codelineno-31-65">65</a></span>
<span class="normal"><a href="#__codelineno-31-66">66</a></span>
<span class="normal"><a href="#__codelineno-31-67">67</a></span>
<span class="normal"><a href="#__codelineno-31-68">68</a></span>
<span class="normal"><a href="#__codelineno-31-69">69</a></span>
<span class="normal"><a href="#__codelineno-31-70">70</a></span>
<span class="normal"><a href="#__codelineno-31-71">71</a></span>
<span class="normal"><a href="#__codelineno-31-72">72</a></span>
<span class="normal"><a href="#__codelineno-31-73">73</a></span>
<span class="normal"><a href="#__codelineno-31-74">74</a></span>
<span class="normal"><a href="#__codelineno-31-75">75</a></span>
<span class="normal"><a href="#__codelineno-31-76">76</a></span>
<span class="normal"><a href="#__codelineno-31-77">77</a></span>
<span class="normal"><a href="#__codelineno-31-78">78</a></span>
<span class="normal"><a href="#__codelineno-31-79">79</a></span>
<span class="normal"><a href="#__codelineno-31-80">80</a></span>
<span class="normal"><a href="#__codelineno-31-81">81</a></span>
<span class="normal"><a href="#__codelineno-31-82">82</a></span>
<span class="normal"><a href="#__codelineno-31-83">83</a></span>
<span class="normal"><a href="#__codelineno-31-84">84</a></span>
<span class="normal"><a href="#__codelineno-31-85">85</a></span>
<span class="normal"><a href="#__codelineno-31-86">86</a></span>
<span class="normal"><a href="#__codelineno-31-87">87</a></span>
<span class="normal"><a href="#__codelineno-31-88">88</a></span>
<span class="normal"><a href="#__codelineno-31-89">89</a></span>
<span class="normal"><a href="#__codelineno-31-90">90</a></span>
<span class="normal"><a href="#__codelineno-31-91">91</a></span>
<span class="normal"><a href="#__codelineno-31-92">92</a></span>
<span class="normal"><a href="#__codelineno-31-93">93</a></span>
<span class="normal"><a href="#__codelineno-31-94">94</a></span>
<span class="normal"><a href="#__codelineno-31-95">95</a></span>
<span class="normal"><a href="#__codelineno-31-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a>yanghe@IkunOS:~/coreutils-9.3/src$<span class="w"> </span>./numfmt<span class="w"> </span>--help
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>用法:<span class="w"> </span>./numfmt<span class="w"> </span><span class="o">[</span>选项<span class="o">]</span>...<span class="w"> </span><span class="o">[</span>数字<span class="o">]</span>...
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>对<span class="w"> </span>&lt;数字&gt;<span class="w"> </span>进行重新格式化，如果未指定<span class="w"> </span>&lt;数字&gt;，则从标准输入读取数字。
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>长选项的必选参数对于短选项也是必选的。
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">      </span>--debug<span class="w">          </span>对无效的输入内容打印警告信息
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="w">  </span>-d,<span class="w"> </span>--delimiter<span class="o">=</span>X<span class="w">    </span>使用<span class="w"> </span>X<span class="w"> </span>而不是空格作为字段分隔符
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">      </span>--field<span class="o">=</span>FIELDS<span class="w">   </span>replace<span class="w"> </span>the<span class="w"> </span>numbers<span class="w"> </span><span class="k">in</span><span class="w"> </span>these<span class="w"> </span>input<span class="w"> </span>fields<span class="w"> </span><span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="m">1</span><span class="o">)</span><span class="p">;</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">                         </span>see<span class="w"> </span>FIELDS<span class="w"> </span>below
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">      </span>--format<span class="o">=</span>格式<span class="w">    </span>使用<span class="w"> </span><span class="nb">printf</span><span class="w"> </span>风格的浮点<span class="w"> </span>&lt;格式&gt;；
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="w">                         </span>参见下文<span class="w"> </span>&lt;格式&gt;<span class="w"> </span>部分以了解细节
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">      </span>--from<span class="o">=</span>单位<span class="w">      </span>使用<span class="w"> </span>&lt;单位&gt;<span class="w"> </span>对输入数字进行自动缩放；默认值为<span class="w"> </span><span class="s2">&quot;none&quot;</span>；
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="w">                         </span>参见下文<span class="w"> </span>&lt;单位&gt;<span class="w"> </span>部分
<a id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="w">      </span>--from-unit<span class="o">=</span>N<span class="w">    </span>指定输入的单位大小（而非默认值<span class="w"> </span><span class="m">1</span>）
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w">      </span>--grouping<span class="w">       </span>使用区域设置中定义的方法对数字进行分组，例如<span class="w"> </span><span class="m">1</span>,000,000
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w">                         </span>（意味着该选项在<span class="w"> </span>C/POSIX<span class="w"> </span>区域设置下无效果）
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="w">      </span>--header<span class="o">[=</span>N<span class="o">]</span><span class="w">     </span>将前<span class="w"> </span>N<span class="w"> </span>行视为头部，原样输出（不进行转换）；
<a id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="w">                         </span>如未指定<span class="w"> </span>N，默认值为<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="w">      </span>--invalid<span class="o">=</span>模式<span class="w">   </span>遇到无效数字时的处理模式：<span class="w"> </span>&lt;模式&gt;<span class="w"> </span>可以是：
<a id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">                         </span>abort（默认）、fail、warn、ignore
<a id="__codelineno-31-21" name="__codelineno-31-21"></a><span class="w">      </span>--padding<span class="o">=</span>N<span class="w">      </span>将输出填充至<span class="w"> </span>N<span class="w"> </span>字符长度；若<span class="w"> </span>N<span class="w"> </span>值为正，则使用
<a id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="w">                         </span>右对齐；若<span class="w"> </span>N<span class="w"> </span>值为负，则使用左对齐；
<a id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="w">                         </span>若输出宽度大于<span class="w"> </span>N<span class="w"> </span>的绝对值，则不填充；
<a id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="w">                         </span>默认行为是如果输入含有空格，则自动填充
<a id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="w">      </span>--round<span class="o">=</span>方法<span class="w">     </span>缩放时使用指定<span class="w"> </span>&lt;方法&gt;<span class="w"> </span>进行舍入；&lt;方法&gt;<span class="w"> </span>可以是：
<a id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="w">                         </span>up、down、from-zero（默认）、towards-zero、nearest
<a id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="w">      </span>--suffix<span class="o">=</span>后缀<span class="w">    </span>将<span class="w"> </span>&lt;后缀&gt;<span class="w"> </span>添加到输出数字之后，并允许输入数字中
<a id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="w">                         </span>含有该<span class="w"> </span>&lt;后缀&gt;
<a id="__codelineno-31-29" name="__codelineno-31-29"></a><span class="w">      </span>--to<span class="o">=</span>单位<span class="w">        </span>使用<span class="w"> </span>&lt;单位&gt;<span class="w"> </span>对输出数字进行自动缩放；参见下文<span class="w"> </span>&lt;单位&gt;<span class="w"> </span>部分
<a id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="w">      </span>--to-unit<span class="o">=</span>N<span class="w">      </span>指定输出的单位大小（而非默认值<span class="w"> </span><span class="m">1</span>）
<a id="__codelineno-31-31" name="__codelineno-31-31"></a><span class="w">  </span>-z,<span class="w"> </span>--zero-terminated<span class="w">    </span>以<span class="w"> </span>NUL<span class="w"> </span>空字符而非换行符作为行分隔符
<a id="__codelineno-31-32" name="__codelineno-31-32"></a><span class="w">      </span>--help<span class="w">        </span>display<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<a id="__codelineno-31-33" name="__codelineno-31-33"></a><span class="w">      </span>--version<span class="w">     </span>output<span class="w"> </span>version<span class="w"> </span>information<span class="w"> </span>and<span class="w"> </span><span class="nb">exit</span>
<a id="__codelineno-31-34" name="__codelineno-31-34"></a>
<a id="__codelineno-31-35" name="__codelineno-31-35"></a>&lt;单位&gt;<span class="w"> </span>选项：
<a id="__codelineno-31-36" name="__codelineno-31-36"></a><span class="w">  </span>none<span class="w">       </span>不进行自动缩放；带后缀会触发错误
<a id="__codelineno-31-37" name="__codelineno-31-37"></a><span class="w">  </span>auto<span class="w">       </span>接受可选的单字符或双字符后缀：
<a id="__codelineno-31-38" name="__codelineno-31-38"></a><span class="w">               </span><span class="nv">1K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>,
<a id="__codelineno-31-39" name="__codelineno-31-39"></a><span class="w">               </span><span class="nv">1Ki</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1024</span>,
<a id="__codelineno-31-40" name="__codelineno-31-40"></a><span class="w">               </span><span class="nv">1M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000000</span>,
<a id="__codelineno-31-41" name="__codelineno-31-41"></a><span class="w">               </span><span class="nv">1Mi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1048576</span>,
<a id="__codelineno-31-42" name="__codelineno-31-42"></a><span class="w">  </span>si<span class="w">         </span>接受可选的单字符后缀：
<a id="__codelineno-31-43" name="__codelineno-31-43"></a><span class="w">               </span><span class="nv">1K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span>,
<a id="__codelineno-31-44" name="__codelineno-31-44"></a><span class="w">               </span><span class="nv">1M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000000</span>,
<a id="__codelineno-31-45" name="__codelineno-31-45"></a><span class="w">               </span>...
<a id="__codelineno-31-46" name="__codelineno-31-46"></a><span class="w">  </span>iec<span class="w">        </span>接受可选的单字符后缀：
<a id="__codelineno-31-47" name="__codelineno-31-47"></a><span class="w">               </span><span class="nv">1K</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1024</span>,
<a id="__codelineno-31-48" name="__codelineno-31-48"></a><span class="w">               </span><span class="nv">1M</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1048576</span>,
<a id="__codelineno-31-49" name="__codelineno-31-49"></a><span class="w">               </span>...
<a id="__codelineno-31-50" name="__codelineno-31-50"></a><span class="w">  </span>iec-i<span class="w">      </span>接受可选的双字符后缀：
<a id="__codelineno-31-51" name="__codelineno-31-51"></a><span class="w">               </span><span class="nv">1Ki</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1024</span>,
<a id="__codelineno-31-52" name="__codelineno-31-52"></a><span class="w">               </span><span class="nv">1Mi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1048576</span>,
<a id="__codelineno-31-53" name="__codelineno-31-53"></a><span class="w">               </span>...
<a id="__codelineno-31-54" name="__codelineno-31-54"></a>
<a id="__codelineno-31-55" name="__codelineno-31-55"></a>&lt;字段&gt;<span class="w"> </span>支持<span class="w"> </span>cut<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>风格的字段范围：
<a id="__codelineno-31-56" name="__codelineno-31-56"></a><span class="w">  </span>N<span class="w">    </span>第<span class="w"> </span>N<span class="w"> </span>个字段，从<span class="w"> </span><span class="m">1</span><span class="w"> </span>开始计数
<a id="__codelineno-31-57" name="__codelineno-31-57"></a><span class="w">  </span>N-<span class="w">   </span>从第<span class="w"> </span>N<span class="w"> </span>个字段开始，到行尾
<a id="__codelineno-31-58" name="__codelineno-31-58"></a><span class="w">  </span>N-M<span class="w">  </span>第<span class="w"> </span>N<span class="w"> </span>个到第<span class="w"> </span>M<span class="w"> </span>个字段（含第<span class="w"> </span>N<span class="w"> </span>个和第<span class="w"> </span>M<span class="w"> </span>个）
<a id="__codelineno-31-59" name="__codelineno-31-59"></a><span class="w">  </span>-M<span class="w">   </span>第<span class="w"> </span><span class="m">1</span><span class="w"> </span>个到第<span class="w"> </span>M<span class="w"> </span>个字段（含第<span class="w"> </span><span class="m">1</span><span class="w"> </span>个和第<span class="w"> </span>M<span class="w"> </span>个）
<a id="__codelineno-31-60" name="__codelineno-31-60"></a><span class="w">  </span>-<span class="w">    </span>所有字段
<a id="__codelineno-31-61" name="__codelineno-31-61"></a>多个字段或字段范围可以使用逗号分隔
<a id="__codelineno-31-62" name="__codelineno-31-62"></a>
<a id="__codelineno-31-63" name="__codelineno-31-63"></a>&lt;格式&gt;<span class="w"> </span>必须适合打印一个浮点参数<span class="w"> </span><span class="s2">&quot;%f&quot;</span>。
<a id="__codelineno-31-64" name="__codelineno-31-64"></a>可选的单引号<span class="w"> </span><span class="o">(</span>%<span class="s1">&#39;f) 将启用 --grouping（如果当前区域设置支持）。</span>
<a id="__codelineno-31-65" name="__codelineno-31-65"></a><span class="s1">可选的宽度值 (%10f) 会填充输出。可选的以 0 开头 (%010f) 的宽度</span>
<a id="__codelineno-31-66" name="__codelineno-31-66"></a><span class="s1">会使用 0 对数字进行填充。可选的负值 (%-10f) 会启用左对齐。</span>
<a id="__codelineno-31-67" name="__codelineno-31-67"></a><span class="s1">可选的精度 (%.1f) 会覆盖由输入所确定的精度。</span>
<a id="__codelineno-31-68" name="__codelineno-31-68"></a>
<a id="__codelineno-31-69" name="__codelineno-31-69"></a><span class="s1">如果所有输入数字均成功转换，退出状态值将为 0。</span>
<a id="__codelineno-31-70" name="__codelineno-31-70"></a><span class="s1">默认情况下，./numfmt 将会在第一个转换错误出现时停止并将退出状态设为 2。</span>
<a id="__codelineno-31-71" name="__codelineno-31-71"></a><span class="s1">如果使用了 --invalid=&#39;</span>fail<span class="s1">&#39;，程序每次遇到转换错误时都将输出警告，并在</span>
<a id="__codelineno-31-72" name="__codelineno-31-72"></a><span class="s1">最后将退出状态设为 2。如果使用了 --invalid=&#39;</span>warn<span class="s1">&#39;，程序每次遇到转换</span>
<a id="__codelineno-31-73" name="__codelineno-31-73"></a><span class="s1">错误时都输出诊断信息，但最后的退出状态将为 0。如果使用了</span>
<a id="__codelineno-31-74" name="__codelineno-31-74"></a><span class="s1">--invalid=&#39;</span>ignore<span class="s1">&#39;，程序在遇到转换错误时将不输出诊断信息，最后的</span>
<a id="__codelineno-31-75" name="__codelineno-31-75"></a><span class="s1">退出状态也将为 0。</span>
<a id="__codelineno-31-76" name="__codelineno-31-76"></a>
<a id="__codelineno-31-77" name="__codelineno-31-77"></a><span class="s1">示例：</span>
<a id="__codelineno-31-78" name="__codelineno-31-78"></a><span class="s1">  $ ./numfmt --to=si 1000</span>
<a id="__codelineno-31-79" name="__codelineno-31-79"></a><span class="s1">            -&gt; &quot;1.0K&quot;</span>
<a id="__codelineno-31-80" name="__codelineno-31-80"></a><span class="s1">  $ ./numfmt --to=iec 2048</span>
<a id="__codelineno-31-81" name="__codelineno-31-81"></a><span class="s1">           -&gt; &quot;2.0K&quot;</span>
<a id="__codelineno-31-82" name="__codelineno-31-82"></a><span class="s1">  $ ./numfmt --to=iec-i 4096</span>
<a id="__codelineno-31-83" name="__codelineno-31-83"></a><span class="s1">           -&gt; &quot;4.0Ki&quot;</span>
<a id="__codelineno-31-84" name="__codelineno-31-84"></a><span class="s1">  $ echo 1K | ./numfmt --from=si</span>
<a id="__codelineno-31-85" name="__codelineno-31-85"></a><span class="s1">           -&gt; &quot;1000&quot;</span>
<a id="__codelineno-31-86" name="__codelineno-31-86"></a><span class="s1">  $ echo 1K | ./numfmt --from=iec</span>
<a id="__codelineno-31-87" name="__codelineno-31-87"></a><span class="s1">           -&gt; &quot;1024&quot;</span>
<a id="__codelineno-31-88" name="__codelineno-31-88"></a><span class="s1">  $ df -B1 | ./numfmt --header --field 2-4 --to=si</span>
<a id="__codelineno-31-89" name="__codelineno-31-89"></a><span class="s1">  $ ls -l  | ./numfmt --header --field 5 --to=iec</span>
<a id="__codelineno-31-90" name="__codelineno-31-90"></a><span class="s1">  $ ls -lh | ./numfmt --header --field 5 --from=iec --padding=10</span>
<a id="__codelineno-31-91" name="__codelineno-31-91"></a><span class="s1">  $ ls -lh | ./numfmt --header --field 5 --from=iec --format %10f</span>
<a id="__codelineno-31-92" name="__codelineno-31-92"></a>
<a id="__codelineno-31-93" name="__codelineno-31-93"></a><span class="s1">GNU coreutils 在线帮助：&lt;https://www.gnu.org/software/coreutils/&gt;</span>
<a id="__codelineno-31-94" name="__codelineno-31-94"></a><span class="s1">请向 &lt;http://translationproject.org/team/zh_CN.html&gt; 报告任何翻译错误</span>
<a id="__codelineno-31-95" name="__codelineno-31-95"></a><span class="s1">完整文档 &lt;https://www.gnu.org/software/coreutils/numfmt&gt;</span>
<a id="__codelineno-31-96" name="__codelineno-31-96"></a><span class="s1">或者在本地使用：info &#39;</span><span class="o">(</span>coreutils<span class="o">)</span><span class="w"> </span>numfmt<span class="w"> </span>invocation<span class="err">&#39;</span>
</code></pre></div></td></tr></table></div>
<h2 id="shuf">shuf<a class="headerlink" href="#shuf" title="Permanent link">&para;</a></h2>
<p><strong>在使用<code>shuf</code>命令时，请注意，它可能无法处理非常大的文件，因为它会将整个文件加载到内存中进行处理。对于大型文件，您可能需要寻找其他工具或方法来进行随机化处理。</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>shuf<span class="w"> </span>input.txt
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="c1"># 覆盖</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>shuf<span class="w"> </span>input.txt<span class="w"> </span>-o<span class="w"> </span>output.txt
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="c1"># 随机抽取5行</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a>shuf<span class="w"> </span>-n<span class="w"> </span><span class="m">5</span><span class="w"> </span>input.txt
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="c1"># 生成一个随机数</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>shuf<span class="w"> </span>-i<span class="w"> </span><span class="m">1</span>-100<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="c1"># 从标准输入读取内容</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;line1\nline2\nline3&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>shuf
<a id="__codelineno-32-14" name="__codelineno-32-14"></a>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="c1"># 生成指定范围小数</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="nv">min</span><span class="o">=</span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="nv">max</span><span class="o">=</span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="nv">scale</span><span class="o">=</span><span class="m">100</span><span class="p">;</span><span class="w"> </span>shuf<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;</span><span class="k">$((</span><span class="nv">min</span><span class="o">*</span><span class="nv">scale</span><span class="k">))</span><span class="s2">-</span><span class="k">$((</span><span class="nv">max</span><span class="o">*</span><span class="nv">scale</span><span class="k">))</span><span class="s2">&quot;</span><span class="w"> </span>-n<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{ print $1 / 100 }&#39;</span>
</code></pre></div></td></tr></table></div>
<h2 id="pmap">pmap<a class="headerlink" href="#pmap" title="Permanent link">&para;</a></h2>
<p>~~writeable/private 好像是当前进程占用内存的总量，可能不对~~</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="o">(</span><span class="nv">name</span><span class="o">=</span>idreader<span class="p">;</span><span class="w"> </span>pmap<span class="w"> </span>-d<span class="w"> </span><span class="k">$(</span>pgrep<span class="w"> </span>-fn<span class="w"> </span><span class="nv">$name</span><span class="k">)</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="_11">查看进程线程&amp;进程详细信息<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span>
<span class="normal"><a href="#__codelineno-34-19">19</a></span>
<span class="normal"><a href="#__codelineno-34-20">20</a></span>
<span class="normal"><a href="#__codelineno-34-21">21</a></span>
<span class="normal"><a href="#__codelineno-34-22">22</a></span>
<span class="normal"><a href="#__codelineno-34-23">23</a></span>
<span class="normal"><a href="#__codelineno-34-24">24</a></span>
<span class="normal"><a href="#__codelineno-34-25">25</a></span>
<span class="normal"><a href="#__codelineno-34-26">26</a></span>
<span class="normal"><a href="#__codelineno-34-27">27</a></span>
<span class="normal"><a href="#__codelineno-34-28">28</a></span>
<span class="normal"><a href="#__codelineno-34-29">29</a></span>
<span class="normal"><a href="#__codelineno-34-30">30</a></span>
<span class="normal"><a href="#__codelineno-34-31">31</a></span>
<span class="normal"><a href="#__codelineno-34-32">32</a></span>
<span class="normal"><a href="#__codelineno-34-33">33</a></span>
<span class="normal"><a href="#__codelineno-34-34">34</a></span>
<span class="normal"><a href="#__codelineno-34-35">35</a></span>
<span class="normal"><a href="#__codelineno-34-36">36</a></span>
<span class="normal"><a href="#__codelineno-34-37">37</a></span>
<span class="normal"><a href="#__codelineno-34-38">38</a></span>
<span class="normal"><a href="#__codelineno-34-39">39</a></span>
<span class="normal"><a href="#__codelineno-34-40">40</a></span>
<span class="normal"><a href="#__codelineno-34-41">41</a></span>
<span class="normal"><a href="#__codelineno-34-42">42</a></span>
<span class="normal"><a href="#__codelineno-34-43">43</a></span>
<span class="normal"><a href="#__codelineno-34-44">44</a></span>
<span class="normal"><a href="#__codelineno-34-45">45</a></span>
<span class="normal"><a href="#__codelineno-34-46">46</a></span>
<span class="normal"><a href="#__codelineno-34-47">47</a></span>
<span class="normal"><a href="#__codelineno-34-48">48</a></span>
<span class="normal"><a href="#__codelineno-34-49">49</a></span>
<span class="normal"><a href="#__codelineno-34-50">50</a></span>
<span class="normal"><a href="#__codelineno-34-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>cat<span class="w"> </span>/proc/102551/status<span class="w"> </span><span class="p">|</span><span class="w"> </span>more
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>Name:<span class="w"> </span>java
<a id="__codelineno-34-3" name="__codelineno-34-3"></a>Umask:<span class="w"> </span><span class="m">0002</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>State:<span class="w"> </span>S<span class="w"> </span><span class="o">(</span>sleeping<span class="o">)</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a>Tgid:<span class="w"> </span><span class="m">102551</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a>Ngid:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a>Pid:<span class="w"> </span><span class="m">102551</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a>PPid:<span class="w"> </span><span class="m">102344</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a>TracerPid:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a>Uid:<span class="w"> </span><span class="m">1002</span><span class="w"> </span><span class="m">1002</span><span class="w"> </span><span class="m">1002</span><span class="w"> </span><span class="m">1002</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a>Gid:<span class="w"> </span><span class="m">1002</span><span class="w"> </span><span class="m">1002</span><span class="w"> </span><span class="m">1002</span><span class="w"> </span><span class="m">1002</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a>FDSize:<span class="w"> </span><span class="m">4096</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a>Groups:<span class="w"> </span><span class="m">1002</span><span class="w"> </span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a>VmPeak:<span class="w"> </span><span class="m">23980072</span><span class="w"> </span>kB
<a id="__codelineno-34-15" name="__codelineno-34-15"></a>VmSize:<span class="w"> </span><span class="m">23818032</span><span class="w"> </span>kB
<a id="__codelineno-34-16" name="__codelineno-34-16"></a>VmLck:<span class="w">        </span><span class="m">0</span><span class="w"> </span>kB
<a id="__codelineno-34-17" name="__codelineno-34-17"></a>VmPin:<span class="w">        </span><span class="m">0</span><span class="w"> </span>kB
<a id="__codelineno-34-18" name="__codelineno-34-18"></a>VmHWM:<span class="w">  </span><span class="m">9205188</span><span class="w"> </span>kB
<a id="__codelineno-34-19" name="__codelineno-34-19"></a>VmRSS:<span class="w">  </span><span class="m">9057300</span><span class="w"> </span>kB
<a id="__codelineno-34-20" name="__codelineno-34-20"></a>RssAnon:<span class="w">  </span><span class="m">9049584</span><span class="w"> </span>kB
<a id="__codelineno-34-21" name="__codelineno-34-21"></a>RssFile:<span class="w">     </span><span class="m">7716</span><span class="w"> </span>kB
<a id="__codelineno-34-22" name="__codelineno-34-22"></a>RssShmem:<span class="w">        </span><span class="m">0</span><span class="w"> </span>kB
<a id="__codelineno-34-23" name="__codelineno-34-23"></a>VmData:<span class="w"> </span><span class="m">23656776</span><span class="w"> </span>kB
<a id="__codelineno-34-24" name="__codelineno-34-24"></a>VmStk:<span class="w">      </span><span class="m">132</span><span class="w"> </span>kB
<a id="__codelineno-34-25" name="__codelineno-34-25"></a>VmExe:<span class="w">        </span><span class="m">4</span><span class="w"> </span>kB
<a id="__codelineno-34-26" name="__codelineno-34-26"></a>VmLib:<span class="w">    </span><span class="m">17316</span><span class="w"> </span>kB
<a id="__codelineno-34-27" name="__codelineno-34-27"></a>VmPTE:<span class="w">    </span><span class="m">18692</span><span class="w"> </span>kB
<a id="__codelineno-34-28" name="__codelineno-34-28"></a>VmSwap:<span class="w">    </span><span class="m">25872</span><span class="w"> </span>kB
<a id="__codelineno-34-29" name="__codelineno-34-29"></a>Threads:<span class="w"> </span><span class="m">213</span>
<a id="__codelineno-34-30" name="__codelineno-34-30"></a>SigQ:<span class="w"> </span><span class="m">0</span>/127861
<a id="__codelineno-34-31" name="__codelineno-34-31"></a>SigPnd:<span class="w"> </span><span class="m">0000000000000000</span>
<a id="__codelineno-34-32" name="__codelineno-34-32"></a>ShdPnd:<span class="w"> </span><span class="m">0000000000000000</span>
<a id="__codelineno-34-33" name="__codelineno-34-33"></a>SigBlk:<span class="w"> </span><span class="m">0000000000000004</span>
<a id="__codelineno-34-34" name="__codelineno-34-34"></a>SigIgn:<span class="w"> </span><span class="m">0000000000000002</span>
<a id="__codelineno-34-35" name="__codelineno-34-35"></a>SigCgt:<span class="w"> </span>2000000181005ccd
<a id="__codelineno-34-36" name="__codelineno-34-36"></a>CapInh:<span class="w"> </span><span class="m">0000000000000000</span>
<a id="__codelineno-34-37" name="__codelineno-34-37"></a>CapPrm:<span class="w"> </span><span class="m">0000000000000000</span>
<a id="__codelineno-34-38" name="__codelineno-34-38"></a>CapEff:<span class="w"> </span><span class="m">0000000000000000</span>
<a id="__codelineno-34-39" name="__codelineno-34-39"></a>CapBnd:<span class="w"> </span>0000001fffffffff
<a id="__codelineno-34-40" name="__codelineno-34-40"></a>CapAmb:<span class="w"> </span><span class="m">0000000000000000</span>
<a id="__codelineno-34-41" name="__codelineno-34-41"></a>Seccomp:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-34-42" name="__codelineno-34-42"></a>Speculation_Store_Bypass:<span class="w"> </span>vulnerable
<a id="__codelineno-34-43" name="__codelineno-34-43"></a>Cpus_allowed:<span class="w"> </span>ffffffff,ffffffff,ffffffff,ffffffff,ffffffff
<a id="__codelineno-34-44" name="__codelineno-34-44"></a>Cpus_allowed_list:<span class="w"> </span><span class="m">0</span>-159
<a id="__codelineno-34-45" name="__codelineno-34-45"></a>Mems_allowed:<span class="w"> </span><span class="m">00000000</span>,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000
<a id="__codelineno-34-46" name="__codelineno-34-46"></a><span class="m">000</span>,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000
<a id="__codelineno-34-47" name="__codelineno-34-47"></a>,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00
<a id="__codelineno-34-48" name="__codelineno-34-48"></a><span class="m">000000</span>,00000000,00000001
<a id="__codelineno-34-49" name="__codelineno-34-49"></a>Mems_allowed_list:<span class="w"> </span><span class="m">0</span>
<a id="__codelineno-34-50" name="__codelineno-34-50"></a>voluntary_ctxt_switches:<span class="w"> </span><span class="m">478194</span>
<a id="__codelineno-34-51" name="__codelineno-34-51"></a>nonvoluntary_ctxt_switches:<span class="w"> </span><span class="m">170</span>
</code></pre></div></td></tr></table></div>
<h2 id="awk">awk<a class="headerlink" href="#awk" title="Permanent link">&para;</a></h2>
<h3 id="_12">使用正则进行分组<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;Saturday\ntoday&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;match($1, /S(.*)?t(.*)y/, groups) { print groups[1]; print groups[2]; }&#39;</span>
</code></pre></div></td></tr></table></div>
<h2 id="tar">tar<a class="headerlink" href="#tar" title="Permanent link">&para;</a></h2>
<h3 id="_13">通过标准输入进行打包<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p><code>ls -f</code>替换find性能会提高很多</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a>find<span class="w"> </span><span class="nv">$max_dir</span><span class="w"> </span>-name<span class="w"> </span>*.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-<span class="nv">$file_num</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tar<span class="w"> </span>zcvf<span class="w"> </span><span class="nv">$tar_dir</span>/<span class="nv">$tar_name</span><span class="w"> </span>-T<span class="w"> </span>-<span class="w"> </span>--remove-file<span class="w"> </span>&gt;&gt;<span class="nv">$tar_dir</span>/tar.log
</code></pre></div></td></tr></table></div>
<h2 id="curl">curl<a class="headerlink" href="#curl" title="Permanent link">&para;</a></h2>
<h3 id="_14">学习资料<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p><a href="https://catonmat.net/cookbooks/curl">卷曲食谱 (catonmat.net)</a></p>
<h3 id="https">忽略https证书和进行密码认证<a class="headerlink" href="#https" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a>curl<span class="w"> </span>-k<span class="w"> </span>-u<span class="w"> </span>admin:123<span class="w"> </span>https://xxx
</code></pre></div></td></tr></table></div>
<h3 id="rescurl">将res结果作为另外一个curl的参数<a class="headerlink" href="#rescurl" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span>
<span class="normal"><a href="#__codelineno-38-4">4</a></span>
<span class="normal"><a href="#__codelineno-38-5">5</a></span>
<span class="normal"><a href="#__codelineno-38-6">6</a></span>
<span class="normal"><a href="#__codelineno-38-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>--compressed<span class="w"> </span>--http2<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="se">\</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;Host:smp-api.iyouke.com&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;authorization:bearer5378fb9bd91687516570322&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;charset:utf-8&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;xy-extra-frame.html&quot;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="w">        </span>-H<span class="w"> </span><span class="s2">&quot;accept:*/*&quot;</span><span class="w"> </span><span class="nv">$url</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="w">        </span>curl<span class="w"> </span>-s<span class="w"> </span>-u<span class="w"> </span>yanghe:8m.<span class="w"> </span>-d<span class="w"> </span>@-<span class="w"> </span>http://localhost:8081/moto
</code></pre></div></td></tr></table></div>
<h3 id="curl-debug">curl debug<a class="headerlink" href="#curl-debug" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1"># -vvv也行</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a>curl<span class="w"> </span>-s<span class="w"> </span>--trace<span class="w"> </span>-<span class="w"> </span>--dns-servers<span class="w"> </span><span class="m">1</span>.1.1.1<span class="w"> </span>https://www.baidu.com<span class="w"> </span>
</code></pre></div></td></tr></table></div>
<h2 id="_15">随机生成密码<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a>tr<span class="w"> </span>-dc<span class="w"> </span><span class="s1">&#39;A-Za-z0-9_!@#$%^&amp;*()-+=&#39;</span><span class="w"> </span>&lt;<span class="w"> </span>/dev/urandom<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-c<span class="w"> </span><span class="m">12</span>
</code></pre></div></td></tr></table></div>
<h2 id="linux_1">调整Linux系统连接数<a class="headerlink" href="#linux_1" title="Permanent link">&para;</a></h2>
<p>linux 中, 可以通过 <code>cat /proc/pid/limits</code> 的方式查看一个进程的 ulimit 限制情况, 如下所示:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a># cat /proc/31519/limits
<a id="__codelineno-41-2" name="__codelineno-41-2"></a>Limit                     Soft Limit           Hard Limit           Units
<a id="__codelineno-41-3" name="__codelineno-41-3"></a>Max cpu time              unlimited            unlimited            seconds
<a id="__codelineno-41-4" name="__codelineno-41-4"></a>Max file size             unlimited            unlimited            bytes
<a id="__codelineno-41-5" name="__codelineno-41-5"></a>Max data size             unlimited            unlimited            bytes
<a id="__codelineno-41-6" name="__codelineno-41-6"></a>Max stack size            8388608              unlimited            bytes
<a id="__codelineno-41-7" name="__codelineno-41-7"></a>Max core file size        0                    unlimited            bytes
<a id="__codelineno-41-8" name="__codelineno-41-8"></a>Max resident set          unlimited            unlimited            bytes
<a id="__codelineno-41-9" name="__codelineno-41-9"></a>Max processes             65535                65535                processes
<a id="__codelineno-41-10" name="__codelineno-41-10"></a>Max open files            65535                65535                files
<a id="__codelineno-41-11" name="__codelineno-41-11"></a>Max locked memory         65536                65536                bytes
<a id="__codelineno-41-12" name="__codelineno-41-12"></a>Max address space         unlimited            unlimited            bytes
<a id="__codelineno-41-13" name="__codelineno-41-13"></a>Max file locks            unlimited            unlimited            locks
<a id="__codelineno-41-14" name="__codelineno-41-14"></a>Max pending signals       14052                14052                signals
<a id="__codelineno-41-15" name="__codelineno-41-15"></a>Max msgqueue size         819200               819200               bytes
<a id="__codelineno-41-16" name="__codelineno-41-16"></a>Max nice priority         0                    0
<a id="__codelineno-41-17" name="__codelineno-41-17"></a>Max realtime priority     0                    0
<a id="__codelineno-41-18" name="__codelineno-41-18"></a>Max realtime timeout      unlimited            unlimited            us
</code></pre></div></td></tr></table></div>
<h3 id="_16">临时调整<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<h4 id="1-prlimitcentos7">方式1. prlimit(Centos7以上)<a class="headerlink" href="#1-prlimitcentos7" title="Permanent link">&para;</a></h4>
<p>Centos/RedHat 7 及以上的系统使用 <code>prlimit</code> 工具(&gt;= util-linux-2.21 提供)修改:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a># 不限制是 unlimited:unlimited
<a id="__codelineno-42-2" name="__codelineno-42-2"></a>prlimit --pid xxxx --nofile=65535:65535
</code></pre></div></td></tr></table></div>
<h4 id="2-centos6">方式2. (Centos6以下)<a class="headerlink" href="#2-centos6" title="Permanent link">&para;</a></h4>
<p>早期系统(比如 Centos/RedHat 6 - 2.6.32+), 可以通过以下方式直接修改进程的限制:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span>“Max<span class="w"> </span><span class="nv">processes</span><span class="o">=</span>SOFT_LIMIT:HARD_LIMIT”<span class="w"> </span>&gt;<span class="w"> </span>/proc/pid/limits
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span>“Max<span class="w"> </span>open<span class="w"> </span><span class="nv">files</span><span class="o">=</span>SOFT_LIMIT:HARD_LIMIT”<span class="w"> </span>&gt;<span class="w"> </span>/proc/pid/limits
</code></pre></div></td></tr></table></div>
<h4 id="3-centos6">方式3. Centos6以上<a class="headerlink" href="#3-centos6" title="Permanent link">&para;</a></h4>
<p>记录下另外一种方式调整连接数，在启动的的时候进行调整，同时可以指定用户运行次程序：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1">1</a></span>
<span class="normal"><a href="#__codelineno-44-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="nb">ulimit</span><span class="w"> </span>-n<span class="w"> </span><span class="m">65535</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a>su<span class="w"> </span>-s<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;java -Dlog.dir=logs -Dlog.days=7 -jar logger-1.0.5.jar &gt;/dev/null 2&gt;&amp;1 &amp;&#39;</span><span class="w"> </span>sunrise
</code></pre></div></td></tr></table></div>
<h3 id="todo">永久修改(TODO)<a class="headerlink" href="#todo" title="Permanent link">&para;</a></h3>
<p><a href="https://blog.csdn.net/hzgj77/article/details/98843273">(137条消息) RedHat、centos 7.0以上设置系统打开文件数等设置问题_hzgj77的博客-CSDN博客</a></p>
<h2 id="linux-socket">linux socket连接数统计<a class="headerlink" href="#linux-socket" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a>netstat<span class="w"> </span>-an<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#39;</span>
</code></pre></div></td></tr></table></div>
<p>指定端口统计连接数</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a>ss<span class="w"> </span>-ta<span class="w"> </span>src<span class="w"> </span>:6000
</code></pre></div></td></tr></table></div>
<h2 id="nginx_2">NGINX<a class="headerlink" href="#nginx_2" title="Permanent link">&para;</a></h2>
<h3 id="nginx_3">通过信号控制NGINX<a class="headerlink" href="#nginx_3" title="Permanent link">&para;</a></h3>
<p>NGINX默认master进程pid文件在~~/usr/local/nginx/logs/nginx.pid~~，我的Mint在<code>/var/run/nginx.pid</code>
![[Snipaste_2023-07-12_14-17-01.png]]
主进程支持以下信号：</p>
<ul>
<li>TERM,INT ：快速关闭</li>
<li>QUIT： 优雅的关闭</li>
<li>HUP ：更改配置，使用新配置启动进程，关闭旧进程</li>
<li>USR1：重新打开日志文件</li>
<li>USR2：升级可执行文件</li>
<li>WINCH：优雅的关闭工作进程，单个工作进程也可以用信号控制，不是必须的</li>
<li>TERM, INT：快速关闭</li>
<li>QUIT：优雅的关闭</li>
<li>重新打开日志文件</li>
<li>WINCH：终止异常调试（需要启用debug_points）</li>
</ul>
<h4 id="nginx_4">更改nginx配置<a class="headerlink" href="#nginx_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span>
<span class="normal"><a href="#__codelineno-47-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a>ps<span class="w"> </span>axw<span class="w"> </span>-o<span class="w"> </span>pid,ppid,user,%cpu,vxz,wchan,command<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">&#39;(nginx|PID)&#39;</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="nb">kill</span><span class="w"> </span>-HUP<span class="w"> </span><span class="m">33126</span>
</code></pre></div></td></tr></table></div>
<p>PID为33126的进程仍在工作，一段时间后就会退出</p>
<h4 id="_17">日志文件轮询<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a>mv<span class="w"> </span>access.log<span class="w"> </span>access_bak.log
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="nb">kill</span><span class="w"> </span>-USR1<span class="w"> </span><span class="m">11604</span>
</code></pre></div></td></tr></table></div>
<h4 id="_18">动态升级可执行文件<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<p><a href="https://www.hxstrive.com/subject/nginx/796.htm">通过信号控制 nginx - Nginx 教程 (hxstrive.com)</a>
不如kill掉，替换</p>
<h2 id="shc-shell">shc 加密shell脚本<a class="headerlink" href="#shc-shell" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a>shc<span class="w"> </span>-r<span class="w"> </span>-f<span class="w"> </span>filename.sh
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="c1"># 开始静态编译，让可以跨平台运行</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a>cc<span class="w"> </span>-Wall<span class="w"> </span>-lutil<span class="w"> </span>-static<span class="w"> </span>-o<span class="w"> </span>filename<span class="w"> </span>filename.x.c
</code></pre></div></td></tr></table></div>
<h2 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span>
<span class="normal"><a href="#__codelineno-50-14">14</a></span>
<span class="normal"><a href="#__codelineno-50-15">15</a></span>
<span class="normal"><a href="#__codelineno-50-16">16</a></span>
<span class="normal"><a href="#__codelineno-50-17">17</a></span>
<span class="normal"><a href="#__codelineno-50-18">18</a></span>
<span class="normal"><a href="#__codelineno-50-19">19</a></span>
<span class="normal"><a href="#__codelineno-50-20">20</a></span>
<span class="normal"><a href="#__codelineno-50-21">21</a></span>
<span class="normal"><a href="#__codelineno-50-22">22</a></span>
<span class="normal"><a href="#__codelineno-50-23">23</a></span>
<span class="normal"><a href="#__codelineno-50-24">24</a></span>
<span class="normal"><a href="#__codelineno-50-25">25</a></span>
<span class="normal"><a href="#__codelineno-50-26">26</a></span>
<span class="normal"><a href="#__codelineno-50-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a>docker<span class="w"> </span>save<span class="w"> </span>-o<span class="w"> </span>docker-elk-filebeat.tar<span class="w"> </span>docker-elk-filebeat:latest<span class="w"> </span><span class="c1"># 导出镜像</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="w"> </span>docker<span class="w"> </span>load<span class="w"> </span>-i<span class="w"> </span>docker-elk-filebeat.tar<span class="w"> </span><span class="c1"># 导入镜像</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a>docker<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>容器ID或镜像名字<span class="w"> </span><span class="c1"># 删除容器</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a>docker<span class="w"> </span>rmi<span class="w"> </span>镜像名称<span class="w"> </span><span class="c1"># 删除镜像</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="c1"># 一次性删除多个容器实例：</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a>docker<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span>-q<span class="k">)</span>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a>docker<span class="w"> </span>rm<span class="w"> </span>-a<span class="w"> </span>-q<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>docker<span class="w"> </span>rm
<a id="__codelineno-50-9" name="__codelineno-50-9"></a>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a>docker<span class="w"> </span><span class="nb">export</span><span class="w"> </span>容器ID<span class="w"> </span>&gt;<span class="w"> </span>文件名.tar<span class="w"> </span><span class="c1"># 导出容器</span>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="c1"># 恢复到新的镜像，然后创建新的容器</span>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a>cat<span class="w"> </span>文件名.tar<span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>import<span class="w"> </span>-<span class="w"> </span>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>...
<a id="__codelineno-50-14" name="__codelineno-50-14"></a>
<a id="__codelineno-50-15" name="__codelineno-50-15"></a><span class="c1"># 容器打包成镜像</span>
<a id="__codelineno-50-16" name="__codelineno-50-16"></a>docker<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">&quot;描述&quot;</span><span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;作者&quot;</span><span class="w"> </span>容器ID:tag
<a id="__codelineno-50-17" name="__codelineno-50-17"></a>
<a id="__codelineno-50-18" name="__codelineno-50-18"></a><span class="c1"># 容器卷</span>
<a id="__codelineno-50-19" name="__codelineno-50-19"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--privileged<span class="o">=</span><span class="nb">true</span><span class="w"> </span>-v<span class="w"> </span>/宿主机目录:/容器内目录:rw<span class="w"> </span>镜像名<span class="w"> </span><span class="o">(</span>默认是rw<span class="o">)</span>，可以改为ro（read<span class="w"> </span>only），容器卷只读，不可写入。宿主机可以写入，同步给容器。
<a id="__codelineno-50-20" name="__codelineno-50-20"></a>
<a id="__codelineno-50-21" name="__codelineno-50-21"></a><span class="c1"># docker卷继承</span>
<a id="__codelineno-50-22" name="__codelineno-50-22"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--privileged<span class="o">=</span><span class="nb">true</span><span class="w"> </span>--volumes-from<span class="w"> </span>父类<span class="w"> </span>--name<span class="w"> </span>u2<span class="w"> </span>ubuntu
<a id="__codelineno-50-23" name="__codelineno-50-23"></a>
<a id="__codelineno-50-24" name="__codelineno-50-24"></a><span class="c1"># 查看所有虚玄镜像</span>
<a id="__codelineno-50-25" name="__codelineno-50-25"></a>docker<span class="w"> </span>image<span class="w"> </span>ls<span class="w"> </span>-f<span class="w"> </span><span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span>
<a id="__codelineno-50-26" name="__codelineno-50-26"></a><span class="c1"># 删除所有虚玄镜像</span>
<a id="__codelineno-50-27" name="__codelineno-50-27"></a>docker<span class="w"> </span>image<span class="w"> </span>prune
</code></pre></div></td></tr></table></div>
<p>Docker挂在主机目录访问如果出现connot open directory ：Permission denied
解决办法：在挂载目录后多加一个--privileged=true</p>
<h3 id="docker-compose">docker-compose<a class="headerlink" href="#docker-compose" title="Permanent link">&para;</a></h3>
<h4 id="_19">命令行参数<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span><span class="c1"># 启动所有docker-compose服务</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span><span class="c1"># 启动所有docker-compose服务在后台运行</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a>docker-compose<span class="w"> </span>down<span class="w"> </span><span class="c1"># 停止并删除容器、网络、卷、镜像</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>容器ID<span class="w"> </span>/bin/bash<span class="w"> </span><span class="c1"># 进入容器内部</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>docker-compose<span class="w"> </span>ps<span class="w"> </span><span class="c1"># 展示当前docker-compose编排过的运行的所有容器</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a>docker-compose<span class="w"> </span>top<span class="w"> </span><span class="c1"># 展示当前docker-compose编排过的容器进程</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>容器ID<span class="w"> </span><span class="c1"># 查看容器输出日志</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a>docker-compose<span class="w"> </span>config<span class="w"> </span><span class="c1"># 检查配置</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a>docker-compose<span class="w"> </span>config<span class="w"> </span>-q<span class="w"> </span><span class="c1"># 检查配置，有问题才输出</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a>docker-compose<span class="w"> </span>restart<span class="w"> </span><span class="c1"># 重启服务</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a>docker-compose<span class="w"> </span>start<span class="w"> </span><span class="c1"># 启动服务</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a>docker-compose<span class="w"> </span>stop<span class="w"> </span><span class="c1"># 停止服务</span>
</code></pre></div></td></tr></table></div>
<h4 id="yaml">yaml 文件级<a class="headerlink" href="#yaml" title="Permanent link">&para;</a></h4>
<p>Docker Compose 的 YAML 文件包含4个一级 key:version、services、networks、volumes。</p>
<ul>
<li>version 是必须指定的，位于文件的第一行。它定义了 Compose 文件格式（主要是API）的版本。</li>
<li>services 用于定义不同的应用服务。</li>
<li>networks 用于指引 Docker 创建新的网络。</li>
<li>volumes 用于指引 Docker 来创建新的卷。</li>
</ul>
<h2 id="strip">strip — 丢弃对象文件中的符号和其他数据<a class="headerlink" href="#strip" title="Permanent link">&para;</a></h2>
<p>在嵌入式用的比较多，嵌入式存储空间一般非常小，一般服务器无所谓</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span>
<span class="normal"><a href="#__codelineno-52-3">3</a></span>
<span class="normal"><a href="#__codelineno-52-4">4</a></span>
<span class="normal"><a href="#__codelineno-52-5">5</a></span>
<span class="normal"><a href="#__codelineno-52-6">6</a></span>
<span class="normal"><a href="#__codelineno-52-7">7</a></span>
<span class="normal"><a href="#__codelineno-52-8">8</a></span>
<span class="normal"><a href="#__codelineno-52-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a>yanghe@IkunOS:/tmp$<span class="w"> </span>file<span class="w"> </span>hello_world
<a id="__codelineno-52-2" name="__codelineno-52-2"></a>hello_world:<span class="w"> </span>ELF<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>LSB<span class="w"> </span>executable,<span class="w"> </span>x86-64,<span class="w"> </span>version<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>GNU/Linux<span class="o">)</span>,<span class="w"> </span>statically<span class="w"> </span>linked,<span class="w"> </span>BuildID<span class="o">[</span>sha1<span class="o">]=</span>0266e8c8b510581d97cd75551682b839d8c8ba47,<span class="w"> </span><span class="k">for</span><span class="w"> </span>GNU/Linux<span class="w"> </span><span class="m">3</span>.2.0,<span class="w"> </span>not<span class="w"> </span>stripped
<a id="__codelineno-52-3" name="__codelineno-52-3"></a>yanghe@IkunOS:/tmp$<span class="w"> </span>du<span class="w"> </span>hello_world
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="m">1024</span><span class="w"> </span>hello_world
<a id="__codelineno-52-5" name="__codelineno-52-5"></a>yanghe@IkunOS:/tmp$<span class="w"> </span>strip<span class="w"> </span>-s<span class="w"> </span>hello_world
<a id="__codelineno-52-6" name="__codelineno-52-6"></a>yanghe@IkunOS:/tmp$<span class="w"> </span>du<span class="w"> </span>hello_world
<a id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="m">940</span><span class="w"> </span>hello_world
<a id="__codelineno-52-8" name="__codelineno-52-8"></a>yanghe@IkunOS:/tmp$<span class="w"> </span>file<span class="w"> </span>hello_world
<a id="__codelineno-52-9" name="__codelineno-52-9"></a>hello_world:<span class="w"> </span>ELF<span class="w"> </span><span class="m">64</span>-bit<span class="w"> </span>LSB<span class="w"> </span>executable,<span class="w"> </span>x86-64,<span class="w"> </span>version<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">(</span>GNU/Linux<span class="o">)</span>,<span class="w"> </span>statically<span class="w"> </span>linked,<span class="w"> </span>BuildID<span class="o">[</span>sha1<span class="o">]=</span>0266e8c8b510581d97cd75551682b839d8c8ba47,<span class="w"> </span><span class="k">for</span><span class="w"> </span>GNU/Linux<span class="w"> </span><span class="m">3</span>.2.0,<span class="w"> </span>stripped
</code></pre></div></td></tr></table></div>
<p>参考：</p>
<ul>
<li><a href="https://cs.pynote.net/sf/c/cdm/202110268/">strip命令 | CS笔记 (pynote.net)</a></li>
<li><a href="https://www.cnblogs.com/englyf/p/17510353.html">Linux 可执行文件瘦身指令 strip 使用示例 - ENG八戒 - 博客园 (cnblogs.com)</a></li>
</ul>
<h2 id="nmcli">nmcli<a class="headerlink" href="#nmcli" title="Permanent link">&para;</a></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span>
<span class="normal"><a href="#__codelineno-53-2">2</a></span>
<span class="normal"><a href="#__codelineno-53-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a>nmcli<span class="w"> </span>con<span class="w"> </span>show
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="w"> </span>nmcli<span class="w"> </span>con<span class="w"> </span>mod<span class="w"> </span>enp0s8<span class="w"> </span>ipv4.addresses<span class="w"> </span><span class="m">192</span>.168.56.119/24<span class="w"> </span>ipv4.gateway<span class="w"> </span><span class="m">192</span>.168.56.1<span class="w"> </span>ipv4.method<span class="w"> </span>manual
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="w"> </span>nmcli<span class="w"> </span>con<span class="w"> </span>up<span class="w"> </span>enp0s8
</code></pre></div></td></tr></table></div>
<h2 id="wget">wget<a class="headerlink" href="#wget" title="Permanent link">&para;</a></h2>
<p>断点续传+后台下载</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a>wget<span class="w"> </span>-b<span class="w"> </span>-c<span class="w"> </span>https://xxx
</code></pre></div></td></tr></table></div>
<p>下载这个站点目录下的全部rpm</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a>wget<span class="w"> </span>-r<span class="w"> </span>-np<span class="w"> </span>-L<span class="w"> </span>-nv<span class="w"> </span>-x<span class="w"> </span>-N<span class="w"> </span>mirrors.cmecloud.cn/bclinux/el8.2/BaseOS/x86_64/os/Packages/
</code></pre></div></td></tr></table></div>
- 参考
  - <a href="https://www.cnblogs.com/librarookie/p/14660645.html">https://www.cnblogs.com/librarookie/p/14660645.html</a></p>
<h2 id="pcregrep-pcre2grep">pcregrep &amp; pcre2grep<a class="headerlink" href="#pcregrep-pcre2grep" title="Permanent link">&para;</a></h2>
<p>专门使用PCRE规范来实现的grep
使用正则表达式：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a>pcregrep<span class="w">  </span>-o1<span class="w"> </span><span class="s1">&#39;echo(.*?)d&#39;</span><span class="w"> </span>hello-world.sh
</code></pre></div></td></tr></table></div></p>
<blockquote>
<p>主要原因是grep支持三种正则表达式BRE,ERE,PCRE，而其默认使用的是BRE，但\d是定义在PCRE中的，所以grep默认是不支持\d的。</p>
</blockquote>
<p>pcre2grep 有个好用的功能：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span>
<span class="normal"><a href="#__codelineno-57-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a>$<span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s1">&#39;name:zhangsan,age:18 \n name:lisi,age:20&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>pcre2grep<span class="w"> </span>-O<span class="w"> </span><span class="s1">&#39;$1 $2&#39;</span><span class="w"> </span><span class="s1">&#39;name:(\w+),age:(\d+)&#39;</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a>zhangsan<span class="w"> </span><span class="m">18</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a>lisi<span class="w"> </span><span class="m">20</span>
</code></pre></div></td></tr></table></div>
- 参考
  - https://www.cnblogs.com/codelogs/p/16060372.html</p>
<h2 id="sudo">sudo<a class="headerlink" href="#sudo" title="Permanent link">&para;</a></h2>
<p>判断是不是具有sudo权限：
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a>sudo<span class="w"> </span>-l<span class="w"> </span>-U<span class="w"> </span>zhangsan
</code></pre></div></td></tr></table></div></p>
<h2 id="windows">windows<a class="headerlink" href="#windows" title="Permanent link">&para;</a></h2>
<h3 id="bvssh">Bvssh<a class="headerlink" href="#bvssh" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a>BvSsh.exe -profile=&quot;D:\备份资料\bitvise profile\10.128.12.12.tlp&quot; -start=login -openTerm -exitOnLogout -noRegistry=y -autoLogout -hide=main -term=xterm-256color
</code></pre></div></td></tr></table></div>
<h3 id="vboxmanage">VBoxManage<a class="headerlink" href="#vboxmanage" title="Permanent link">&para;</a></h3>
<h4 id="_20">列出全部虚拟机<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="n">VBoxManage</span><span class="p">.</span><span class="n">exe</span> <span class="n">host</span> <span class="n">vms</span>
</code></pre></div></td></tr></table></div>
<h4 id="_21">开启虚拟机虚拟化<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a>&quot;D:\Program Files\Oracle\VirtualBox\VBoxManage.exe&quot; modifyvm &quot;centos7&quot; --nested-hw-virt on
</code></pre></div></td></tr></table></div>
<h4 id="_22">命令帮助文档<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://www.virtualbox.org/manual/ch08.html">https://www.virtualbox.org/manual/ch08.html</a></li>
</ul>
<h2 id="work">work<a class="headerlink" href="#work" title="Permanent link">&para;</a></h2>
<h3 id="idcardcaches">处理idCardCaches目录文件<a class="headerlink" href="#idcardcaches" title="Permanent link">&para;</a></h3>
<ul>
<li>将管理程序idCardCaches目录下文件移动到home/idCardCaches</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="o">(</span><span class="nb">cd</span><span class="w"> </span>/data/idreader-service/idreader-service-telecom/logs/idCardCaches/<span class="w">  </span><span class="o">&amp;&amp;</span><span class="w"> </span>ls<span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-n<span class="w"> </span><span class="m">200000</span><span class="w"> </span><span class="p">|</span>xargs<span class="w"> </span>-t<span class="w"> </span>-I<span class="w"> </span><span class="o">{}</span><span class="w"> </span>mv<span class="w"> </span><span class="o">{}</span><span class="w"> </span>~/idCardCaches<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>~/output.txt<span class="w"> </span><span class="p">&amp;</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>将home/idCardCaches文件进行压缩归档</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="o">(</span><span class="nb">cd</span><span class="w"> </span>idCardCaches/<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ls<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-200000<span class="w"> </span><span class="p">|</span><span class="w"> </span>tar<span class="w"> </span>zcvf<span class="w"> </span>/home/sunrise/241idCardCaches<span class="k">$(</span>date<span class="w"> </span><span class="s2">&quot;+%Y-%m-%d_%H%M%S&quot;</span><span class="k">)</span>.tgz<span class="w"> </span>-T<span class="w"> </span>-<span class="w"> </span>--remove-file<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>~/output.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;backup done&quot;</span><span class="w"> </span><span class="p">&amp;</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="caches">处理Caches目录文件<a class="headerlink" href="#caches" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="o">(</span>find<span class="w"> </span>/data/idreader-service/idreader-service-telecom/logs/caches/<span class="w"> </span>-name<span class="w"> </span>*.json<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-200000<span class="w"> </span><span class="p">|</span><span class="w"> </span>tar<span class="w"> </span>zcvf<span class="w"> </span>/home/sunrise/242caches<span class="k">$(</span>date<span class="w"> </span><span class="s2">&quot;+%Y-%m-%d_%H%M%S&quot;</span><span class="k">)</span>.tgz<span class="w"> </span>-T<span class="w"> </span>-<span class="w"> </span>--remove-file<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/home/sunrise/output.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;caches backup done&quot;</span><span class="w"> </span><span class="p">&amp;</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="network">network业务量按每小时统计<a class="headerlink" href="#network" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1">1</a></span>
<span class="normal"><a href="#__codelineno-65-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="nb">cd</span><span class="w"> </span>/data/idreader-service/idreader-service-telecom/logs/
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="o">(</span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">00</span>..23<span class="o">}</span><span class="p">;</span><span class="k">do</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="nv">$i</span><span class="w"> </span>-lt<span class="w"> </span><span class="m">08</span><span class="p">;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span><span class="w"> </span><span class="k">fi</span><span class="p">;</span>grep<span class="w"> </span>-E<span class="w"> </span><span class="o">[</span>S,R<span class="o">]</span><span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%Y%m%d&quot;</span><span class="w"> </span>--date<span class="o">=</span><span class="s1">&#39;-1 day&#39;</span><span class="sb">`</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="o">[</span><span class="m">1</span>-9<span class="o">]{</span><span class="m">4</span><span class="o">}</span><span class="w"> </span>network_<span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%Y-%m-%d&quot;</span><span class="w"> </span>--date<span class="o">=</span><span class="s1">&#39;-1 day&#39;</span><span class="sb">`</span>.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;90 00&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="networ">networ业务量按每分钟统计<a class="headerlink" href="#networ" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="o">(</span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">00</span>..59<span class="o">}</span><span class="p">;</span><span class="k">do</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">;</span>grep<span class="w"> </span>-E<span class="w"> </span><span class="o">[</span>S,R<span class="o">]</span><span class="sb">`</span>date<span class="w"> </span><span class="s2">&quot;+%Y%m%d&quot;</span><span class="sb">`</span><span class="m">09</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="o">[</span><span class="m">1</span>-9<span class="o">]{</span><span class="m">2</span><span class="o">}</span><span class="w"> </span>network.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;90 00&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span><span class="o">)</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="w"> </span><span class="o">(</span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">01</span>..59<span class="o">}</span><span class="p">;</span><span class="k">do</span><span class="w">  </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">: &quot;</span><span class="p">;</span>sed<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;/09:</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">:00/,/09:</span><span class="si">${</span><span class="nv">i</span><span class="si">}</span><span class="s2">:59/p&quot;</span><span class="w"> </span>/data/idreader-service/idreader-service-telecom/logs/runtime.log<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;成功&quot;</span><span class="p">;</span><span class="k">done</span><span class="o">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="error">统计ERROR<a class="headerlink" href="#error" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a>grep<span class="w"> </span><span class="s2">&quot;ERROR&quot;</span><span class="w"> </span>/data/idreader-service-ct-cloud/idreader-service-ct-cloud/logs/runtime.log<span class="p">|</span>awk<span class="w"> </span><span class="s1">&#39;{print $2,$3,$4,$5}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>uniq<span class="w"> </span>-c<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rn
</code></pre></div></td></tr></table></div>
<h3 id="warn">统计WARN<a class="headerlink" href="#warn" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;WARN&quot;</span><span class="w"> </span>/data/idreader-service-ct-cloud/idreader-service-ct-cloud/logs/runtime.log
</code></pre></div></td></tr></table></div>
<h3 id="tcp">统计TCP连接状态<a class="headerlink" href="#tcp" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a>netstat<span class="w"> </span>-n<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#39;</span>
</code></pre></div></td></tr></table></div>
<h3 id="_23">程序打开文件数<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a>lsof<span class="w"> </span>-c<span class="w"> </span>nginx<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span>
<span class="normal"><a href="#__codelineno-71-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a>lsof<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>java<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>IPv<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
<a id="__codelineno-71-2" name="__codelineno-71-2"></a>lsof<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>java<span class="w"> </span><span class="p">|</span>grep<span class="w"> </span>:6379<span class="w"> </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</code></pre></div></td></tr></table></div>
<h3 id="server_statustxt">动态刷新server_status.txt文件<a class="headerlink" href="#server_statustxt" title="Permanent link">&para;</a></h3>
<p>```bash
watch -n 1 'head -1 /data/idreader-service/idreader-service-telecom/server_status.txt ; grep -v "SAM" /data/idreader-service/idreader-service-telecom/server_status.txt| sort -nk4 -t .'</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.indexes", "toc.follow", "navigation.top", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
    
  </body>
</html>